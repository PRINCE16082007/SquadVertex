<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>LightExam ‚Äî Minimal Exam Builder</title>
<style>
  :root {
    --primary: #2563eb;
    --primary-dark: #1d4ed8;
    --danger: #ef4444;
    --danger-dark: #dc2626;
    --success: #10b981;
    --gray-100: #f3f4f6;
    --gray-200: #e5e7eb;
    --gray-300: #d1d5db;
    --gray-600: #4b5563;
    --gray-700: #374151;
    --gray-800: #1f2937;
    --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --radius: 8px;
    font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
  }

  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  body {
    background-color: #f9fafb;
    color: var(--gray-800);
    line-height: 1.5;
    padding: 16px;
    font-size: 15px;
  }

  .container {
    max-width: 1000px;
    margin: 0 auto;
    background: white;
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    padding: 20px;
  }

  .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid var(--gray-200);
  }

  .header h1 {
    font-size: 24px;
    font-weight: 700;
    color: var(--gray-800);
  }

  .header .subtitle {
    color: var(--gray-600);
    font-size: 14px;
  }

  .meta-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 12px;
    margin-bottom: 20px;
  }

  .form-group {
    display: flex;
    flex-direction: column;
  }

  label {
    font-size: 13px;
    font-weight: 500;
    margin-bottom: 5px;
    color: var(--gray-700);
  }

  input[type="text"], select {
    padding: 10px 12px;
    border: 1px solid var(--gray-300);
    border-radius: 6px;
    font-size: 14px;
    transition: all 0.2s;
  }

  input[type="text"]:focus, select:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
  }

  .controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 12px;
    margin-bottom: 20px;
    padding: 12px 0;
  }

  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 8px 16px;
    border-radius: 6px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    border: none;
    transition: all 0.2s;
  }

  .btn-primary {
    background-color: var(--primary);
    color: white;
  }

  .btn-primary:hover {
    background-color: var(--primary-dark);
  }

  .btn-secondary {
    background-color: var(--gray-600);
    color: white;
  }

  .btn-secondary:hover {
    background-color: var(--gray-700);
  }

  .btn-danger {
    background-color: var(--danger);
    color: white;
  }

  .btn-danger:hover {
    background-color: var(--danger-dark);
  }

  .btn-small {
    padding: 6px 12px;
    font-size: 13px;
  }

  .btn-group {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }

  .section {
    background: white;
    border: 1px dashed var(--gray-300);
    border-radius: var(--radius);
    padding: 16px;
    margin-bottom: 16px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
  }

  .section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
  }

  .section-title {
    font-size: 16px;
    font-weight: 600;
    color: var(--gray-800);
  }

  .section-type {
    font-size: 12px;
    color: var(--gray-600);
    margin-top: 2px;
  }

  .section-controls {
    display: flex;
    gap: 8px;
  }

  .section-title-input {
    width: 100%;
    margin-bottom: 12px;
    padding: 10px 12px;
    border: 1px solid var(--gray-300);
    border-radius: 6px;
    font-size: 14px;
  }

  .item {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    margin-bottom: 12px;
    padding: 12px;
    background: var(--gray-100);
    border-radius: 6px;
  }

  .item-question {
    flex: 1;
  }

  .item-marks {
    width: 80px;
    flex-shrink: 0;
  }

  .item-controls {
    display: flex;
    gap: 8px;
  }

  .mcq-options {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
    margin-top: 10px;
  }

  .mcq-option {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .mcq-option label {
    font-size: 13px;
    font-weight: 500;
    min-width: 20px;
  }

  .preview {
    margin-top: 24px;
    padding-top: 20px;
    border-top: 1px solid var(--gray-200);
  }

  .preview h3 {
    font-size: 18px;
    margin-bottom: 12px;
    color: var(--gray-800);
  }

  .preview-content {
    background: white;
    padding: 20px;
    border-radius: var(--radius);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    max-height: 500px;
    overflow-y: auto;
  }

  .footer-note {
    text-align: center;
    margin-top: 20px;
    color: var(--gray-600);
    font-size: 13px;
  }

  @media (max-width: 768px) {
    .meta-grid {
      grid-template-columns: 1fr;
    }

    .header {
      flex-direction: column;
      align-items: flex-start;
      gap: 8px;
    }

    .controls {
      flex-direction: column;
      align-items: flex-start;
    }

    .btn-group {
      width: 100%;
      justify-content: space-between;
    }

    .mcq-options {
      grid-template-columns: 1fr;
    }
  }
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div>
      <h1>LightExam ‚Äî Minimal Exam Builder</h1>
      <div class="subtitle">Light, offline, teacher-focused ‚Äî built for quick papers.</div>
    </div>
  </div>

  <!-- Header meta -->
  <div class="meta-grid">
    <div class="form-group">
      <label for="meta-school">School name</label>
      <input id="meta-school" type="text" placeholder="Ex: Modern High School">
    </div>
    <div class="form-group">
      <label for="meta-exam">Exam name</label>
      <input id="meta-exam" type="text" placeholder="Ex: Term 1 - Science">
    </div>
    <div class="form-group">
      <label for="meta-subject">Subject</label>
      <input id="meta-subject" type="text" placeholder="Ex: Biology">
    </div>
    <div class="form-group">
      <label for="meta-time">Time / Duration</label>
      <input id="meta-time" type="text" placeholder="Ex: 1h 30m">
    </div>
    <div class="form-group">
      <label for="meta-marks">Total marks</label>
      <input id="meta-marks" type="text" placeholder="Ex: 80">
    </div>
  </div>

  <div class="controls">
    <div class="btn-group">
      <select id="add-type" class="btn btn-secondary btn-small">
        <option value="mcq">MCQ (Multiple choice)</option>
        <option value="short">Short answer</option>
        <option value="long">Long answer</option>
        <option value="match">Matching</option>
        <option value="fill">Fill in the Blanks</option>
      </select>
      <button id="btn-add" class="btn btn-primary">Add Section</button>
    </div>

    <div class="btn-group">
      <button id="btn-save" class="btn btn-secondary btn-small">üíæ Save</button>
      <button id="btn-load" class="btn btn-secondary btn-small">üìÇ Load</button>
      <button id="btn-preview" class="btn btn-secondary btn-small">üëÅÔ∏è Preview</button>
      <button id="btn-export-pdf" class="btn btn-primary btn-small">üñ® Print PDF</button>
      <button id="btn-clear" class="btn btn-danger btn-small">CLEAR</button>
    </div>
  </div>

  <div id="sections-container"></div>

  <div class="preview" id="preview-area" style="display:none">
    <h3>Preview</h3>
    <div class="preview-content" id="preview-output"></div>
  </div>

  <div class="footer-note">
    Tip: Save often. Teacher-friendly blocks ‚Äî add, reorder, and export. Keep it lightweight.
  </div>
</div>

<script>
(function(){
  // util
  const uid = () => 's-' + Math.random().toString(36).slice(2,9);
  const STORAGE_KEY = 'examBuilderData';

  // initial model
  let model = {
    meta: {school:'', exam:'', subject:'', time:'', marks:''},
    sections: []
  };

  // DOM refs
  const cont = document.getElementById('sections-container');
  const metaInputs = {
    school: document.getElementById('meta-school'),
    exam: document.getElementById('meta-exam'),
    subject: document.getElementById('meta-subject'),
    time: document.getElementById('meta-time'),
    marks: document.getElementById('meta-marks')
  };
  const previewArea = document.getElementById('preview-area');
  const previewOutput = document.getElementById('preview-output');

  // load saved meta to inputs
  function bindMetaToInputs(){
    metaInputs.school.value = model.meta.school || '';
    metaInputs.exam.value = model.meta.exam || '';
    metaInputs.subject.value = model.meta.subject || '';
    metaInputs.time.value = model.meta.time || '';
    metaInputs.marks.value = model.meta.marks || '';
  }

  function collectMetaFromInputs(){
    model.meta.school = metaInputs.school.value;
    model.meta.exam = metaInputs.exam.value;
    model.meta.subject = metaInputs.subject.value;
    model.meta.time = metaInputs.time.value;
    model.meta.marks = metaInputs.marks.value;
  }

  // section render
  function renderSections(){
    cont.innerHTML = '';
    model.sections.forEach((sec, si) => {
      const el = document.createElement('div');
      el.className = 'section';
      el.dataset.id = sec.id;
      el.innerHTML = `
        <div class="section-header">
          <div>
            <div class="section-title">${si+1}. ${sec.title || (sec.type.toUpperCase())}</div>
            <div class="section-type">${sec.type}</div>
          </div>
          <div class="section-controls">
            <button class="btn btn-primary btn-small" data-action="add-item">+ Add Item</button>
            <button class="btn btn-danger btn-small" data-action="remove-section">Remove</button>
          </div>
        </div>
        <input type="text" class="section-title-input" placeholder="Section title (optional)" value="${escapeHtml(sec.title || '')}">
        <div class="section-items"></div>
      `;
      // items container
      const itemsC = el.querySelector('.section-items');
      sec.items.forEach((it, idx) => {
        const itemDiv = document.createElement('div');
        itemDiv.className = 'item';

        if (sec.type === 'mcq') {
          itemDiv.innerHTML = `
            <div class="item-question">
              <input type="text" class="qtext" placeholder="Question text" value="${escapeHtml(it.q || '')}">
              <div class="mcq-options">
                <div class="mcq-option">
                  <label>A:</label>
                  <input type="text" class="opt0" placeholder="Option A" value="${escapeHtml((it.options && it.options[0])||'')}">
                </div>
                <div class="mcq-option">
                  <label>B:</label>
                  <input type="text" class="opt1" placeholder="Option B" value="${escapeHtml((it.options && it.options[1])||'')}">
                </div>
                <div class="mcq-option">
                  <label>C:</label>
                  <input type="text" class="opt2" placeholder="Option C" value="${escapeHtml((it.options && it.options[2])||'')}">
                </div>
                <div class="mcq-option">
                  <label>D:</label>
                  <input type="text" class="opt3" placeholder="Option D" value="${escapeHtml((it.options && it.options[3])||'')}">
                </div>
              </div>
            </div>
            <div class="item-controls">
              <button class="btn btn-danger btn-small" data-action="remove-item">‚úñ</button>
            </div>
          `;
        } else if (sec.type === 'short' || sec.type === 'long') {
          itemDiv.innerHTML = `
            <div class="item-question">
              <input type="text" class="qtext" placeholder="Question text" value="${escapeHtml(it.q || '')}">
            </div>
            <div class="item-marks">
              <input type="text" class="marks" placeholder="Marks" value="${escapeHtml(it.marks||'')}">
            </div>
            <div class="item-controls">
              <button class="btn btn-danger btn-small" data-action="remove-item">‚úñ</button>
            </div>
          `;
        } else if (sec.type === 'match') {
          itemDiv.innerHTML = `
            <div class="item-question">
              <input type="text" class="qtext" placeholder="Question/Left side" value="${escapeHtml(it.left||'')}">
            </div>
            <div class="item-marks">
              <input type="text" class="anstext" placeholder="Answer/Right side" value="${escapeHtml(it.right||'')}">
            </div>
            <div class="item-controls">
              <button class="btn btn-danger btn-small" data-action="remove-item">‚úñ</button>
            </div>
          `;
        } else if (sec.type === 'fill') {
          itemDiv.innerHTML = `
            <div class="item-question">
              <input type="text" class="qtext" placeholder="Question with ______ for blanks" value="${escapeHtml(it.q || '')}">
            </div>
            <div class="item-controls">
              <button class="btn btn-danger btn-small" data-action="remove-item">‚úñ</button>
            </div>
          `;
        }
        itemsC.appendChild(itemDiv);
      });

      // attach events
      el.querySelector('.section-title-input').addEventListener('input', e => {
        sec.title = e.target.value;
        saveModelToLocal();
      });

      el.addEventListener('click', e => {
        const a = e.target.dataset.action;
        if (a === 'add-item') {
          addItemToSection(sec.id);
        } else if (a === 'remove-section') {
          model.sections = model.sections.filter(s => s.id !== sec.id);
          saveModelToLocal();
          renderSections();
        } else if (a === 'remove-item') {
          // find parent item index
          const itemDiv = e.target.closest('.item');
          const idx = Array.from(itemsC.children).indexOf(itemDiv);
          if (idx > -1) {
            sec.items.splice(idx,1);
            saveModelToLocal();
            renderSections();
          }
        }
      });

      // live sync on change for item fields
      el.addEventListener('input', e => {
        const itemDiv = e.target.closest('.item');
        if (!itemDiv) return;
        const idx = Array.from(itemsC.children).indexOf(itemDiv);
        if (idx === -1) return;
        const it = sec.items[idx];
        if (!it) return;

        if (sec.type === 'mcq') {
          it.q = itemDiv.querySelector('.qtext').value;
          it.options = [
            itemDiv.querySelector('.opt0').value,
            itemDiv.querySelector('.opt1').value,
            itemDiv.querySelector('.opt2').value,
            itemDiv.querySelector('.opt3').value,
          ];
        } else if (sec.type === 'short' || sec.type === 'long') {
          it.q = itemDiv.querySelector('.qtext').value;
          it.marks = itemDiv.querySelector('.marks').value;
        } else if (sec.type === 'match') {
          it.left = itemDiv.querySelector('.qtext').value;
          it.right = itemDiv.querySelector('.anstext').value;
        } else if (sec.type === 'fill') {
          it.q = itemDiv.querySelector('.qtext').value;
        }
        saveModelToLocal();
      });

      cont.appendChild(el);
    });
  }

  function addSection(type){
    const newSec = {
      id: uid(),
      type: type,
      title: '',
      items: []
    };

    // seed with one sample item
    if (type === 'mcq') newSec.items.push({q:'', options:['','','','']});
    else if (type === 'short') newSec.items.push({q:'', marks:''});
    else if (type === 'long') newSec.items.push({q:'', marks:''});
    else if (type === 'match') newSec.items.push({left:'', right:''});
    else if (type === 'fill') newSec.items.push({q:''});

    model.sections.push(newSec);
    saveModelToLocal();
    renderSections();
  }

  function addItemToSection(secId){
    const s = model.sections.find(x => x.id === secId);
    if (!s) return;

    if (s.type === 'mcq') s.items.push({q:'', options:['','','','']});
    else if (s.type === 'short') s.items.push({q:'', marks:''});
    else if (s.type === 'long') s.items.push({q:'', marks:''});
    else if (s.type === 'match') s.items.push({left:'', right:''});
    else if (s.type === 'fill') s.items.push({q:''});

    saveModelToLocal();
    renderSections();
  }

  // local storage
  function saveModelToLocal(){
    collectMetaFromInputs();
    localStorage.setItem(STORAGE_KEY, JSON.stringify(model));
    flash('Saved successfully ‚úÖ');
  }

  function loadModelFromLocal(){
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) { flash('No saved exam found'); return; }
    try {
      model = JSON.parse(raw);
      bindMetaToInputs();
      renderSections();
      flash('Loaded successfully ‚úÖ');
    } catch(e){
      flash('Invalid saved data');
    }
  }

  function clearAll(){
    if (!confirm('Clear all sections and metadata?')) return;
    model = {meta:{school:'',exam:'',subject:'',time:'',marks:''}, sections:[]};
    localStorage.removeItem(STORAGE_KEY);
    bindMetaToInputs();
    renderSections();
    previewArea.style.display='none';
  }

  // preview / export
  function buildExamHtml(options = {forPrint: false}){
    collectMetaFromInputs();
    const meta = model.meta;
    const parts = [];

    parts.push(`<div style="font-family:Arial,Helvetica,sans-serif;color:#111;line-height:1.4">`);

    if (options.forPrint) {
      // Compact layout for printing
      parts.push(`<div style="text-align:center;margin-bottom:12px">
        <div style="font-size:18px;font-weight:700">${escapeHtml(meta.school||'')}</div>
        <div style="font-size:14px;margin-top:4px">${escapeHtml(meta.exam||'')} ‚Äî ${escapeHtml(meta.subject||'')}</div>
        <div style="font-size:12px;margin-top:2px">${escapeHtml(meta.time||'')} | Total Marks: ${escapeHtml(meta.marks||'')}</div>
      </div>`);
      parts.push('<hr style="border:none;border-top:1px solid #ddd;margin:8px 0 16px">');
    } else {
      // Regular preview layout
      parts.push(`<div style="text-align:center;margin-bottom:20px">
        <div style="font-size:20px;font-weight:700">${escapeHtml(meta.school||'')}</div>
        <div style="font-size:16px;margin-top:6px">${escapeHtml(meta.exam||'')} ‚Äî ${escapeHtml(meta.subject||'')}</div>
        <div style="font-size:14px;margin-top:6px">${escapeHtml(meta.time||'')} | Total Marks: ${escapeHtml(meta.marks||'')}</div>
      </div>`);
      parts.push('<hr style="border:none;border-top:1px solid #ddd;margin:10px 0 20px">');
    }

    model.sections.forEach((s, si) => {
      if (options.forPrint) {
        parts.push(`<div style="margin-bottom:12px"><strong>${si+1}. ${escapeHtml(s.title || s.type.toUpperCase())}</strong></div>`);
      } else {
        parts.push(`<div style="margin-bottom:16px"><strong>${si+1}. ${escapeHtml(s.title || s.type.toUpperCase())}</strong></div>`);
      }

      if (s.type === 'mcq') {
        s.items.forEach((it, i) => {
          if (options.forPrint) {
            parts.push(`<div style="margin:6px 0">${si+1}.${i+1} ${escapeHtml(it.q || '')}</div>`);
            parts.push(`<div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;margin:6px 0 12px">`);
          } else {
            parts.push(`<div style="margin:8px 0">${si+1}.${i+1} ${escapeHtml(it.q || '')}</div>`);
            parts.push(`<div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin:8px 0 16px">`);
          }
          parts.push(`<div>A. ${escapeHtml((it.options&&it.options[0])||'')}</div>`);
          parts.push(`<div>B. ${escapeHtml((it.options&&it.options[1])||'')}</div>`);
          parts.push(`<div>C. ${escapeHtml((it.options&&it.options[2])||'')}</div>`);
          parts.push(`<div>D. ${escapeHtml((it.options&&it.options[3])||'')}</div>`);
          parts.push(`</div>`);
        });
      } else if (s.type === 'short' || s.type === 'long') {
        s.items.forEach((it, i) => {
          if (options.forPrint) {
            parts.push(`<div style="display:flex;justify-content:space-between;margin:6px 0">
              <div>${si+1}.${i+1} ${escapeHtml(it.q || '')}</div>
              <div style="font-size:11px;color:#666">(${escapeHtml(it.marks||'')} marks)</div>
            </div>`);
          } else {
            parts.push(`<div style="display:flex;justify-content:space-between;margin:8px 0">
              <div>${si+1}.${i+1} ${escapeHtml(it.q || '')}</div>
              <div style="font-size:13px;color:#666">(${escapeHtml(it.marks||'')} marks)</div>
            </div>`);
          }
        });
      } else if (s.type === 'match') {
        if (options.forPrint) {
          parts.push('<table style="width:100%;border-collapse:collapse;margin:6px 0">');
        } else {
          parts.push('<table style="width:100%;border-collapse:collapse;margin:8px 0">');
        }
        s.items.forEach((it, i) => {
          parts.push(`<tr>
            <td style="padding:4px;border-bottom:1px solid #f0f0f0;width:45%">${escapeHtml(it.left||'')}</td>
            <td style="padding:4px;border-bottom:1px solid #f0f0f0;width:10%"> </td>
            <td style="padding:4px;border-bottom:1px solid #f0f0f0">${escapeHtml(it.right||'')}</td>
          </tr>`);
        });
        parts.push('</table>');
      } else if (s.type === 'fill') {
        s.items.forEach((it, i) => {
           // Replace underscores with a blank line for printing
          const displayText = escapeHtml(it.q || '').replace(/_{3,}/g, '__________');
          if (options.forPrint) {
            parts.push(`<div style="margin:6px 0">${si+1}.${i+1} ${displayText}</div>`);
          } else {
            parts.push(`<div style="margin:8px 0">${si+1}.${i+1} ${displayText}</div>`);
          }
        });
      }
    });

    // footer
    if (options.forPrint) {
      parts.push('<div style="margin-top:20px;font-size:12px;color:#666">Signature: ___________________ &nbsp;&nbsp; Date: __________</div>');
    } else {
      parts.push('<div style="margin-top:30px;font-size:14px;color:#666">Signature: ___________________ &nbsp;&nbsp; Date: __________</div>');
    }
    parts.push('</div>');

    return parts.join('');
  }

  function showPreview(){
    const html = buildExamHtml({forPrint:false});
    previewOutput.innerHTML = html;
    previewArea.style.display='block';
    window.scrollTo({top:document.body.scrollHeight,behavior:'smooth'});
  }

  function exportPdf(){
    const htmlContent = buildExamHtml({forPrint:true});
    const printWindow = window.open('', '_blank');

    printWindow.document.write(`
      <!DOCTYPE html>
      <html>
      <head>
        <title>${model.meta.exam || 'Exam'}</title>
        <style>
          body { 
            font-family: Arial, sans-serif; 
            padding: 10px; 
            line-height: 1.3; 
            color: #000; 
            max-width: 800px;
            margin: 0 auto;
            font-size: 13px;
          }
          ul { margin: 6px 0; padding-left: 18px; }
          table { width: 100%; border-collapse: collapse; margin: 6px 0; }
          td { padding: 4px; border-bottom: 1px solid #eee; }
          hr { margin: 10px 0; }
          @media print {
            body { 
              padding: 10mm;
              font-size: 12px;
              line-height: 1.2;
            }
            @page {
              margin: 10mm;
            }
          }
        </style>
      </head>
      <body>
        ${htmlContent}
      </body>
      </html>
    `);

    printWindow.document.close();

    // Wait for content to load before printing
    setTimeout(() => {
      printWindow.print();
    }, 250);
  }

  // helper UI feedback
  function flash(msg){
    const el = document.createElement('div');
    el.textContent = msg;
    el.style.position = 'fixed';
    el.style.right = '20px';
    el.style.bottom = '20px';
    el.style.background = '#10b981';
    el.style.color = '#fff';
    el.style.padding = '10px 16px';
    el.style.borderRadius = '6px';
    el.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.1)';
    el.style.zIndex = '1000';
    el.style.transition = 'opacity 0.3s';
    document.body.appendChild(el);

    setTimeout(() => {
      el.style.opacity = '0';
      setTimeout(() => el.remove(), 300);
    }, 2000);
  }

  // utils
  function escapeHtml(s = ''){
    return String(s)
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#039;');
  }

  // initial bind
  document.getElementById('btn-add').addEventListener('click', () => {
    const t = document.getElementById('add-type').value;
    addSection(t);
  });

  document.getElementById('btn-save').addEventListener('click', saveModelToLocal);
  document.getElementById('btn-load').addEventListener('click', loadModelFromLocal);
  document.getElementById('btn-clear').addEventListener('click', clearAll);
  document.getElementById('btn-preview').addEventListener('click', showPreview);
  document.getElementById('btn-export-pdf').addEventListener('click', exportPdf);

  // load existing on open
  (function init(){
    const raw = localStorage.getItem(STORAGE_KEY);
    if (raw) {
      try { 
        model = JSON.parse(raw); 
        flash('Previous exam loaded ‚úÖ');
      } catch(e){ 
        // ignore
      }
    }
    bindMetaToInputs();
    renderSections();
  })();

})();
</script>
</body>
</html>