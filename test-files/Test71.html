<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Student Transactions & Multi-Template Receipt Printing</title>
  <!-- Bootstrap CSS for styling -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    body { padding-top: 20px; }
  </style>
</head>
<body>
  <div class="container">
    <h3 class="mb-4">Student Transactions</h3>
    <table class="table table-bordered" id="transactionsTable">
      <thead>
        <tr>
          <th>Roll No</th>
          <th>Name</th>
          <th>Class</th>
          <th>Transaction ID</th>
          <th>Amount Paid</th>
          <th>Mode</th>
          <th>Date & Time</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="transactions-body">
        <!-- Rows will be generated by JavaScript -->
      </tbody>
    </table>
  </div>

  <!-- Modal for Template Selection -->
  <div class="modal fade" id="templateModal" tabindex="-1" aria-labelledby="templateModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="templateModalLabel">Select Receipt Template</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="closeModal()">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <p>Select one of the following receipt templates:</p>
          <div class="list-group">
            <button type="button" class="list-group-item list-group-item-action" onclick="printTemplate1(selectedIndex)">
              Template 1: Detailed Receipt with Signature Required
            </button>
            <button type="button" class="list-group-item list-group-item-action" onclick="printTemplate2(selectedIndex)">
              Template 2: Duplicate Receipt (Half Page for School & Parent)
            </button>
            <button type="button" class="list-group-item list-group-item-action" onclick="printTemplate3(selectedIndex)">
              Template 3: Minimal Receipt
            </button>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="closeModal()">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- jQuery, Popper.js, and Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

  <script>
    // Dummy transaction data – replace with Firebase data later.
    const transactions = [
      {
        rollNo: "53",
        studentName: "Aayush",
        class: "9",
        transactionId: "gwbI79kvCjMgIhRg2N6S",
        amountPaid: 1000,
        mode: "Cash",
        dateTime: "3/14/2025 8:04 PM",
        notes: "Thank you for your payment. Please keep this receipt for your records."
      },
      {
        rollNo: "78",
        studentName: "Fadrick",
        class: "10",
        transactionId: "txn12345",
        amountPaid: 2000,
        mode: "UPI",
        dateTime: "3/14/2025 9:00 PM",
        notes: "Payment received successfully. We appreciate your prompt payment."
      }
    ];

    // Dummy school details (static)
    const schoolDetails = {
      schoolName: "ABC Public School",
      address: "123 Main Street, City, Country",
      contact: "0123456789",
      email: "info@abcpublicschool.com"
    };

    let selectedIndex = null; // To store which transaction's receipt to print

    // Populate table with dummy transactions
    function populateTable() {
      const tbody = document.getElementById("transactions-body");
      tbody.innerHTML = "";
      transactions.forEach((tx, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${tx.rollNo}</td>
          <td>${tx.studentName}</td>
          <td>${tx.class}</td>
          <td>${tx.transactionId}</td>
          <td>₹${tx.amountPaid}</td>
          <td>${tx.mode}</td>
          <td>${tx.dateTime}</td>
          <td><button class="btn btn-primary" onclick="chooseTemplate(${index})">Print Receipt</button></td>
        `;
        tbody.appendChild(row);
      });
    }

    // Open the modal for template selection
    function chooseTemplate(index) {
      selectedIndex = index;
      $('#templateModal').modal('show');
    }

    function closeModal() {
      $('#templateModal').modal('hide');
    }

    // Template 1 – Detailed Receipt with Signature Required
    function printTemplate1(index) {
      const tx = transactions[index];
      const printHTML = `
        <!DOCTYPE html>
        <html>
        <head>
          <meta charset="UTF-8">
          <title>Receipt - ${tx.studentName}</title>
          <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
          <style>
            body { padding: 20px; font-family: Arial, sans-serif; }
            .receipt-container { max-width: 800px; margin: auto; border: 1px solid #000; padding: 20px; }
            .header, .footer { text-align: center; }
            .header h2 { margin-bottom: 5px; }
            .header p { margin: 0; }
            .details { margin-top: 20px; }
            .details h4 { border-bottom: 1px solid #000; padding-bottom: 5px; }
            .details p { margin: 5px 0; }
            .signature { margin-top: 20px; }
            .signature p { border-top: 1px solid #000; width: 200px; margin: 0 auto; text-align: center; }
            .notes { margin-top: 20px; font-style: italic; }
            .action-buttons { margin-top: 20px; text-align: center; }
            @media print {
              .action-buttons { display: none; }
            }
          </style>
        </head>
        <body>
          <div class="receipt-container">
            <div class="header">
              <h2>${schoolDetails.schoolName}</h2>
              <p>${schoolDetails.address}</p>
              <p>Contact: ${schoolDetails.contact} | Email: ${schoolDetails.email}</p>
            </div>
            <div class="details">
              <h4>Student Details</h4>
              <p><strong>Roll No:</strong> ${tx.rollNo}</p>
              <p><strong>Name:</strong> ${tx.studentName}</p>
              <p><strong>Class:</strong> ${tx.class}</p>
            </div>
            <div class="details">
              <h4>Transaction Details</h4>
              <p><strong>Transaction ID:</strong> ${tx.transactionId}</p>
              <p><strong>Amount Paid:</strong> ₹${tx.amountPaid}</p>
              <p><strong>Mode:</strong> ${tx.mode}</p>
              <p><strong>Date & Time:</strong> ${tx.dateTime}</p>
            </div>
            <div class="notes">
              <p>${tx.notes}</p>
            </div>
            <div class="signature">
              <p>Signature Required</p>
            </div>
            <div class="footer">
              <p>Thank you for your payment!</p>
              <p>This is a computer-generated receipt.</p>
            </div>
            <div class="action-buttons">
              <button class="btn btn-success" onclick="window.print()">Save & Print</button>
              <button class="btn btn-secondary" onclick="window.close()">Close</button>
            </div>
          </div>
        </body>
        </html>
      `;
      const printWindow = window.open("", "_blank", "width=900,height=700");
      printWindow.document.open();
      printWindow.document.write(printHTML);
      printWindow.document.close();
      closeModal();
    }

    // Template 2 – Duplicate Receipt (Half Page: School & Parent)
    function printTemplate2(index) {
      const tx = transactions[index];
      // Create one receipt part which will be duplicated on the same page
      const receiptPart = `
        <div style="border: 1px solid #000; padding: 10px; margin-bottom: 10px;">
          <div style="text-align: center;">
            <h4>${schoolDetails.schoolName}</h4>
            <p>${schoolDetails.address}</p>
            <p>Contact: ${schoolDetails.contact} | Email: ${schoolDetails.email}</p>
          </div>
          <hr>
          <div>
            <p><strong>Roll No:</strong> ${tx.rollNo} | <strong>Name:</strong> ${tx.studentName} | <strong>Class:</strong> ${tx.class}</p>
            <p><strong>Txn ID:</strong> ${tx.transactionId} | <strong>Amount:</strong> ₹${tx.amountPaid}</p>
            <p><strong>Mode:</strong> ${tx.mode} | <strong>Date & Time:</strong> ${tx.dateTime}</p>
          </div>
          <div style="text-align: center; margin-top: 10px;">
            <p>Signature Required</p>
          </div>
        </div>
      `;
      const printHTML = `
        <!DOCTYPE html>
        <html>
        <head>
          <meta charset="UTF-8">
          <title>Duplicate Receipt - ${tx.studentName}</title>
          <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
          <style>
            body { padding: 20px; font-family: Arial, sans-serif; }
            .receipt-container { max-width: 800px; margin: auto; }
            .action-buttons { margin-top: 20px; text-align: center; }
            @media print {
              .action-buttons { display: none; }
            }
          </style>
        </head>
        <body>
          <div class="receipt-container">
            ${receiptPart}
            ${receiptPart}
          </div>
          <div class="action-buttons">
            <button class="btn btn-success" onclick="window.print()">Save & Print</button>
            <button class="btn btn-secondary" onclick="window.close()">Close</button>
          </div>
        </body>
        </html>
      `;
      const printWindow = window.open("", "_blank", "width=900,height=700");
      printWindow.document.open();
      printWindow.document.write(printHTML);
      printWindow.document.close();
      closeModal();
    }

    // Template 3 – Minimal Receipt (Short Info)
    function printTemplate3(index) {
      const tx = transactions[index];
      const printHTML = `
        <!DOCTYPE html>
        <html>
        <head>
          <meta charset="UTF-8">
          <title>Minimal Receipt - ${tx.studentName}</title>
          <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
          <style>
            body { padding: 20px; font-family: Arial, sans-serif; }
            .receipt-container { max-width: 600px; margin: auto; border: 1px solid #000; padding: 15px; }
            .header { text-align: center; margin-bottom: 10px; }
            .details p { margin: 5px 0; }
            .action-buttons { margin-top: 20px; text-align: center; }
            @media print {
              .action-buttons { display: none; }
            }
          </style>
        </head>
        <body>
          <div class="receipt-container">
            <div class="header">
              <h4>${schoolDetails.schoolName}</h4>
            </div>
            <div class="details">
              <p><strong>${tx.studentName}</strong> (Roll No: ${tx.rollNo})</p>
              <p>Class: ${tx.class}</p>
              <p>Txn ID: ${tx.transactionId} | ₹${tx.amountPaid}</p>
              <p>${tx.mode} | ${tx.dateTime}</p>
            </div>
            <div class="action-buttons">
              <button class="btn btn-success" onclick="window.print()">Save & Print</button>
              <button class="btn btn-secondary" onclick="window.close()">Close</button>
            </div>
          </div>
        </body>
        </html>
      `;
      const printWindow = window.open("", "_blank", "width=900,height=700");
      printWindow.document.open();
      printWindow.document.write(printHTML);
      printWindow.document.close();
      closeModal();
    }

    // Populate table on page load
    window.onload = populateTable;
  </script>
</body>
</html>