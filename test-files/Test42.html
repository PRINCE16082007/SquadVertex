<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>LightExam ‚Äî Minimal Exam Builder</title>
<style>
  :root{font-family:Inter,system-ui,Segoe UI,Arial; --gap:10px}
  body{margin:18px;background:#f7f8fb;color:#111}
  .wrap{max-width:1000px;margin:0 auto;padding:18px;background:linear-gradient(180deg,#fff,#fbfdff);border-radius:10px;box-shadow:0 6px 28px rgba(15,20,40,0.06)}
  h1{margin:0 0 8px;font-size:20px}
  .row{display:flex;gap:var(--gap);flex-wrap:wrap}
  label{font-size:12px;color:#555}
  input[type=text],select,textarea{padding:8px;border-radius:6px;border:1px solid #dde5f0;background:#fff;min-width:160px}
  textarea{min-height:60px;resize:vertical}
  button{padding:8px 12px;border-radius:8px;border:0;background:#0b5fff;color:#fff;cursor:pointer}
  .muted{color:#666;font-size:13px}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .section{border:1px dashed #e0e7ff;padding:10px;border-radius:8px;margin-top:10px;background:#fff}
  .sec-items{margin-top:8px}
  .item{display:flex;gap:8px;align-items:flex-start;margin-bottom:8px}
  .item input[type=text]{flex:1}
  .small{font-size:12px;padding:6px 8px}
  .preview{border-top:1px solid #eee;margin-top:12px;padding-top:12px}
  .preview-output{background:#fff;padding:18px;border-radius:8px;box-shadow:0 4px 10px rgba(18,20,40,0.03)}
  .topbar{display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap}
  .danger{background:#ff5a5a}
  .secondary{background:#6b7280}
  .flex{display:flex;gap:8px}
  select.small{padding:6px}
  .watermark{position:absolute;right:10px;top:6px;opacity:.06;font-weight:800;font-size:52px;transform:rotate(-25deg);pointer-events:none}
</style>
</head>
<body>
<div class="wrap">
  <div class="topbar">
    <h1>LightExam ‚Äî Minimal Exam Builder</h1>
    <div class="muted">Light, offline, teacher-focused ‚Äî built for quick papers.</div>
  </div>

  <!-- Header meta -->
  <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px;margin-top:12px">
    <div>
      <label>School name</label><br>
      <input id="meta-school" type="text" placeholder="Ex: Modern High School">
    </div>
    <div>
      <label>Exam name</label><br>
      <input id="meta-exam" type="text" placeholder="Ex: Term 1 - Science">
    </div>
    <div>
      <label>Subject</label><br>
      <input id="meta-subject" type="text" placeholder="Ex: Biology">
    </div>
    <div>
      <label>Time / Duration</label><br>
      <input id="meta-time" type="text" placeholder="Ex: 1h 30m">
    </div>
    <div>
      <label>Total marks</label><br>
      <input id="meta-marks" type="text" placeholder="Ex: 80">
    </div>
  </div>

  <div class="controls" style="margin-top:12px">
    <div class="flex">
      <select id="add-type" class="small">
  <option value="mcq">MCQ (Multiple choice)</option>
  <option value="short">Short answer</option>
  <option value="long">Long answer</option>
  <option value="match">Match Columns</option>
  <option value="fill">Fill in the blanks</option>
</select>
      <button id="btn-add">Add Section</button>
    </div>

    <div class="flex" style="margin-left:auto">
      <button id="btn-save" class="small">üíæ Save to localStorage</button>
      <button id="btn-load" class="small secondary">üìÇ Load</button>
      <button id="btn-export-json" class="small">‚ÜØ Export JSON</button>
      <button id="btn-preview" class="small">üëÅÔ∏è Preview</button>
      <button id="btn-export-pdf" class="small">üñ® Print as PDF</button>
      <button id="btn-export-doc" class="small">üìÑ Download .doc</button>
      <button id="btn-clear" class="small danger">CLEAR</button>
    </div>
  </div>

  <div id="sections-container" style="margin-top:14px"></div>

  <div class="preview" id="preview-area" style="display:none">
    <h3>Preview</h3>
    <div class="preview-output" id="preview-output"></div>
  </div>

  <div style="margin-top:12px;color:#777;font-size:13px">
    Tip: Save often. Teacher-friendly blocks ‚Äî add, reorder (future), and export. Keep it lightweight.
  </div>
</div>

<script>
(function(){
  // util
  const uid = () => 's-' + Math.random().toString(36).slice(2,9);
  const STORAGE_KEY = 'examBuilderData';

  // initial model
  let model = {
    meta: {school:'', exam:'', subject:'', time:'', marks:''},
    sections: []
  };

  // DOM refs
  const cont = document.getElementById('sections-container');
  const metaInputs = {
    school: document.getElementById('meta-school'),
    exam: document.getElementById('meta-exam'),
    subject: document.getElementById('meta-subject'),
    time: document.getElementById('meta-time'),
    marks: document.getElementById('meta-marks')
  };
  const previewArea = document.getElementById('preview-area');
  const previewOutput = document.getElementById('preview-output');

  // load saved meta to inputs
  function bindMetaToInputs(){
    metaInputs.school.value = model.meta.school || '';
    metaInputs.exam.value = model.meta.exam || '';
    metaInputs.subject.value = model.meta.subject || '';
    metaInputs.time.value = model.meta.time || '';
    metaInputs.marks.value = model.meta.marks || '';
  }
  function collectMetaFromInputs(){
    model.meta.school = metaInputs.school.value;
    model.meta.exam = metaInputs.exam.value;
    model.meta.subject = metaInputs.subject.value;
    model.meta.time = metaInputs.time.value;
    model.meta.marks = metaInputs.marks.value;
  }

  // section render
  function renderSections(){
    cont.innerHTML = '';
    model.sections.forEach((sec, si) => {
      const el = document.createElement('div');
      el.className = 'section';
      el.dataset.id = sec.id;
      el.innerHTML = `
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <strong>${si+1}. ${sec.title || (sec.type.toUpperCase())}</strong>
            <div class="muted" style="font-size:12px">${sec.type}</div>
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <button class="small" data-action="add-item">+ item</button>
            <button class="small" data-action="remove-section" style="background:#ff7b7b">remove</button>
          </div>
        </div>
        <div style="margin-top:8px">
          <input type="text" class="sec-title" placeholder="Section title (optional)" value="${escapeHtml(sec.title || '')}">
        </div>
        <div class="sec-items"></div>
      `;
      // items container
      const itemsC = el.querySelector('.sec-items');
      sec.items.forEach((it, idx) => {
        const itemDiv = document.createElement('div');
        itemDiv.className = 'item';
        if (sec.type === 'mcq') {
  itemDiv.innerHTML = `
    <input type="text" class="qtext" placeholder="Question text" value="${escapeHtml(it.q || '')}">
    <input type="text" class="opt0" placeholder="Option A" value="${escapeHtml((it.options && it.options[0])||'')}">
    <input type="text" class="opt1" placeholder="Option B" value="${escapeHtml((it.options && it.options[1])||'')}">
    <input type="text" class="opt2" placeholder="Option C" value="${escapeHtml((it.options && it.options[2])||'')}">
    <input type="text" class="opt3" placeholder="Option D" value="${escapeHtml((it.options && it.options[3])||'')}">
    <button class="small" data-action="remove-item">‚úñ</button>
  `;
} else if (sec.type === 'short' || sec.type === 'long') {
  itemDiv.innerHTML = `
    <input type="text" class="qtext" placeholder="Question text" value="${escapeHtml(it.q || '')}">
    <button class="small" data-action="remove-item">‚úñ</button>
  `;
} else if (sec.type === 'match') {
  itemDiv.innerHTML = `
    <input type="text" class="qtext" placeholder="LHS" value="${escapeHtml(it.left||'')}">
    <input type="text" class="anstext" placeholder="RHS" value="${escapeHtml(it.right||'')}">
    <button class="small" data-action="remove-item">‚úñ</button>
  `;
} else if (sec.type === 'fill') {
  itemDiv.innerHTML = `
    <input type="text" class="qtext" placeholder="Fill in the blank question" value="${escapeHtml(it.q||'')}">
    <button class="small" data-action="remove-item">‚úñ</button>
  `;
}
        itemsC.appendChild(itemDiv);
      });

      // attach events
      el.querySelector('.sec-title').addEventListener('input', e => {
        sec.title = e.target.value;
      });
      el.addEventListener('click', e => {
        const a = e.target.dataset.action;
        if (a === 'add-item') {
          addItemToSection(sec.id);
        } else if (a === 'remove-section') {
          model.sections = model.sections.filter(s=>s.id !== sec.id);
          saveModelToLocal();
          renderSections();
        } else if (a === 'remove-item') {
          // find parent item index
          const itemDiv = e.target.closest('.item');
          const idx = Array.from(itemsC.children).indexOf(itemDiv);
          if (idx > -1) {
            sec.items.splice(idx,1);
            saveModelToLocal();
            renderSections();
          }
        }
      });

      // small live sync on change for item fields
      el.addEventListener('input', e => {
        const itemDiv = e.target.closest('.item');
        if (!itemDiv) return;
        const idx = Array.from(itemsC.children).indexOf(itemDiv);
        if (idx === -1) return;
        const it = sec.items[idx];
        if (!it) return;
        if (sec.type === 'mcq') {
          it.q = itemDiv.querySelector('.qtext').value;
          it.options = [
            itemDiv.querySelector('.opt0').value,
            itemDiv.querySelector('.opt1').value,
            itemDiv.querySelector('.opt2').value,
            itemDiv.querySelector('.opt3').value,
          ];
          it.answer = parseInt(itemDiv.querySelector('.ans').value||0,10);
        } else if (sec.type === 'short' || sec.type === 'long') {
          it.q = itemDiv.querySelector('.qtext').value;
          it.marks = itemDiv.querySelector('.marks').value;
        } else if (sec.type === 'match') {
          it.left = itemDiv.querySelector('.qtext').value;
          it.right = itemDiv.querySelector('.anstext').value;
        }
        saveModelToLocal();
      });

      cont.appendChild(el);
    });
  }

  function addSection(type){
    const newSec = {
      id: uid(),
      type: type,
      title: '',
      items: []
    };
    // seed with one sample item
    if (type === 'mcq') newSec.items.push({q:'', options:['','','','']});
else if (type === 'short') newSec.items.push({q:''});
else if (type === 'long') newSec.items.push({q:''});
else if (type === 'match') newSec.items.push({left:'', right:''});
else if (type === 'fill') newSec.items.push({q:''});
    model.sections.push(newSec);
    saveModelToLocal();
    renderSections();
  }

  function addItemToSection(secId){
    const s = model.sections.find(x=>x.id===secId);
    if (!s) return;
    if (s.type === 'mcq') s.items.push({q:'', options:['','','',''], answer:0});
    else if (s.type === 'short') s.items.push({q:'', marks:''});
    else if (s.type === 'long') s.items.push({q:'', marks:''});
    else if (s.type === 'match') s.items.push({left:'', right:''});
    else if (s.type === 'fill') s.items.push({q:''});
    saveModelToLocal();
    renderSections();
  }

  // local storage
  function saveModelToLocal(){
    collectMetaFromInputs();
    localStorage.setItem(STORAGE_KEY, JSON.stringify(model));
    flash('Saved ‚úÖ');
  }
  function loadModelFromLocal(){
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) { flash('No saved exam found'); return; }
    try {
      model = JSON.parse(raw);
      bindMetaToInputs();
      renderSections();
      flash('Loaded ‚úÖ');
    } catch(e){
      flash('Invalid saved data');
    }
  }
  function clearAll(){
    if (!confirm('Clear all sections and metadata?')) return;
    model = {meta:{school:'',exam:'',subject:'',time:'',marks:''}, sections:[]};
    localStorage.removeItem(STORAGE_KEY);
    bindMetaToInputs();
    renderSections();
    previewArea.style.display='none';
  }

  // preview / export
  function buildExamHtml(options={forPrint:false}){
    collectMetaFromInputs();
    const meta = model.meta;
    const parts = [];
    parts.push(`<div style="font-family:Arial,Helvetica,sans-serif;color:#111">`);
    parts.push(`<div style="text-align:center;margin-bottom:14px">
      <div style="font-size:20px;font-weight:700">${escapeHtml(meta.school||'')}</div>
      <div style="font-size:16px;margin-top:4px">${escapeHtml(meta.exam||'')} ‚Äî ${escapeHtml(meta.subject||'')}</div>
      <div style="font-size:13px;margin-top:6px">${escapeHtml(meta.time||'')} | Total Marks: ${escapeHtml(meta.marks||'')}</div>
    </div>`);
    parts.push('<hr style="border:none;border-top:1px solid #ddd;margin:10px 0 18px">');

    model.sections.forEach((s, si) => {
      parts.push(`<div style="margin-bottom:12px"><strong>${si+1}. ${escapeHtml(s.title || s.type.toUpperCase())}</strong></div>`);
      if (s.type === 'mcq') {
        s.items.forEach((it, i) => {
          parts.push(`<div style="margin:6px 0">${si+1}.${i+1} ${escapeHtml(it.q || '')}</div>`);
          parts.push(`<ul style="margin-top:4px;margin-bottom:8px">`+
            `<li>A. ${escapeHtml((it.options&&it.options[0])||'')}</li>`+
            `<li>B. ${escapeHtml((it.options&&it.options[1])||'')}</li>`+
            `<li>C. ${escapeHtml((it.options&&it.options[2])||'')}</li>`+
            `<li>D. ${escapeHtml((it.options&&it.options[3])||'')}</li>`+
          `</ul>`);
        });
      } else if (s.type === 'short') {
  s.items.forEach((it, i) => {
    parts.push(`<div>${si+1}.${i+1}) ${escapeHtml(it.q || '')}</div>`);
  });
} else if (s.type === 'long') {
  s.items.forEach((it, i) => {
    parts.push(`<div>${si+1}.${i+1}) ${escapeHtml(it.q || '')}</div>
                <div style="height:80px;border-bottom:1px dashed #ccc;margin-bottom:6px"></div>`);
  });
} else if (s.type === 'fill') {
  s.items.forEach((it, i) => {
    parts.push(`<div>${si+1}.${i+1}) ${escapeHtml(it.q || '')} ________</div>`);
  });
}
        const maxRows = s.items.length;
        for (let r=0;r<maxRows;r++){
          const it = s.items[r] || {};
          parts.push(`<tr><td style="padding:4px;border-bottom:1px solid #f0f0f0">${escapeHtml(it.left||'')}</td><td style="padding:4px;border-bottom:1px solid #f0f0f0">${escapeHtml(it.right||'')}</td></tr>`);
        }
        parts.push('</table>');
      }
    });

    // footer
    parts.push('<div style="margin-top:24px;font-size:12px;color:#666">Signature: ___________________ &nbsp;&nbsp; Date: __________</div>');
    parts.push('</div>');
    // watermark only for print
    const watermark = options.forPrint ? `<div style="position:fixed;right:10px;top:120px;opacity:.05;font-size:80px;transform:rotate(-30deg);font-weight:800">SCHOOL</div>` : '';
    const html = `<!doctype html><html><head><meta charset="utf-8"><title>Exam</title>
      <style>body{font-family:Arial,Helvetica,sans-serif;padding:30px;color:#111}</style>
      </head><body>${watermark}${parts.join('')}</body></html>`;
    return html;
  }

  function showPreview(){
    const html = buildExamHtml({forPrint:false});
    previewOutput.innerHTML = html.replace(/<!doctype html>.*<body[^>]*>|<\/body><\/html>/gi,'');
    previewArea.style.display='block';
    window.scrollTo({top:document.body.scrollHeight,behavior:'smooth'});
  }

  function exportPdf(){
  const html = buildExamHtml({forPrint:true});
  const w = window.open('', '_blank');
  w.document.open();
  w.document.write(html);
  w.document.close();
  w.focus();
  w.print();
}


  function exportDoc(){
  const html = buildExamHtml({forPrint:false});
  const blob = new Blob(['\ufeff', html], {type: 'application/msword;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = (model.meta.exam || 'exam') + '.doc';
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}


  // helper UI feedback
  function flash(msg){
    const el = document.createElement('div');
    el.textContent = msg;
    el.style.position = 'fixed';
    el.style.right = '18px';
    el.style.bottom = '18px';
    el.style.background = '#0b5fff';
    el.style.color = '#fff';
    el.style.padding = '10px 14px';
    el.style.borderRadius = '8px';
    el.style.boxShadow = '0 6px 20px rgba(11,95,255,0.12)';
    document.body.appendChild(el);
    setTimeout(()=> el.style.opacity = '0.0', 1800);
    setTimeout(()=> el.remove(), 2400);
  }

  // utils
  function escapeHtml(s=''){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

  // initial bind
  document.getElementById('btn-add').addEventListener('click', ()=>{
    const t = document.getElementById('add-type').value;
    addSection(t);
  });
  document.getElementById('btn-save').addEventListener('click', saveModelToLocal);
  document.getElementById('btn-load').addEventListener('click', loadModelFromLocal);
  document.getElementById('btn-clear').addEventListener('click', clearAll);
  document.getElementById('btn-preview').addEventListener('click', showPreview);
  document.getElementById('btn-export-pdf').addEventListener('click', exportPdf);
  document.getElementById('btn-export-doc').addEventListener('click', exportDoc);
  document.getElementById('btn-export-json').addEventListener('click', ()=>{
    collectMetaFromInputs();
    const blob = new Blob([JSON.stringify(model, null, 2)],{type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = (model.meta.exam || 'exam') + '.json';
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  });

  // load existing on open
  (function init(){
    const raw = localStorage.getItem(STORAGE_KEY);
    if (raw) {
      try { model = JSON.parse(raw); } catch(e){ /* ignore */ }
    }
    bindMetaToInputs();
    renderSections();
  })();

})();
</script>
</body>
</html>