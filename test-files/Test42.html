<!doctype html>

<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>LightExam v2 ‚Äî Minimal Exam Builder</title>
<style>
  :root{font-family:Inter,system-ui,Segoe UI,Arial;--gap:8px}
  body{margin:10px;background:#f3f6fb;color:#0b1220;font-size:13px}
  .wrap{max-width:980px;margin:0 auto;padding:12px;background:#fff;border-radius:8px;box-shadow:0 6px 24px rgba(12,18,40,0.04)}
  h1{margin:0 0 6px;font-size:18px}
  .row{display:flex;gap:var(--gap);flex-wrap:wrap}
  label{font-size:12px;color:#555}
  input[type=text],select,textarea{padding:6px;border-radius:6px;border:1px solid #e6eef8;background:#fff;min-width:140px;font-size:13px}
  textarea{min-height:48px;resize:vertical}
  button{padding:7px 10px;border-radius:7px;border:0;background:#0b5fff;color:#fff;cursor:pointer;font-size:13px}
  .muted{color:#666;font-size:12px}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .section{border:1px solid #eef4ff;padding:8px;border-radius:8px;margin-top:10px;background:#fcfeff}
  .sec-items{margin-top:6px}
  .item{display:flex;gap:8px;align-items:center;margin-bottom:6px}
  .item input[type=text]{flex:1;padding:6px;font-size:13px}
  .small{font-size:12px;padding:6px 8px}
  .preview-output{background:#fff;padding:14px;border-radius:6px;box-shadow:0 6px 18px rgba(8,12,24,0.03);font-size:13px}
  .topbar{display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap}
  .danger{background:#ff5a5a}
  .secondary{background:#6b7280}
  .flex{display:flex;gap:8px}
  .watermark{position:absolute;right:10px;top:6px;opacity:.06;font-weight:800;font-size:42px;transform:rotate(-25deg);pointer-events:none}
  /* compact print styles */
  @media print{
    body{background:#fff}
    .wrap{box-shadow:none;padding:6px}
    .no-print{display:none}
    .preview-output{padding:6px}
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="topbar">
    <h1>LightExam v2 ‚Äî Minimal Exam Builder</h1>
    <div class="muted">Compact, offline-first ‚Äî now: fill-in-blanks + no answers anywhere.</div>
  </div>  <!-- Header meta -->  <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:8px;margin-top:10px">
    <div>
      <label>School name</label><br>
      <input id="meta-school" type="text" placeholder="Modern High School">
    </div>
    <div>
      <label>Exam name</label><br>
      <input id="meta-exam" type="text" placeholder="Term 1 - Science">
    </div>
    <div>
      <label>Subject</label><br>
      <input id="meta-subject" type="text" placeholder="Biology">
    </div>
    <div>
      <label>Time</label><br>
      <input id="meta-time" type="text" placeholder="1h 30m">
    </div>
    <div>
      <label>Total marks</label><br>
      <input id="meta-marks" type="text" placeholder="80">
    </div>
  </div>  <div class="controls no-print" style="margin-top:10px">
    <div class="flex">
      <select id="add-type" class="small">
        <option value="mcq">MCQ (Options only)</option>
        <option value="short">Short answer (question only)</option>
        <option value="long">Long answer (question only)</option>
        <option value="match">Match / Pair</option>
        <option value="fill">Fill in the blanks</option>
      </select>
      <button id="btn-add">Add Section</button>
    </div><div class="flex" style="margin-left:auto">
  <button id="btn-save" class="small">üíæ Save</button>
  <button id="btn-load" class="small secondary">üìÇ Load</button>
  <button id="btn-preview" class="small">üëÅ Preview</button>
  <button id="btn-export-pdf" class="small">üñ® Export PDF</button>
  <button id="btn-export-doc" class="small">üìÑ Download .doc</button>
  <button id="btn-export-json" class="small">‚á™ JSON</button>
  <button id="btn-clear" class="small danger">CLEAR</button>
</div>

  </div>  <div id="sections-container" style="margin-top:10px"></div>  <div class="preview" id="preview-area" style="display:none;margin-top:10px">
    <h3 style="margin:6px 0">Preview</h3>
    <div class="preview-output" id="preview-output"></div>
  </div>  <div style="margin-top:10px;color:#666;font-size:12px">Tip: This version prints compactly. Fill-in-blanks supports inserting a quick blank token by pressing the small + button while editing.</div>
</div><script>
(function(){
  const STORAGE_KEY = 'examBuilderData_v2';
  const uid = () => 's-' + Math.random().toString(36).slice(2,9);

  let model = { meta:{school:'',exam:'',subject:'',time:'',marks:''}, sections:[] };

  const cont = document.getElementById('sections-container');
  const metaInputs = {
    school: document.getElementById('meta-school'),
    exam: document.getElementById('meta-exam'),
    subject: document.getElementById('meta-subject'),
    time: document.getElementById('meta-time'),
    marks: document.getElementById('meta-marks')
  };
  const previewArea = document.getElementById('preview-area');
  const previewOutput = document.getElementById('preview-output');

  function bindMeta(){ Object.keys(metaInputs).forEach(k=>metaInputs[k].value = model.meta[k]||''); }
  function collectMeta(){ Object.keys(metaInputs).forEach(k=>model.meta[k]=metaInputs[k].value); }

  function renderSections(){
    cont.innerHTML = '';
    model.sections.forEach((sec, si)=>{
      const el = document.createElement('div');
      el.className = 'section';
      el.dataset.id = sec.id;
      el.innerHTML = `
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <strong style="font-size:14px">${si+1}. ${escapeHtml(sec.title||sec.type.toUpperCase())}</strong>
            <div class="muted" style="font-size:11px">${sec.type}</div>
          </div>
          <div style="display:flex;gap:6px;align-items:center">
            <button class="small" data-action="add-item">+ item</button>
            <button class="small" data-action="remove-section" style="background:#ff7b7b">remove</button>
          </div>
        </div>
        <div style="margin-top:6px">
          <input type="text" class="sec-title" placeholder="Section title (optional)" value="${escapeHtml(sec.title||'')}">
        </div>
        <div class="sec-items"></div>
      `;
      const itemsC = el.querySelector('.sec-items');

      sec.items.forEach((it, idx)=>{
        const itemDiv = document.createElement('div');
        itemDiv.className = 'item';
        if (sec.type === 'mcq'){
          itemDiv.innerHTML = `
            <input class="qtext" type="text" placeholder="Question text" value="${escapeHtml(it.q||'')}">
            <input class="opt0" type="text" placeholder="A" value="${escapeHtml((it.options&&it.options[0])||'')}">
            <input class="opt1" type="text" placeholder="B" value="${escapeHtml((it.options&&it.options[1])||'')}">
            <input class="opt2" type="text" placeholder="C" value="${escapeHtml((it.options&&it.options[2])||'')}">
            <input class="opt3" type="text" placeholder="D" value="${escapeHtml((it.options&&it.options[3])||'')}">
            <button class="small" data-action="remove-item">‚úñ</button>
          `;
        } else if (sec.type === 'short' || sec.type === 'long'){
          itemDiv.innerHTML = `
            <input class="qtext" type="text" placeholder="Question text" value="${escapeHtml(it.q||'')}">
            <button class="small" data-action="remove-item">‚úñ</button>
          `;
        } else if (sec.type === 'match'){
          itemDiv.innerHTML = `
            <input class="qtext" type="text" placeholder="Left (A)" value="${escapeHtml(it.left||'')}">
            <input class="anstext" type="text" placeholder="Right (1)" value="${escapeHtml(it.right||'')}">
            <button class="small" data-action="remove-item">‚úñ</button>
          `;
        } else if (sec.type === 'fill'){
          itemDiv.innerHTML = `
            <input class="qtext" type="text" placeholder="Write question. Use the small + to insert a blank (____)" value="${escapeHtml(it.q||'')}">
            <button class="small" data-action="insert-blank">+blank</button>
            <button class="small" data-action="remove-item">‚úñ</button>
          `;
        }
        itemsC.appendChild(itemDiv);
      });

      // events
      el.querySelector('.sec-title').addEventListener('input', e=> sec.title = e.target.value );
      el.addEventListener('click', e=>{
        const a = e.target.dataset.action;
        if (a === 'add-item') addItemToSection(sec.id);
        else if (a === 'remove-section') { model.sections = model.sections.filter(s=>s.id!==sec.id); saveModel(); renderSections(); }
        else if (a === 'remove-item'){
          const itemDiv = e.target.closest('.item');
          const idx = Array.from(itemsC.children).indexOf(itemDiv);
          if (idx>-1){ sec.items.splice(idx,1); saveModel(); renderSections(); }
        } else if (a === 'insert-blank'){
          const itemDiv = e.target.closest('.item');
          const inp = itemDiv.querySelector('.qtext');
          const cur = inp.value || '';
          inp.value = cur + ' ____ ';
          // trigger input event to save
          inp.dispatchEvent(new Event('input'));
        }
      });

      el.addEventListener('input', e=>{
        const itemDiv = e.target.closest('.item');
        if (!itemDiv) return;
        const idx = Array.from(itemsC.children).indexOf(itemDiv);
        if (idx===-1) return;
        const it = sec.items[idx];
        if (!it) return;
        if (sec.type === 'mcq'){
          it.q = itemDiv.querySelector('.qtext').value;
          it.options = [ itemDiv.querySelector('.opt0').value, itemDiv.querySelector('.opt1').value, itemDiv.querySelector('.opt2').value, itemDiv.querySelector('.opt3').value ];
        } else if (sec.type === 'short' || sec.type === 'long' || sec.type==='fill'){
          it.q = itemDiv.querySelector('.qtext').value;
        } else if (sec.type === 'match'){
          it.left = itemDiv.querySelector('.qtext').value;
          it.right = itemDiv.querySelector('.anstext').value;
        }
        saveModel();
      });

      cont.appendChild(el);
    });
  }

  function addSection(type){
    const sec = { id: uid(), type, title:'', items:[] };
    if (type === 'mcq') sec.items.push({q:'', options:['','','','']});
    else if (type === 'short') sec.items.push({q:''});
    else if (type === 'long') sec.items.push({q:''});
    else if (type === 'match') sec.items.push({left:'', right:''});
    else if (type === 'fill') sec.items.push({q:''});
    model.sections.push(sec); saveModel(); renderSections();
  }

  function addItemToSection(id){ const s = model.sections.find(x=>x.id===id); if(!s) return; if(s.type==='mcq') s.items.push({q:'', options:['','','','']}); else if(s.type==='match') s.items.push({left:'', right:''}); else s.items.push({q:''}); saveModel(); renderSections(); }

  function saveModel(){ collectMeta(); localStorage.setItem(STORAGE_KEY, JSON.stringify(model)); }
  function loadModel(){ const raw = localStorage.getItem(STORAGE_KEY); if(!raw) return; try{ model = JSON.parse(raw); }catch(e){} bindMeta(); renderSections(); }
  function clearAll(){ if(!confirm('Clear all?')) return; model = { meta:{school:'',exam:'',subject:'',time:'',marks:''}, sections:[] }; localStorage.removeItem(STORAGE_KEY); bindMeta(); renderSections(); previewArea.style.display='none'; }

  function buildHtml(forPrint){ collectMeta(); const m = model.meta; let parts = [];
    parts.push(`<div style="font-family:Arial,Helvetica,sans-serif;color:#111;font-size:13px">`);
    parts.push(`<div style="text-align:center;margin-bottom:10px">`+
      `<div style="font-size:16px;font-weight:700">${escapeHtml(m.school||'')}</div>`+
      `<div style="font-size:14px;margin-top:4px">${escapeHtml(m.exam||'')} ‚Äî ${escapeHtml(m.subject||'')}</div>`+
      `<div style="font-size:12px;margin-top:4px">${escapeHtml(m.time||'')} | Total Marks: ${escapeHtml(m.marks||'')}</div>`+
    `</div>`);
    parts.push('<hr style="border:none;border-top:1px solid #e9eef8;margin:6px 0 10px">');

    model.sections.forEach((s, si)=>{
      parts.push(`<div style="margin-bottom:8px"><strong>${si+1}. ${escapeHtml(s.title || s.type.toUpperCase())}</strong></div>`);
      if (s.type === 'mcq'){
        s.items.forEach((it, i)=>{
          parts.push(`<div style="margin:4px 0">${si+1}.${i+1} ${escapeHtml(it.q || '')}</div>`);
          parts.push(`<div style="margin:6px 0 8px;padding-left:12px">`+
            `<div>A. ${escapeHtml((it.options&&it.options[0])||'')}</div>`+
            `<div>B. ${escapeHtml((it.options&&it.options[1])||'')}</div>`+
            `<div>C. ${escapeHtml((it.options&&it.options[2])||'')}</div>`+
            `<div>D. ${escapeHtml((it.options&&it.options[3])||'')}</div>`+
          `</div>`);
        });
      } else if (s.type === 'short' || s.type === 'long'){
        s.items.forEach((it, i)=>{
          parts.push(`<div style="margin:6px 0">${si+1}.${i+1} ${escapeHtml(it.q || '')}</div>`);
        });
      } else if (s.type === 'match'){
        parts.push('<table style="width:100%;border-collapse:collapse;margin:6px 0;font-size:13px">');
        s.items.forEach((it)=>{
          parts.push(`<tr><td style="padding:6px;border-bottom:1px solid #f1f5fb">${escapeHtml(it.left||'')}</td><td style="padding:6px;border-bottom:1px solid #f1f5fb">${escapeHtml(it.right||'')}</td></tr>`);
        });
        parts.push('</table>');
      } else if (s.type === 'fill'){
        s.items.forEach((it,i)=>{
          // render question as-is. teacher can include ____ manually or use the +blank tool in editor
          parts.push(`<div style="margin:6px 0">${si+1}.${i+1} ${escapeHtml(it.q || '')}</div>`);
        });
      }
    });

    parts.push('<div style="margin-top:12px;font-size:12px;color:#666">Signature: ___________________ &nbsp;&nbsp; Date: __________</div>');
    parts.push('</div>');

    // print watermark
    const watermark = forPrint ? `<div style="position:fixed;right:10px;top:120px;opacity:.05;font-size:80px;transform:rotate(-30deg);font-weight:800">SCHOOL</div>` : '';
    return `<!doctype html><html><head><meta charset=\"utf-8\"><title>Exam</title><style>body{font-family:Arial,Helvetica,sans-serif;padding:18px;color:#111}</style></head><body>${watermark}${parts.join('')}</body></html>`;}

function showPreview(){ const html = buildHtml(false); previewOutput.innerHTML = html.replace(/<!doctype html>.<body[^>]>|</body></html>/gi,''); previewArea.style.display='block'; window.scrollTo({top:document.body.scrollHeight,behavior:'smooth'}); }

function exportPdf(){ const html = buildHtml(true); // open new window and wait for load const w = window.open('', '_blank'); if(!w){ alert('Popup blocked. Allow popups for this site to print.'); return; } w.document.open(); w.document.write(html); w.document.close(); // try to print when ready const tryPrint = ()=>{ try{ w.focus(); w.print(); }catch(e){ setTimeout(tryPrint,300); } }; // give browser a moment to render setTimeout(tryPrint,500); }

function exportDoc(){ const html = buildHtml(false); const blob = new Blob([html], {type: 'application/msword'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = ((model.meta.exam||'exam').replace(/\s+/g,'_')||'exam') + '.doc'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); }

// UI handlers document.getElementById('btn-add').addEventListener('click', ()=> addSection(document.getElementById('add-type').value)); document.getElementById('btn-save').addEventListener('click', ()=>{ saveModel(); flash('Saved to localStorage ‚úÖ'); }); document.getElementById('btn-load').addEventListener('click', ()=>{ loadModel(); flash('Loaded ‚úÖ'); }); document.getElementById('btn-clear').addEventListener('click', clearAll); document.getElementById('btn-preview').addEventListener('click', showPreview); document.getElementById('btn-export-pdf').addEventListener('click', exportPdf); document.getElementById('btn-export-doc').addEventListener('click', exportDoc); document.getElementById('btn-export-json').addEventListener('click', ()=>{ collectMeta(); const blob = new Blob([JSON.stringify(model,null,2)],{type:'application/json'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = ((model.meta.exam||'exam').replace(/\s+/g,'_')||'exam') + '.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); });

// flash helper function flash(msg){ const el = document.createElement('div'); el.textContent = msg; el.style.position='fixed'; el.style.right='14px'; el.style.bottom='14px'; el.style.background='#0b5fff'; el.style.color='#fff'; el.style.padding='8px 12px'; el.style.borderRadius='8px'; el.style.boxShadow='0 6px 18px rgba(11,95,255,0.12)'; document.body.appendChild(el); setTimeout(()=> el.style.opacity='0',1400); setTimeout(()=> el.remove(),1800); }

function escapeHtml(s=''){ return String(s).replace(/&/g,'&').replace(/</g,'<').replace(/>/g,'>'); }

// init (function init(){ const raw = localStorage.getItem(STORAGE_KEY); if(raw){ try{ model = JSON.parse(raw); }catch(e){} } bindMeta(); renderSections(); })();

})(); </script>

</body>
</html>