<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>SLN Chat</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
  <style>
    :root { 
      --primary: #6f42c1; 
      --accent:  #ffc107;
      /* background image placeholders */
      --bg-img-dark:   url('');
      --bg-img-candle: url('');
      --bg-img-rain:   url('');
      --bg-img-blank:  url('');
    }
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: var(--bg-img-dark) no-repeat center/cover;
      color: var(--text, #fff);
    }
    body.dark   { --bg-img: var(--bg-img-dark); }
    body.candle { --bg-img: var(--bg-img-candle); }
    body.rain   { --bg-img: var(--bg-img-rain); }
    body.blank  { --bg-img: var(--bg-img-blank); --text: #333; }.header-bar { background: var(--header, rgba(0,0,0,0.5)) !important; }
.mode-banner { text-align:center; padding:.5rem; font-size:.9rem; }
.mode-chat   { background:#198754; color:#fff; }
.mode-ritual { background:#0d6efd; color:#fff; }

.chat-box {
  flex:1; overflow-y:auto; padding:1rem; background:rgba(0,0,0,0.05);
  margin-bottom:4rem;
}
.msg-wrapper { display:flex; align-items:flex-end; margin-bottom:1rem; }
.msg-wrapper.user { justify-content:flex-end; }
.message {
  padding:.75rem 1rem; border-radius:1rem; max-width:75%; word-break:break-word;
  background: var(--input, rgba(0,0,0,0.5)); color: var(--text);
}
.user .message { background: var(--accent); color: #000; }
.avatar { width:36px; height:36px; border-radius:50%; border:2px solid var(--accent); object-fit:cover; margin:0 .5rem; }

.input-area {
  position:fixed; bottom:0; left:0; right:0; background:var(--input, rgba(0,0,0,0.7)); padding:1rem; display:flex; z-index:1000;
}
textarea { resize:none; border-radius:.5rem; border:1px solid #ccc; width:100%; padding:.5rem; font-size:1rem; }
button { transition:transform .2s, box-shadow .2s; }
button:active { transform:scale(.95); box-shadow:0 .5rem 1rem rgba(0,0,0,.2); }

/* Settings disabled */
#settingsBtn, #settingsPanel { display:none; }

  </style>
</head>
<body class="dark">
  <div class="d-flex flex-column" style="height:100vh">
    <div class="header-bar d-flex justify-content-between align-items-center px-4 py-2">
      <div class="d-flex align-items-center gap-2">
        <select id="modeSelect" class="form-select form-select-sm">
          <option value="chat">Chat (Private)</option>
          <option value="ritual">Ritual (Public)</option>
        </select>
      </div>
      <div class="d-flex align-items-center gap-2">
        <select id="langSelect" class="form-select form-select-sm"></select>
        <select id="themeSelect" class="form-select form-select-sm">
          <option value="dark">Night Sky</option>
          <option value="candle">Warm Candle</option>
          <option value="rain">Rain Window</option>
          <option value="blank">Blank Page</option>
        </select>
      </div>
    </div>
    <div id="modeBanner" class="mode-banner mode-chat">Private Chat mode</div>
    <div id="chatBox" class="chat-box flex-grow-1"></div>
    <div class="input-area">
      <textarea id="chatInput" placeholder="Type what you feel..."></textarea>
      <button id="sendBtn" class="btn btn-primary ms-2">Send</button>
    </div>
  </div>  <script>
    // Firebase init
        const firebaseConfig = {
      apiKey: "AIzaSyBV7Jg0BVzeCNQW9oiIiNItnejUsjj2DhA",
      authDomain: "squadvertex2007.firebaseapp.com",
      projectId: "squadvertex2007",
      storageBucket: "squadvertex2007.appspot.com",
      messagingSenderId: "168905083514",
      appId: "1:168905083514:web:c8bbe2ce9f87800a0f09c3"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // User ID
    let userId = localStorage.getItem('sln_userId') || (()=>{
      const id = 'SilentSoul'+Math.floor(Math.random()*1000);
      localStorage.setItem('sln_userId', id);
      return id;
    })();

    // i18n
    const i18n = { en:{ph:'Type what you feel...',send:'Send',chat:'Chat',ritual:'Ritual'}, hi:{ph:'जो महसूस करते हो यहाँ लिखो...',send:'भेजें',chat:'चैट',ritual:'रिचुअल'} };
    const langSelect = document.getElementById('langSelect');
    Object.entries(i18n).forEach(([k,v])=>{ let o=new Option(k.toUpperCase(),k); langSelect.add(o); });
    langSelect.value='en';
    function applyLang(){ let d=i18n[langSelect.value]; chatInput.placeholder=d.ph; sendBtn.textContent=d.send; modeSelect.options[0].text=d.chat+' (Private)'; modeSelect.options[1].text=d.ritual+' (Public)'; }
    langSelect.onchange=applyLang; applyLang();

    // Theme
    const themeSelect=document.getElementById('themeSelect');
    themeSelect.onchange=()=>document.body.className=themeSelect.value;

    // Censor
    const banned=['fuck','shit','damn','bitch','asshole','dick','piss','bastard','crap'];
    function censor(t){ return t.replace(new RegExp(`\\b(${banned.join('|')})\\b`,'gi'),w=>'*'.repeat(w.length)); }

    // Mode listener
    const chatBox=document.getElementById('chatBox');
    const modeSelect=document.getElementById('modeSelect');
    modeSelect.onchange=loadMessages;

    // Welcome flags
    let welcomedPrivate=false, welcomedPublic={};

    function loadMessages(){
      if(modeSelect.value==='chat'){
        if(!welcomedPrivate){ addMessage('EXELIS','Welcome! Feel free to share.',false); welcomedPrivate=true; }
        db.collection('private').doc(userId).collection('messages')
          .orderBy('ts').onSnapshot(snap=>renderMsgs(snap));
      } else {
        db.collection('messages').where('mode','==','ritual')
          .orderBy('ts').onSnapshot(snap=>{
            snap.docChanges().forEach(ch=>{
              if(ch.type==='added' && !welcomedPublic[ch.doc.id]){
                addMessage('EXELIS','Welcome to the chat! You're in a safe space.',false);
                welcomedPublic[ch.doc.id]=true;
              }
            });
            renderMsgs(snap);
          });
      }
    }
    loadMessages();

    function renderMsgs(snap){
      chatBox.innerHTML='';
      snap.forEach(d=>{ const {uid,text}=d.data(); addMessage(uid,censor(text),uid===userId); });
    }

    // Send
    const chatInput=document.getElementById('chatInput');
    const sendBtn=document.getElementById('sendBtn');
    sendBtn.onclick=async()=>{
      let txt=chatInput.value.trim(); if(!txt) return;
      await (modeSelect.value==='chat'
        ? db.collection('private').doc(userId).collection('messages')
        : db.collection('messages'))
        .add({ uid:userId, text:txt, mode:modeSelect.value, ts:firebase.firestore.FieldValue.serverTimestamp() });
      chatInput.value='';
    };
    chatInput.onkeydown=e=>{ if(e.key==='Enter'&&!e.shiftKey){ e.preventDefault(); sendBtn.click(); }};

    function addMessage(uid, text, isUser){
      const w=document.createElement('div'); w.className=`msg-wrapper ${isUser?'user':'ai'}`;
      const img=document.createElement('img'); img.src=`https://ui-avatars.com/api/?name=${uid}&background=ffc107&color=000&size=64`; img.className='avatar';
      const m=document.createElement('div'); m.className='message'; m.textContent=text;
      isUser? w.append(m,img): w.append(img,m);
      chatBox.appendChild(w); chatBox.scrollTop=chatBox.scrollHeight;
    }
  </script></body>
</html>