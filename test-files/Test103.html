<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SLN Chat</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
  <style>
    :root {
      --primary-hue: 260;
      --bs-primary-bg-subtle: hsl(var(--primary-hue), 52%, 16%);
      --bs-border-color: hsl(var(--primary-hue), 30%, 25%);
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Theme System */
    [data-bs-theme="dark"] {
      --bs-body-bg: #1e1e2f;
      --bs-body-color: #e9ecef;
      --header-bg: #2c2c3d;
      --input-bg: #2d2d40;
      --message-bg: #3a3a4d;
      --accent: #ffc107;
    }

    [data-bs-theme="candle"] {
      --bs-body-bg: #3e2f2f;
      --bs-body-color: #f8f0e3;
      --header-bg: #5a4132;
      --input-bg: #7b5e57;
      --message-bg: #6d4f47;
      --accent: #ffab00;
    }

    [data-bs-theme="rain"] {
      --bs-body-bg: #2f3e4f;
      --bs-body-color: #e3f0f8;
      --header-bg: #34566e;
      --input-bg: #4a708a;
      --message-bg: #3e607b;
      --accent: #4dabf7;
    }

    [data-bs-theme="blank"] {
      --bs-body-bg: #fafafa;
      --bs-body-color: #212529;
      --header-bg: #e0e0e0;
      --input-bg: #ffffff;
      --message-bg: #f1f3f5;
      --accent: #7950f2;
    }

    /* Chat Structure */
    .chat-container {
      height: 100vh;
      display: grid;
      grid-template-rows: auto 1fr auto;
      background: var(--bs-body-bg);
      transition: var(--transition);
    }

    .chat-messages {
      overflow-y: auto;
      padding: 1.5rem;
      scroll-behavior: smooth;
    }

    .message-bubble {
      max-width: 75%;
      padding: 1rem 1.25rem;
      border-radius: 1.25rem;
      position: relative;
      opacity: 0;
      transform: translateY(20px);
      animation: messageAppear 0.3s ease-out forwards;
    }

    @keyframes messageAppear {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .user-message {
      background: var(--accent);
      color: #000;
      border-end-end-radius: 4px;
    }

    .ai-message {
      background: var(--message-bg);
      border-end-start-radius: 4px;
    }

    .avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 2px solid var(--accent);
      flex-shrink: 0;
    }

    /* Custom Components */
    .settings-panel {
      width: 280px;
      right: 1rem;
      top: 4rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      transform-origin: top right;
      transition: opacity 0.2s, transform 0.2s;
    }

    .settings-panel.show {
      opacity: 1;
      transform: scale(1);
    }

    .mode-banner {
      font-size: 0.9rem;
      letter-spacing: 0.5px;
      padding: 0.75rem;
      text-transform: uppercase;
      font-weight: 500;
    }

    .chat-input {
      resize: none;
      border-radius: 0.75rem;
      padding-right: 4.5rem !important;
    }

    .send-btn {
      position: absolute;
      bottom: 1.25rem;
      right: 1.25rem;
      width: 42px;
      height: 42px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }
  </style>
</head>
<body>
  <div class="chat-container">
    <!-- Header -->
    <header class="d-flex justify-content-between align-items-center p-3 bg-header">
      <div class="d-flex gap-2 align-items-center">
        <button class="btn btn-sm btn-accent" id="settingsBtn">⚙️</button>
        <select class="form-select form-select-sm bg-input border-accent" id="modeSelect">
          <option value="chat">Chat (Private)</option>
          <option value="ritual">Ritual (Public)</option>
        </select>
      </div>
      <div class="d-flex gap-2 align-items-center">
        <select class="form-select form-select-sm bg-input border-accent" id="langSelect"></select>
        <select class="form-select form-select-sm bg-input border-accent" id="themeSelect">
          <option value="dark">Night Sky</option>
          <option value="candle">Warm Candle</option>
          <option value="rain">Rain Window</option>
          <option value="blank">Blank Page</option>
        </select>
      </div>
    </header>

    <!-- Mode Banner -->
    <div class="mode-banner bg-primary text-white text-center">Private Chat Mode</div>

    <!-- Chat Messages -->
    <main class="chat-messages" id="chatBox"></main>

    <!-- Input Area -->
    <footer class="border-top bg-input p-3 position-relative">
      <div class="position-relative">
        <textarea id="chatInput" class="form-control chat-input bg-input border-accent" 
                 rows="1" placeholder="Type your message..."></textarea>
        <button id="sendBtn" class="btn btn-primary send-btn rounded-circle">↑</button>
      </div>
    </footer>
  </div>

  <!-- Settings Panel -->
  <div class="settings-panel position-fixed bg-header rounded-3 p-3 opacity-0 transform-scale-0" id="settingsPanel">
    <h6 class="text-accent mb-3">Chat Settings</h6>
    <div class="mb-3">
      <label class="form-label text-muted">Auto-delete After</label>
      <input type="number" class="form-control bg-input border-accent" 
             id="ttlInput" min="1" max="48" value="12">
    </div>
    <div class="form-check form-switch">
      <input class="form-check-input" type="checkbox" id="aiReplyToggle" checked>
      <label class="form-check-label text-muted">Enable AI Responses</label>
    </div>
  </div>

  <script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBV7Jg0BVzeCNQW9oiIiNItnejUsjj2DhA",
      authDomain: "squadvertex2007.firebaseapp.com",
      projectId: "squadvertex2007",
      storageBucket: "squadvertex2007.appspot.com",
      messagingSenderId: "168905083514",
      appId: "1:168905083514:web:c8bbe2ce9f87800a0f09c3",
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Localization
    const i18n = {
      en: { placeholder: 'Type what you feel...', send: 'Send', chat: 'Chat', ritual: 'Ritual' },
      hi: { placeholder: 'जो महसूस करते हो यहाँ लिखो...', send: 'भेजें', chat: 'चैट', ritual: 'रिचुअल' }
    };

    // DOM Elements
    const elements = {
      chatInput: document.getElementById('chatInput'),
      sendBtn: document.getElementById('sendBtn'),
      modeSelect: document.getElementById('modeSelect'),
      themeSelect: document.getElementById('themeSelect'),
      settingsBtn: document.getElementById('settingsBtn'),
      settingsPanel: document.getElementById('settingsPanel'),
      modeBanner: document.querySelector('.mode-banner'),
      chatBox: document.getElementById('chatBox'),
      langSelect: document.getElementById('langSelect')
    };

    // Theme Management
    function applyTheme(theme) {
      document.documentElement.setAttribute('data-bs-theme', theme);
    }

    // Language Management
    function setupLanguageSelector() {
      Object.keys(i18n).forEach(lang => {
        const option = document.createElement('option');
        option.value = lang;
        option.textContent = lang.toUpperCase();
        elements.langSelect.appendChild(option);
      });
      elements.langSelect.value = 'en';
    }

    // Message Handling
    function createMessageElement(message, isUser) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `d-flex align-items-end gap-2 mb-3 ${isUser ? 'justify-content-end' : 'justify-content-start'}`;

      const avatar = document.createElement('img');
      avatar.className = 'avatar';
      avatar.src = `https://ui-avatars.com/api/?name=${message.uid}&background=random`;

      const bubble = document.createElement('div');
      bubble.className = `message-bubble ${isUser ? 'user-message' : 'ai-message'}`;
      bubble.textContent = message.text;

      if (isUser) {
        messageDiv.append(bubble, avatar);
      } else {
        messageDiv.append(avatar, bubble);
      }

      return messageDiv;
    }

    // Event Listeners
    function setupEventListeners() {
      elements.themeSelect.addEventListener('change', (e) => applyTheme(e.target.value));
      elements.settingsBtn.addEventListener('click', () => elements.settingsPanel.classList.toggle('show'));
      document.addEventListener('click', (e) => {
        if (!e.target.closest('#settingsBtn') && !e.target.closest('#settingsPanel')) {
          elements.settingsPanel.classList.remove('show');
        }
      });

      elements.sendBtn.addEventListener('click', sendMessage);
      elements.chatInput.addEventListener('keydown', e => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          sendMessage();
        }
      });
    }

    // Initialization
    function init() {
      setupLanguageSelector();
      applyTheme('dark');
      setupEventListeners();
      loadMessages();
    }

    init();
  </script>
</body>
</html>