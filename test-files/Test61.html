<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SV Schedule Tracker</title>
  <!-- Bootstrap CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-9ndCyUa6mY5h+0Q5YbY4Qe+pwYdNm4pLZ0I1EzOz1XQ7PM3/pfXhF7Lb6V8hXKcp"
    crossorigin="anonymous"
  />
</head>
<body>
  <div class="container py-4">
    <div id="root"></div>
  </div>  <script type="module">
    import React, { useState, useEffect } from 'https://esm.sh/react@18.2.0?bundle';
    import ReactDOM from 'https://esm.sh/react-dom@18.2.0?bundle';
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js';
    import { getFirestore, doc, setDoc, getDoc } from 'https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js';
    import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js';

    // Firebase initialization
    const firebaseConfig = {
      apiKey: "AIzaSyBV7Jg0BVzeCNQW9oiIiNItnejUsjj2DhA",
      authDomain: "squadvertex2007.firebaseapp.com",
      projectId: "squadvertex2007",
      storageBucket: "squadvertex2007.appspot.com",
      messagingSenderId: "168905083514",
      appId: "1:168905083514:web:c8bbe2ce9f87800a0f09c3"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth();
    const provider = new GoogleAuthProvider();

    function App() {
      const [user, setUser] = useState(null);
      const [tasks, setTasks] = useState([]);
      const [rules, setRules] = useState([]);
      const [form, setForm] = useState({ time: '', duration: '', text: '' });
      const [ruleText, setRuleText] = useState('');
      const [markedDates, setMarkedDates] = useState([]);

      const today = new Date().toISOString().split('T')[0];
      const allDone = tasks.length && tasks.every(t => t.done) && rules.every(r => r.done);
      const alreadyMarked = markedDates.includes(today);

      useEffect(() => {
        onAuthStateChanged(auth, async (u) => {
          if (u) {
            setUser(u);
            const snap = await getDoc(doc(db, 'schedules', u.uid));
            if (snap.exists()) {
              const data = snap.data();
              setTasks(data.tasks || []);
              setRules(data.rules || []);
              setMarkedDates(data.markedDates || []);
            }
          } else {
            signInWithPopup(auth, provider).catch(console.error);
          }
        });
      }, []);

      const saveData = async (newTasks, newRules, newMarked) => {
        if (!user) return;
        await setDoc(doc(db, 'schedules', user.uid), {
          tasks: newTasks,
          rules: newRules,
          markedDates: newMarked
        });
      };

      const addTask = async () => {
        if (!form.time || !form.duration || !form.text) return;
        const newTasks = [...tasks, { ...form, done: false }];
        setTasks(newTasks);
        setForm({ time: '', duration: '', text: '' });
        await saveData(newTasks, rules, markedDates);
      };

      const addRule = async () => {
        if (!ruleText) return;
        const newRules = [...rules, { text: ruleText, done: false }];
        setRules(newRules);
        setRuleText('');
        await saveData(tasks, newRules, markedDates);
      };

      const toggleTask = async (i) => {
        const newTasks = [...tasks];
        newTasks[i].done = !newTasks[i].done;
        setTasks(newTasks);
        await saveData(newTasks, rules, markedDates);
      };

      const toggleRule = async (i) => {
        const newRules = [...rules];
        newRules[i].done = !newRules[i].done;
        setRules(newRules);
        await saveData(tasks, newRules, markedDates);
      };

      const markDay = async () => {
        if (!allDone || alreadyMarked) return;
        const newMarked = [...markedDates, today];
        setMarkedDates(newMarked);
        await saveData(tasks, rules, newMarked);
        alert('ðŸŽ‰ You have completed all items! Day marked.');
      };

      if (!user) return <div>Loading...</div>;

      return (
        <div className="card p-4">
          <h1 className="card-title text-center mb-4">ðŸ“… SV Schedule Tracker</h1>

          <div className="mb-3">
            <h5>Create Daily Task</h5>
            <div className="d-flex gap-2 mb-2">
              <input
                type="time"
                className="form-control"
                value={form.time}
                onChange={e => setForm({ ...form, time: e.target.value })}
              />
              <input
                type="number"
                className="form-control"
                placeholder="Duration"
                value={form.duration}
                onChange={e => setForm({ ...form, duration: e.target.value })}
              />
              <input
                type="text"
                className="form-control"
                placeholder="Task description"
                value={form.text}
                onChange={e => setForm({ ...form, text: e.target.value })}
              />
            </div>
            <button className="btn btn-primary" onClick={addTask}>Add Task</button>
          </div>

          <div className="mb-3">
            <h5>Define Routine Rule</h5>
            <div className="d-flex gap-2 mb-2">
              <input
                type="text"
                className="form-control"
                placeholder="Rule description"
                value={ruleText}
                onChange={e => setRuleText(e.target.value)}
              />
              <button className="btn btn-secondary" onClick={addRule}>Add Rule</button>
            </div>
          </div>

          <div className="row">
            <div className="col-md-6">
              <h6>Tasks</h6>
              <ul className="list-group mb-3">
                {tasks.map((t, i) => (
                  <li key={i} className="list-group-item d-flex justify-content-between align-items-center">
                    <span>{t.time} - {t.text} ({t.duration}min)</span>
                    <input type="checkbox" checked={t.done} onChange={() => toggleTask(i)} />
                  </li>
                ))}
              </ul>
            </div>
            <div className="col-md-6">
              <h6>Routine Rules</n
              ><ul className="list-group mb-3">
                {rules.map((r, i) => (
                  <li key={i} className="list-group-item d-flex justify-content-between align-items-center">
                    <span>{r.text}</span>
                    <input type="checkbox" checked={r.done} onChange={() => toggleRule(i)} />
                  </li>
                ))}
              </ul>
            </div>
          </div>

          <button
            className="btn btn-success w-100 mb-3"
            disabled={!allDone || alreadyMarked}
            onClick={markDay}
          >
            {alreadyMarked ? 'Already Marked Today' : 'Mark Day Complete'}
          </button>

          <div>
            <h6>Completed Dates</h6>
            <div className="history d-flex flex-wrap gap-1">
              {markedDates.map((d, i) => <span key={i} className="badge bg-success">{d}</span>)}
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
  </script></body>
</html>