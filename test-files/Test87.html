<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Account Management - SquadVertex</title>
  <style>
    /* Reset Styles */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 100%);
      color: #fff;
      display: flex; justify-content: center; align-items: center;
      height: 100vh; overflow: hidden;
    }
    .signup-container {
      text-align: center; max-width: 600px; width: 90%;
      padding: 20px; border-radius: 15px;
      background: rgba(18,18,18,0.9);
      box-shadow: 0 8px 30px rgba(0,255,100,0.15);
      position: relative; border-top: 3px solid #1db954;
    }
    .branding .logo-circle {
      display: inline-block; width:120px; height:120px;
      border-radius:50%; background: linear-gradient(135deg,#1db954,#2fdc7e);
      padding:5px; margin-bottom:15px; overflow:hidden;
    }
    .branding .logo-circle img {
      width:100%; height:100%; object-fit:cover; border-radius:50%;
    }
    .branding h1 { font-size:2rem; color:#1db954; margin-bottom:5px; }
    .branding p { font-size:1.1rem; color:#ccc; }

    #accounts-list { margin:20px 0; text-align:left; }
    .account-item {
      background:#222; padding:10px; border-radius:8px;
      margin-bottom:10px; display:flex; justify-content:space-between;
    }
    .account-actions button {
      background:none; border:none; color:#1db954; cursor:pointer;
      margin-left:10px;
    }

    .terms-group { margin:20px 0; text-align:left; font-size:0.95rem; }
    .terms-group input { margin-right:8px; transform:scale(1.2); cursor:pointer; }
    .terms-group a { color:#1db954; text-decoration:none; }
    .terms-group a:hover { text-decoration:underline; }

    .g-recaptcha { margin:15px 0; }

    .signup-box h2 { font-size:1.5rem; color:#1db954; margin-bottom:10px; }
    .signup-box p  { font-size:1rem; color:#d4d4d4; margin-bottom:20px; }
    .google-btn {
      display:flex; align-items:center; justify-content:center;
      background:#fff; color:#121212; font-size:1rem; font-weight:bold;
      padding:10px 20px; border:none; border-radius:25px; cursor:pointer;
      box-shadow:0 4px 10px rgba(0,0,0,0.2); transition:transform .2s, box-shadow .2s;
      gap:10px;
    }
    .google-btn:disabled { background:#555; cursor:not-allowed; }
    .google-btn:hover:enabled {
      transform:scale(1.05); box-shadow:0 6px 15px rgba(0,0,0,0.3);
    }

    #signed-in-view { display:none; margin-top:20px; }
    #signed-in-view h2 { font-size:1.5rem; color:#1db954; margin-bottom:10px; }
    #signed-in-view p  { font-size:1rem; color:#fff; margin-bottom:20px; }
    #signed-in-view .actions {
      display:flex; justify-content:center; gap:10px;
    }
    #signed-in-view .btn-small {
      background:#1db954; color:#fff; padding:10px 20px;
      border:none; border-radius:25px; cursor:pointer; font-size:1rem;
      transition:background .2s;
    }
    #signed-in-view .btn-small:hover { background:#17a144; }

    footer { margin-top:30px; font-size:0.9rem; color:#d4d4d4; }
    footer a { color:#1db954; text-decoration:none; margin:0 5px; }
    footer a:hover { text-decoration:underline; }
  </style>

  <!-- Google reCAPTCHA v2 -->
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
</head>
<body>
  <div class="signup-container" id="auth-container">
    <!-- Branding -->
    <div class="branding">
      <a href="/" class="logo-circle">
        <img src="https://dl.dropboxusercontent.com/s/fkq02zrhmtjo8q0j66pj4/Screenshot_20240901-172502.png" alt="Logo">
      </a>
      <h1>SquadVertex</h1>
      <p>Empowering Creators, One Click at a Time!</p>
    </div>

    <!-- Saved Accounts -->
    <div id="accounts-list">
      <h3>Saved Accounts</h3>
      <div id="accounts-items"></div>
    </div>

    <!-- Terms + reCAPTCHA -->
    <div class="terms-group">
      <input type="checkbox" id="terms-checkbox">
      <label for="terms-checkbox">
        I accept the <a href="terms and conditions.html" target="_blank">Terms & Conditions</a> &amp;
        <a href="privacy-policies.html" target="_blank">Privacy Policy</a>
      </label>
    </div>
    <div class="g-recaptcha" data-sitekey="YOUR_RECAPTCHA_SITE_KEY" data-callback="onRecaptchaSuccess"></div>

    <!-- Sign-In -->
    <div class="signup-box" id="signed-out-view">
      <h2>Join the Squad</h2>
      <p>Sign in with Google to manage your account.</p>
      <button id="googleSignInButton" class="google-btn" disabled>
        <img src="https://img.icons8.com/color/24/google-logo.png" alt="G"> Sign In with Google
      </button>
    </div>

    <!-- Signed-In -->
    <div id="signed-in-view">
      <h2>Welcome, <span id="display-name"></span>!</h2>
      <p>Your email: <span id="display-email"></span></p>
      <div class="actions">
        <button class="btn-small" id="go-profile-btn">Go to Profile</button>
        <button class="btn-small" id="switch-account-btn">Switch Account</button>
        <button class="btn-small" id="signout-btn">Sign Out</button>
      </div>
    </div>

    <footer><p>© 2024-2025 SquadVertex</p></footer>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import {
      getAuth, signInWithPopup, GoogleAuthProvider,
      signOut, onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
    import {
      getFirestore, doc, getDoc, setDoc,
      updateDoc, serverTimestamp
    } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyBV7Jg0BVzeCNQW9oiIiNItnejUsjj2DhA",
      authDomain: "squadvertex2007.firebaseapp.com",
      projectId: "squadvertex2007",
      storageBucket: "squadvertex2007.appspot.com",
      messagingSenderId: "168905083514",
      appId: "1:168905083514:web:c8bbe2ce9f87800a0f09c3"
    };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db   = getFirestore(app);
    const provider = new GoogleAuthProvider();

    // DOM
    const termsCb    = document.getElementById('terms-checkbox');
    const recaptcha  = () => grecaptcha.getResponse().length > 0;
    const signInBtn  = document.getElementById('googleSignInButton');
    const accountsDiv= document.getElementById('accounts-list');
    const itemsDiv   = document.getElementById('accounts-items');
    const outView    = document.getElementById('signed-out-view');
    const inView     = document.getElementById('signed-in-view');
    const nameEl     = document.getElementById('display-name');
    const emailEl    = document.getElementById('display-email');
    const goProfBtn  = document.getElementById('go-profile-btn');
    const switchBtn  = document.getElementById('switch-account-btn');
    const signoutBtn = document.getElementById('signout-btn');

    // LocalStorage utilities
    function loadAccounts() {
      const d = localStorage.getItem('savedAccounts');
      return d ? JSON.parse(d) : [];
    }
    function saveAccounts(a) {
      localStorage.setItem('savedAccounts', JSON.stringify(a));
    }
    function renderAccounts() {
      const a = loadAccounts();
      if (!a.length) {
        accountsDiv.style.display = 'none';
        return;
      }
      itemsDiv.innerHTML = '';
      a.forEach(e => {
        const div = document.createElement('div');
        div.className = 'account-item';
        div.innerHTML = `
          <span>${e}</span>
          <div class="account-actions">
            <button class="use">Use</button>
            <button class="remove">×</button>
          </div>`;
        div.querySelector('.use').onclick = doSignIn;
        div.querySelector('.remove').onclick = () => {
          const na = loadAccounts().filter(x => x !== e);
          saveAccounts(na);
          renderAccounts();
        };
        itemsDiv.appendChild(div);
      });
      accountsDiv.style.display = 'block';
    }

    // Enable sign-in when both T&C and reCAPTCHA are satisfied
    function updateSignInState() {
      signInBtn.disabled = !(termsCb.checked && recaptcha());
    }
    window.onRecaptchaSuccess = updateSignInState;
    termsCb.addEventListener('change', updateSignInState);

    // Sign-In handler
    async function doSignIn() {
      if (!termsCb.checked || !recaptcha()) {
        return alert("Accept T&C and complete reCAPTCHA");
      }
      try {
        const res = await signInWithPopup(auth, provider);
        const u   = res.user;
        const ref = doc(db, 'users', u.uid);
        const snap= await getDoc(ref);
        const now = serverTimestamp();
        if (!snap.exists()) {
          await setDoc(ref, {
            name: u.displayName||'',
            email: u.email,
            registrationTime: now,
            termsAccepted: true,
            termsTimestamp: now
          });
        } else {
          await updateDoc(ref, {
            name: u.displayName||'',
            email: u.email,
            termsAccepted: true,
            termsTimestamp: now
          });
        }
        const arr = loadAccounts();
        if (!arr.includes(u.email)) {
          arr.push(u.email);
          saveAccounts(arr);
        }
      } catch(e) {
        alert("Sign-in failed: " + e.message);
      }
    }
    signInBtn.addEventListener('click', doSignIn);

    // Auth state listener
    onAuthStateChanged(auth, user => {
      if (user) {
        outView.style.display = 'none';
        inView.style.display  = 'block';
        nameEl.textContent  = user.displayName;
        emailEl.textContent = user.email;
      } else {
        inView.style.display  = 'none';
        outView.style.display = 'block';
        renderAccounts();
        termsCb.checked = false;
        grecaptcha.reset();
        updateSignInState();
      }
    });

    // Button handlers
    goProfBtn.onclick  = () => window.location.href = 'profile.html';
    switchBtn.onclick = () => auth.signOut();
    signoutBtn.onclick= () => auth.signOut();

    // Init
    document.addEventListener('DOMContentLoaded', renderAccounts);
  </script>
</body>
</html>

