<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Channel Management Portal</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', 'Inter', system-ui, sans-serif;
    }

    :root {
      --primary: #d63384;
      --primary-light: #e34b95;
      --secondary: #4a6fa5;
      --accent: #6f42c1;
      --light-bg: #f8f9fa;
      --card-bg: #ffffff;
      --text: #212529;
      --text-muted: #6c757d;
      --border: #dee2e6;
      --success: #28a745;
      --error: #dc3545;
      --warning: #ffc107;
      --info: #17a2b8;
      --radius: 10px;
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      --transition: all 0.3s ease;
    }

    body {
      background: var(--light-bg);
      color: var(--text);
      min-height: 100vh;
      padding: 20px;
      line-height: 1.6;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      padding: 30px 0;
      margin-bottom: 30px;
      position: relative;
    }

    .logo-container {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      width: 80px;
      height: 80px;
      border-radius: 50%;
      margin-bottom: 20px;
      box-shadow: var(--shadow);
    }

    .logo-container i {
      font-size: 36px;
      color: white;
    }

    h1 {
      font-size: 2.2rem;
      margin-bottom: 10px;
      color: var(--text);
      font-weight: 700;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .subtitle {
      color: var(--text-muted);
      font-size: 1.1rem;
      max-width: 600px;
      margin: 0 auto;
    }

    .card {
      background: var(--card-bg);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 30px;
      margin-bottom: 30px;
      border: 1px solid var(--border);
      transition: var(--transition);
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }

    .card-header {
      display: flex;
      align-items: center;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 2px solid rgba(214, 51, 132, 0.1);
    }

    .card-header i {
      background: rgba(214, 51, 132, 0.1);
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 12px;
      margin-right: 15px;
      color: var(--primary);
      font-size: 1.4rem;
    }

    .card-header h2 {
      font-size: 1.6rem;
      color: var(--text);
      font-weight: 600;
    }

    .status-card {
      background: var(--card-bg);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 25px;
      margin-bottom: 30px;
      text-align: center;
      position: relative;
      overflow: hidden;
      border: 1px solid var(--border);
    }

    .status-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: linear-gradient(90deg, var(--primary), var(--accent));
    }

    .channel-info {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }

    .channel-logo {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      border: 3px solid var(--primary);
      box-shadow: 0 0 20px rgba(214, 51, 132, 0.15);
      object-fit: cover;
    }

    .channel-details {
      text-align: left;
    }

    .channel-name {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 5px;
      color: var(--text);
    }

    .channel-id {
      font-size: 0.9rem;
      color: var(--text-muted);
      margin-bottom: 10px;
    }

    .channel-url {
      color: var(--primary);
      font-weight: 500;
      text-decoration: none;
      transition: var(--transition);
    }

    .channel-url:hover {
      color: var(--accent);
      text-decoration: underline;
    }

    .stats {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin-top: 20px;
    }

    .stat-box {
      background: rgba(214, 51, 132, 0.05);
      padding: 15px 20px;
      border-radius: var(--radius);
      min-width: 150px;
    }

    .stat-value {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 5px;
    }

    .stat-label {
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--text);
      font-size: 1rem;
    }

    input, textarea, button {
      width: 100%;
      padding: 14px;
      border-radius: var(--radius);
      font-size: 1rem;
      transition: var(--transition);
    }

    input, textarea {
      border: 1px solid var(--border);
      background: var(--card-bg);
      color: var(--text);
    }

    input:focus, textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(214, 51, 132, 0.2);
    }

    textarea {
      min-height: 120px;
      resize: vertical;
    }

    button {
      background: linear-gradient(90deg, var(--primary), var(--accent));
      color: white;
      border: none;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    button:hover {
      background: linear-gradient(90deg, var(--primary-light), #7d55d4);
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(214, 51, 132, 0.3);
    }

    button:active {
      transform: translateY(0);
    }

    .flex-group {
      display: flex;
      gap: 15px;
      margin-bottom: 15px;
    }

    .flex-group input {
      flex: 1;
    }

    .flex-group button {
      width: auto;
      padding: 14px 25px;
    }

    .list-container {
      margin-top: 20px;
    }

    .list-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border);
    }

    .list-header h3 {
      font-size: 1.3rem;
      color: var(--text);
      font-weight: 600;
    }

    .item-list {
      max-height: 300px;
      overflow-y: auto;
      padding-right: 10px;
    }

    .list-item {
      background: rgba(214, 51, 132, 0.03);
      padding: 15px;
      border-radius: var(--radius);
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
      border: 1px solid var(--border);
      transition: var(--transition);
    }

    .list-item:hover {
      background: rgba(214, 51, 132, 0.08);
      border-color: rgba(214, 51, 132, 0.3);
    }

    .list-item-content {
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      margin-right: 15px;
      color: var(--text);
    }

    .list-item button {
      width: auto;
      padding: 8px 15px;
      font-size: 0.9rem;
      border-radius: 6px;
      background: var(--light-bg);
      color: var(--error);
      border: 1px solid var(--border);
    }

    .list-item button:hover {
      background: var(--error);
      color: white;
      box-shadow: 0 3px 10px rgba(220, 53, 69, 0.3);
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 25px;
      border-radius: var(--radius);
      color: white;
      font-weight: 500;
      box-shadow: var(--shadow);
      z-index: 1000;
      transform: translateX(120%);
      transition: transform 0.3s ease;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .notification.show {
      transform: translateX(0);
    }

    .notification.success {
      background: var(--success);
    }

    .notification.error {
      background: var(--error);
    }

    @media (max-width: 768px) {
      .flex-group {
        flex-direction: column;
      }
      
      .flex-group button {
        width: 100%;
      }
      
      .stats {
        flex-direction: column;
        gap: 15px;
        align-items: center;
      }
      
      .channel-info {
        flex-direction: column;
        text-align: center;
      }
      
      .channel-details {
        text-align: center;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo-container">
        <i class="fas fa-satellite"></i>
      </div>
      <h1>Channel Management Portal</h1>
      <p class="subtitle">SVX-VPP-007 - Manage your YouTube channel settings and content</p>
    </header>

    <div class="status-card">
      <div class="channel-info">
        <img id="channelLogo" class="channel-logo" src="https://i.ibb.co/0jT2d8R/logo.png" alt="Channel Logo">
        <div class="channel-details">
          <div class="channel-name" id="channelName">Tech Reviews Channel</div>
          <div class="channel-id">Channel ID: <span id="displayID">UCXyz123Abc456Def</span></div>
          <a href="#" class="channel-url" id="displayLink" target="_blank">https://youtube.com/@techreviews</a>
        </div>
      </div>
      
      <div class="stats">
        <div class="stat-box">
          <div class="stat-value" id="shortsCount">12</div>
          <div class="stat-label">Fan Shorts</div>
        </div>
        <div class="stat-box">
          <div class="stat-value" id="videosCount">8</div>
          <div class="stat-label">Fan Replays</div>
        </div>
        <div class="stat-box">
          <div class="stat-value" id="instaCountDisplay">12.8K</div>
          <div class="stat-label">Instagram Followers</div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <i class="fas fa-sliders-h"></i>
        <h2>Channel Setup</h2>
      </div>
      
      <div class="form-group">
        <label for="channelURL"><i class="fas fa-link"></i> YouTube Channel URL</label>
        <input type="text" id="channelURL" placeholder="https://www.youtube.com/..." value="https://youtube.com/@techreviews">
      </div>
      
      <div class="flex-group">
        <button id="resolveChannelBtn"><i class="fas fa-search"></i> Resolve & Save</button>
        <button id="saveSettingsBtn"><i class="fas fa-save"></i> Save Settings</button>
      </div>
      
      <div class="form-group">
        <label for="desc"><i class="fas fa-align-left"></i> Channel Description</label>
        <textarea id="desc" placeholder="Enter your channel description">Welcome to Tech Reviews! We bring you the latest gadget reviews and tech news.</textarea>
      </div>
      
      <div class="flex-group">
        <div class="form-group" style="flex: 1;">
          <label for="instaCount"><i class="fab fa-instagram"></i> Instagram Followers</label>
          <input type="number" id="instaCount" placeholder="e.g. 12800" value="12800">
        </div>
        
        <div class="form-group" style="flex: 1;">
          <label for="instaLink"><i class="fab fa-instagram"></i> Instagram URL</label>
          <input type="text" id="instaLink" placeholder="https://instagram.com/..." value="https://instagram.com/techreviews">
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <i class="fas fa-film"></i>
        <h2>Content Management</h2>
      </div>
      
      <div class="list-container">
        <div class="list-header">
          <h3><i class="fas fa-video"></i> Fan Shorts</h3>
        </div>
        
        <div class="flex-group">
          <input type="text" id="newShortURL" placeholder="YouTube Short URL" value="https://youtube.com/shorts/abc123">
          <button id="addShortBtn"><i class="fas fa-plus"></i> Add</button>
        </div>
        
        <div class="item-list">
          <div id="shortsList">
            <div class="list-item">
              <div class="list-item-content">https://youtube.com/shorts/xyz789</div>
              <button><i class="fas fa-trash"></i> Remove</button>
            </div>
            <div class="list-item">
              <div class="list-item-content">https://youtube.com/shorts/def456</div>
              <button><i class="fas fa-trash"></i> Remove</button>
            </div>
          </div>
        </div>
      </div>
      
      <div class="list-container" style="margin-top: 30px;">
        <div class="list-header">
          <h3><i class="fas fa-play-circle"></i> Fan Replays</h3>
        </div>
        
        <div class="flex-group">
          <input type="text" id="newVideoURL" placeholder="YouTube Video URL" value="https://youtube.com/watch?v=abc123">
          <button id="addVideoBtn"><i class="fas fa-plus"></i> Add</button>
        </div>
        
        <div class="item-list">
          <div id="videoList">
            <div class="list-item">
              <div class="list-item-content">https://youtube.com/watch?v=xyz789</div>
              <button><i class="fas fa-trash"></i> Remove</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div id="notification" class="notification"></div>
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore-compat.js"></script>
  
  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBV7Jg0BVzeCNQW9oiIiNItnejUsjj2DhA",
      authDomain: "squadvertex2007.firebaseapp.com",
      projectId: "squadvertex2007",
      storageBucket: "squadvertex2007.appspot.com",
      messagingSenderId: "168905083514",
      appId: "1:168905083514:web:c8bbe2ce9f87800a0f09c3"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const col = "003-channel";

    // YouTube API Key
    const YT_API_KEY = "AIzaSyALYK2h1PDv9yDVR3PlFkB4ZAhbu9E1-rA";

    // DOM Elements
    const resolveBtn = document.getElementById('resolveChannelBtn');
    const saveBtn = document.getElementById('saveSettingsBtn');
    const addShortBtn = document.getElementById('addShortBtn');
    const addVideoBtn = document.getElementById('addVideoBtn');
    const notification = document.getElementById('notification');

    // Notification function
    function showNotification(message, type) {
      notification.textContent = message;
      notification.className = `notification ${type} show`;
      notification.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i> ${message}`;
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    // Extract channel ID from URL
    function extractChannelID(url) {
      const patterns = [
        /youtube\.com\/channel\/([A-Za-z0-9_-]+)/,
        /youtube\.com\/(c\/|@)([A-Za-z0-9_-]+)/
      ];
      
      for (const pattern of patterns) {
        const match = url.match(pattern);
        if (match) return match[1] || match[2];
      }
      return null;
    }

    // Get channel ID from username
    async function getChannelIDFromUsername(username) {
      try {
        const response = await fetch(
          `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${username}&type=channel&key=${YT_API_KEY}`
        );
        const data = await response.json();
        return data.items?.[0]?.id?.channelId || null;
      } catch (error) {
        console.error('Error fetching channel ID:', error);
        return null;
      }
    }

    // Fetch channel details
    async function fetchChannelDetails(id) {
      try {
        const response = await fetch(
          `https://www.googleapis.com/youtube/v3/channels?part=snippet&id=${id}&key=${YT_API_KEY}`
        );
        const data = await response.json();
        return data.items?.[0]?.snippet || null;
      } catch (error) {
        console.error('Error fetching channel details:', error);
        return null;
      }
    }

    // Save settings to Firestore
    async function saveSettings() {
      try {
        const link = document.getElementById('channelURL').value.trim();
        const desc = document.getElementById('desc').value.trim();
        const instaCount = document.getElementById('instaCount').value;
        const instaLink = document.getElementById('instaLink').value.trim();
        
        const settings = {
          channelLink: link,
          desc,
          instaCount: parseInt(instaCount, 10),
          instaLink
        };
        
        await db.collection(col).doc('settings').set(settings, { merge: true });
        showNotification('Settings saved successfully!', 'success');
      } catch (error) {
        console.error('Error saving settings:', error);
        showNotification('Failed to save settings', 'error');
      }
    }

    // Resolve channel ID and save
    async function resolveChannel() {
      try {
        const url = document.getElementById('channelURL').value.trim();
        if (!url) {
          showNotification('Please enter a YouTube URL', 'error');
          return;
        }
        
        let channelId = extractChannelID(url);
        if (!channelId) {
          const username = extractChannelID(url);
          if (username) {
            channelId = await getChannelIDFromUsername(username);
          }
        }
        
        if (!channelId) {
          showNotification('Could not resolve channel ID', 'error');
          return;
        }
        
        const details = await fetchChannelDetails(channelId);
        if (details) {
          document.getElementById('channelName').textContent = details.title;
          document.getElementById('channelLogo').src = details.thumbnails.default.url;
        }
        
        await db.collection(col).doc('settings').update({
          channelId: channelId
        });
        
        document.getElementById('displayID').textContent = channelId;
        showNotification(`Channel ID resolved: ${channelId}`, 'success');
      } catch (error) {
        console.error('Error resolving channel:', error);
        showNotification('Failed to resolve channel', 'error');
      }
    }

    // Add item to array in Firestore
    async function addToArray(collectionName, value) {
      try {
        if (!value) return;
        
        const docRef = db.collection(col).doc(collectionName);
        await docRef.set({
          content: firebase.firestore.FieldValue.arrayUnion(value)
        }, { merge: true });
        
        showNotification(`Item added to ${collectionName}`, 'success');
        return true;
      } catch (error) {
        console.error(`Error adding to ${collectionName}:`, error);
        showNotification(`Failed to add item`, 'error');
        return false;
      }
    }

    // Remove item from array in Firestore
    async function removeFromArray(collectionName, value) {
      try {
        await db.collection(col).doc(collectionName).update({
          content: firebase.firestore.FieldValue.arrayRemove(value)
        });
        showNotification('Item removed', 'success');
      } catch (error) {
        console.error(`Error removing from ${collectionName}:`, error);
        showNotification('Failed to remove item', 'error');
      }
    }

    // Event listeners
    resolveBtn.addEventListener('click', resolveChannel);
    saveBtn.addEventListener('click', saveSettings);
    
    addShortBtn.addEventListener('click', async () => {
      const url = document.getElementById('newShortURL').value.trim();
      if (url) {
        const success = await addToArray('shorts', url);
        if (success) {
          const listItem = document.createElement('div');
          listItem.className = 'list-item';
          listItem.innerHTML = `
            <div class="list-item-content">${url}</div>
            <button><i class="fas fa-trash"></i> Remove</button>
          `;
          document.getElementById('shortsList').appendChild(listItem);
          document.getElementById('newShortURL').value = '';
          
          // Add remove functionality
          listItem.querySelector('button').addEventListener('click', async () => {
            await removeFromArray('shorts', url);
            listItem.remove();
          });
        }
      }
    });
    
    addVideoBtn.addEventListener('click', async () => {
      const url = document.getElementById('newVideoURL').value.trim();
      if (url) {
        const success = await addToArray('videos', url);
        if (success) {
          const listItem = document.createElement('div');
          listItem.className = 'list-item';
          listItem.innerHTML = `
            <div class="list-item-content">${url}</div>
            <button><i class="fas fa-trash"></i> Remove</button>
          `;
          document.getElementById('videoList').appendChild(listItem);
          document.getElementById('newVideoURL').value = '';
          
          // Add remove functionality
          listItem.querySelector('button').addEventListener('click', async () => {
            await removeFromArray('videos', url);
            listItem.remove();
          });
        }
      }
    });

    // Initialize existing remove buttons
    document.querySelectorAll('.list-item button').forEach(button => {
      const listItem = button.closest('.list-item');
      const content = listItem.querySelector('.list-item-content').textContent;
      
      button.addEventListener('click', async () => {
        const collection = listItem.closest('#shortsList') ? 'shorts' : 'videos';
        await removeFromArray(collection, content);
        listItem.remove();
      });
    });

    // Simulate loading settings (in a real app, this would come from Firestore)
    document.getElementById('instaCountDisplay').textContent = 
      (12800).toLocaleString();
  </script>
</body>
</html>
