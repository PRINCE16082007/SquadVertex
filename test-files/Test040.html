<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>About Team Galaxy</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --accent: #64c2ff;
      --muted: #9fd8ff;
      --panel: rgba(24,31,43,0.97);
      --glass: rgba(10,18,28,0.55);
      --bg-grad-1: #08131a;
      --bg-grad-2: #0f1722;
    }

    /* Basic reset */
    * { box-sizing: border-box; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }
    html,body { height: 100%; margin:0; padding:0; }
    body {
      margin: 0;
      font-family: "Poppins", Arial, sans-serif;
      color: #fff;
      background: linear-gradient(180deg,var(--bg-grad-1) 0%, var(--bg-grad-2) 100%);
      -webkit-font-smoothing:antialiased;
      overflow-x: hidden;
    }

    a { color: inherit; text-decoration: none; }

    /* Top bar */
    .top-bar {
      display:flex;
      align-items:center;
      justify-content:space-between;
      height:76px;
      padding:0 18px;
      gap:12px;
      background: rgba(8,12,18,0.6);
      border-bottom: 1px solid rgba(255,255,255,0.03);
      position: sticky;
      top: 0;
      z-index: 120;
      backdrop-filter: blur(8px);
    }
    .logo-title { display:flex; align-items:center; gap:10px; font-weight:700; font-family: Montserrat, sans-serif; font-size:1.18rem; cursor:pointer; white-space:nowrap; }
    .logo-title img { height:44px; display:block; filter: drop-shadow(0 0 8px rgba(97,218,251,0.6)); }

    .hamburger {
      display: none;
      background:none; border:none; color:#e6f8ff; font-size:1.1rem; padding:8px; cursor:pointer;
    }

    .nav-buttons { display:flex; gap:12px; align-items:center; }
    .nav-btn, .profile-btn { background:none; border:none; color:#e6f8ff; padding:8px 10px; border-radius:8px; cursor:pointer; font-weight:600; }
    .nav-btn:hover, .profile-btn:hover { color:var(--accent); background: rgba(255,255,255,0.03); }

    .more-options { position:relative; }
    .dropdown-content { display:none; position:absolute; right:0; top:48px; min-width:160px; background: rgba(18,26,36,0.98); border-radius:8px; padding:6px 0; box-shadow:0 10px 34px rgba(0,0,0,0.5); border:1px solid rgba(255,255,255,0.04); }
    .more-options:hover .dropdown-content { display:block; }
    .dropdown-content a { display:block; padding:10px 12px; color:#e6f8ff; font-weight:600; }

    /* stars background (full page) */
    .stars { position:fixed; inset:0; z-index:-1; pointer-events:none; overflow:hidden; }
    .star { position:absolute; border-radius:50%; background: rgba(255,255,255,0.95); opacity:0.18; animation: twinkle var(--duration,5s) infinite ease-in-out; }
    @keyframes twinkle { 0%,100%{opacity:0.2} 50%{opacity:1} }

    /* container */
    .container { max-width:1200px; margin:14px auto 28px; padding:0 18px; box-sizing:border-box; }

    /* Play area */
    .orbit-playground { position:relative; height:540px; max-width:100%; margin:12px auto 8px; }
    .play-card {
      position:relative;
      height:100%;
      border-radius:14px;
      overflow:visible;
      background: linear-gradient(180deg, rgba(6,10,18,0.6), rgba(3,6,12,0.6));
      border:1px solid rgba(255,255,255,0.03);
      box-shadow:0 14px 40px rgba(0,0,0,0.6);
    }
    .play-canvas { position:absolute; inset:0; width:100%; height:100%; display:block; pointer-events:none; z-index:1; }
    .nebula-canvas { position:absolute; inset:0; z-index:2; pointer-events:none; }

    /* Left static HUD â€” absolute on desktop, flow above play area on small screens */
    .hud-left {
      position:absolute; left:16px; top:14px; z-index:40;
      display:flex; gap:10px; align-items:center; padding:8px 10px; border-radius:12px;
      background: linear-gradient(180deg, rgba(8,14,22,0.6), rgba(10,18,30,0.36));
      border:1px solid rgba(255,255,255,0.06); backdrop-filter: blur(6px);
      box-shadow:0 8px 22px rgba(2,8,20,0.5); min-width:180px;
    }
    .hud-left .avatar { width:44px;height:44px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px;color:#bfeaff;background:linear-gradient(180deg,#0b2b3a,#06202a); border:2px solid rgba(150,220,255,0.12); }
    .hud-left .title{ font-weight:700; color:#fff; font-size:1rem; }
    .hud-left .subtitle{ color:var(--muted); font-weight:600; font-size:0.82rem; }

    /* Right HUD */
    .hud-small { position:absolute; right:14px; top:14px; z-index:38; background:rgba(6,10,18,0.6); padding:8px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); display:flex; gap:12px; align-items:center; backdrop-filter: blur(6px); }
    .hud-small .label { font-weight:800; color:#fff; }
    .hud-small .muted { color:var(--muted); font-weight:700; font-size:0.85rem; }
    .hud-small .btn { background:transparent; border:1px solid rgba(255,255,255,0.04); padding:6px 8px; border-radius:8px; color:#bfeaff; cursor:pointer; font-weight:600; }
    .hud-small .btn:hover { background: rgba(100,194,255,0.06); color:#fff; }

    /* center earth wrapper (keeps center) */
    .orbit-center { position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); z-index:6; display:flex; align-items:center; justify-content:center; pointer-events:auto; }
    .earth-game { width:120px; height:120px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:56px; box-shadow:0 10px 28px rgba(4,12,28,0.6), inset -6px -4px 20px rgba(0,0,0,0.45); border:1px solid rgba(255,255,255,0.04); background: radial-gradient(circle at 30% 25%, rgba(255,255,255,0.04), rgba(0,0,0,0.18)); -webkit-user-select:none; user-select:none; pointer-events:auto; }

    /* Play Full Game button */
    .play-full-btn { position:absolute; right:14px; bottom:14px; z-index:42; background: linear-gradient(90deg,#64c2ff 0%, #8ee7ff 50%, #d7fbff 100%); color:#052027; padding:10px 14px; border-radius:12px; border:none; font-weight:800; cursor:pointer; display:flex; gap:8px; align-items:center; box-shadow:0 12px 36px rgba(6,16,28,0.5); }
    .play-full-btn:hover { transform: translateY(-2px); transition: transform .12s ease; box-shadow:0 18px 48px rgba(6,20,36,0.6); }

    /* About content skeleton (Part 2 will fill) */
    .about-main { max-width:1100px; margin:28px auto 40px auto; padding-top:0; }

    /* Footer skeleton (Part 3 will fill) */
    .footer { min-height:260px; padding:28px 36px; display:flex; gap:24px; flex-wrap:wrap; }

    /* Responsiveness */
    @media (max-width:1200px){
      .orbit-playground{ height:500px; }
    }
    @media (max-width:900px){
      .hamburger{ display:block; }
      .nav-buttons{ position:absolute; top:76px; right:0; background: rgba(8,12,20,0.98); flex-direction:column; gap:8px; padding:18px; width:260px; border-radius:8px; display:none; box-shadow:0 18px 60px rgba(0,0,0,0.7); }
      .nav-buttons.show{ display:flex; }
      .logo-title{ flex:1 1 auto; }
      .orbit-playground{ height:420px; }
      .about-main{ margin-top:18px; padding:0 12px; }
      .hud-left{ position: static; margin:10px auto 6px; left:auto; top:auto; display:flex; }
      .hud-small{ position:absolute; right:12px; top:12px; }
      .play-full-btn{ right:12px; bottom:12px; }
    }
    @media (max-width:700px){
      .orbit-playground{ height:360px; }
      .about-main{ margin-top:12px; }
      .hud-left{ width:calc(100% - 36px); }
      .nav-buttons{ width:100%; right:0; left:0; top:76px; border-radius:0; }
    }
    @media (max-width:520px){
      .orbit-playground{ height:320px; }
      .hud-left .title{ font-size:0.98rem; }
      .hud-left .subtitle{ font-size:0.78rem; }
      .hud-small .label{ font-size:0.9rem; }
      .nav-buttons{ padding:14px; }
    }

    /* Utility */
    .hidden { display:none !important; }

    /* About & image styles kept from original structure (Part 2 relies on these classes) */
    .about-section { background: rgba(24,31,43,0.97); border-radius: 12px; box-shadow: 0 8px 24px #20294429; padding: 28px 32px; margin-bottom: 24px; }
    .about-flex-row { display: flex; align-items: flex-start; gap: 28px; margin-bottom: 22px; flex-wrap: wrap; }
    .about-img-container { display:flex; justify-content:center; align-items:center; border-radius:12px; background:transparent; box-shadow:0 2px 24px #23274680; overflow:hidden; flex-shrink:0; border:2px solid rgba(255,255,255,0.12); position:relative; }
    .about-img-container img { width:100%; height:100%; object-fit:cover; display:block; }
    .about-img-left { width:260px; height:347px; }
    .about-img-right { width:260px; height:347px; }
    .about-img-inline { width:100%; height:340px; border-radius:10px; border:2px solid rgba(255,255,255,0.12); box-shadow:0 2px 20px #23274680; display:block; }
    .about-flex-text { flex:1 1 340px; font-size:1rem; line-height:1.7; color:#fff; }
    .about-section h2 { color:#fab84f; font-size:1.7rem; margin-top:0; margin-bottom:10px; }
    .about-section ul { margin:12px 0 12px 20px; }
    .about-section ul li { font-size:1rem; margin-bottom:6px; color:#bfeaff; }
    .footer-about-title { font-size:1.2rem; font-weight:bold; color:#fab84f; margin-bottom:6px; }
    .footer-about-text { color:#e5e5e5; margin-bottom:12px; }
    .footer-social a { color:#fff; font-size:1.5rem; margin-right:10px; }
    .footer-links a { display:block; color:#aaa; margin-bottom:8px; font-weight:600; }
  </style>
</head>
<body>
  <!-- Stars background -->
  <div class="stars" id="stars"></div>

  <!-- Header -->
  <header class="top-bar">
    <button class="hamburger" id="hamburgerBtn" aria-label="Open menu"><i class="fa-solid fa-bars"></i></button>

    <div class="logo-title" onclick="window.location.href='dashboard.html'">
      <img src="https://dl.dropboxusercontent.com/scl/fi/v5d7xte4tksarsdufk4ay/image.png?rlkey=ca8p4jsfcw1pnqr79q8uympso&st=ikst5uy1&dl=0" alt="Logo">
      GalaxyWeb
    </div>

    <nav class="nav-buttons" id="navButtons" aria-hidden="false">
      <button class="nav-btn" onclick="window.location.href='dashboard.html'">Home</button>
      <button class="nav-btn" onclick="window.location.href='about_us.html'">Team Galaxy</button>
      <div class="more-options">
        <button class="nav-btn">More â–¼</button>
        <div class="dropdown-content" id="moreDropdown" aria-hidden="true">
          <a href="galaxy_blogs.html">Blog</a>
          <a href="galaxy_portfolio.html">Portfolio</a>
          <a href="posts.html">Posts</a>
          <a href="community_chat.html">Community Chat</a>
          <a href="galaxy_studio.html">Galaxy Design</a>
        </div>
      </div>

      <button id="profileBtn" class="profile-btn" title="Sign In">Sign In</button>
      <div id="profileMenu" class="dropdown-content" style="right:18px; display:none;">
        <a href="/teamgalaxy/user_management/user_profile.html" id="profileLink">Profile</a>
        <a href="#" id="logoutLink">Logout</a>
      </div>
    </nav>
  </header>

  <div class="container">
    <!-- Play area -->
    <div class="orbit-playground" id="orbitPlay">
      <div class="play-card" id="playCard" aria-label="Orbit playground">
        <canvas id="playCanvas" class="play-canvas" aria-hidden="true"></canvas>
        <!-- nebula canvas will be appended by JS -->
        <!-- LEFT STATIC HUD (injected by JS) -->
        <!-- RIGHT HUD (name/slug + controls) -->
        <div class="hud-small" id="hud">
          <div>
            <div class="label" id="hudName">Guest</div>
            <div class="muted" id="hudSlug">@guest</div>
          </div>
          <div style="width:6px"></div>
          <div style="text-align:right">
            <div class="label" id="hudCollected">0</div>
            <div class="muted" id="hudHigh">High: 0</div>
          </div>
          <div style="width:12px"></div>
          <div style="display:flex; gap:8px; align-items:center;">
            <button class="btn" id="btnSpawn">Spawn</button>
            <button class="btn" id="btnClear">Clear</button>
            <button class="btn" id="btnSave">Save</button>
            <button class="btn" id="btnDownload">Download</button>
          </div>
        </div>

        <!-- center Earth element -->
        <div class="orbit-center" aria-hidden="false">
          <div class="earth-game" id="earthEl" title="Double-click to sign in (or use Sign In button)">ðŸŒŽ</div>
        </div>

        <!-- Play Full Game button will be injected by JS (keeps separation with game logic below) -->
      </div>
    </div>

    <!-- PART 2: ABOUT / CONTENT SECTIONS -->
    <div class="about-main" id="aboutMain">

      <div class="about-section">
        <div class="about-flex-row">
          <div class="about-img-container about-img-left" aria-hidden="true">
            <img src="https://dl.dropboxusercontent.com/scl/fi/4r0o3ymhfol2ndauy5bwb/IMG_20251108_205841.png?rlkey=hagnr2tms6hzf36vc0qgldu4e&st=czyyqfdb&dl=0" alt="Team Galaxy">
          </div>

          <div class="about-flex-text">
            <h2>What is Team Galaxy?</h2>
            <div style="margin-top:6px; color:var(--muted); font-weight:600;">Est. May 2025</div>
            <p style="margin-top:12px; line-height:1.7;">
              Team Galaxy shines brightly on the competitive stage of World of Tanks Blitz. Our mission is to showcase our skills, push our limits, and aim for the top.
              With a strong and united roster, we make our mark not only in tournaments but in every battle we fight.
            </p>
            <p style="line-height:1.7;">
              But Team Galaxy isn't just about victory â€” it's about having fun, too! Our custom ranking system makes clan missions more exciting and creates a sense of friendly competition among members. Whether you want to fight at the highest level or just relax and enjoy the game with friends, you'll always find your place here.
            </p>
            <p style="line-height:1.7;">In Galaxy, every member is a star. ðŸŒŒ</p>
          </div>
        </div>
      </div>

      <div class="about-section">
        <div class="about-flex-row">
          <div class="about-flex-text">
            <h2>Clan Events & Activities</h2>
            <p style="margin-top:10px; line-height:1.7;">
              At Team Galaxy, we believe that a clan should be more than just a tag next to your name â€” it should be an experience.
              We host exclusive member-only events designed to bring our community closer and keep the game exciting.
            </p>
            <p style="line-height:1.7;">
              One of our biggest traditions is turning weekly clan missions into a fun competition. Members earn stars by completing missions, and these stars contribute to a long-term leaderboard. The higher you climb, the more rewards you can win â€” from in-game gifts to special Galaxy merchandise.
            </p>
            <p style="line-height:1.7;">
              These events are perfect for both competitive warriors and laid-back tankers who just want to enjoy the ride while working toward something rewarding.
            </p>
          </div>

          <div class="about-img-container about-img-right" aria-hidden="true">
            <img src="https://dl.dropboxusercontent.com/scl/fi/g4wq4m8pkzd32dc7g79dt/1762616781.png?rlkey=m4ctngnu14zl6lffhbw5lvexz&st=bbrct8s5&dl=0" alt="Clan Event">
          </div>
        </div>
      </div>

      <div class="about-section">
        <h2>How to Apply</h2>
        <div class="about-img-container about-img-inline" aria-hidden="true" style="margin-top:12px;">
          <img src="https://dl.dropboxusercontent.com/scl/fi/extuxsxwz66h4kxz8apek/IMG_20251108_212726.jpg?rlkey=xw6xxxqtx62ahy9bikj0em3i3&st=34gxu7oj&dl=0" alt="Apply Clan">
        </div>

        <div style="margin-top:12px; line-height:1.7; font-size:1rem;">
          Currently, we operate one main clan that welcomes both competitive and casual players.
          <br><br>
          <strong>Competitive Player Requirements:</strong>
          <ul>
            <li>2400+ WN8 (last 30 days)</li>
            <li>5,000+ total battles</li>
            <li>60%+ overall win rate</li>
          </ul>

          <strong>Casual Player Requirements:</strong>
          <ul>
            <li>10,000+ total battles</li>
            <li>60%+ overall win rate</li>
          </ul>

          <p style="margin-top:8px;">
            If you meet the requirements, simply reach out to us through our official Discord or in-game contact. Our recruitment officers will review your stats and chat with you before inviting you to join.
          </p>

          <p style="margin-top:6px; color:var(--muted);">
            ðŸ’¡ Coming Soon: We are planning to launch our second clan to welcome even more players into the Galaxy family. Stay tuned for updates!
          </p>
        </div>
      </div>

      <div class="about-section">
        <div class="about-flex-row">
          <div class="about-img-container about-img-left" aria-hidden="true">
            <img src="https://dl.dropboxusercontent.com/scl/fi/2o26yjla61had31bwpcqh/IMG_20251108_213648.jpg?rlkey=dh5e6uqjquk7bb8jnaofxixt5&st=mt7scwa4&dl=0" alt="Team Philosophy">
          </div>

          <div class="about-flex-text">
            <h2>Our Playstyle & Philosophy</h2>
            <p style="margin-top:10px; line-height:1.7;">
              At Team Galaxy, we believe that victory is built on teamwork, strategy, and trust. We don't just play â€” we play smart, fast, and as one. Every battle is a chance to learn, improve, and grow stronger together.
            </p>
            <p style="line-height:1.7;">
              Our philosophy is simple: push your limits, respect your team, and enjoy the game. Whether we're fighting for the top spot in a tournament or just having a relaxed evening in platoon, we bring the same passion and dedication to every match.
            </p>
            <p style="line-height:1.7;">We value communication, adaptability, and the drive to become better â€” because in the Galaxy, every star shines brighter when united. ðŸŒŒ</p>
          </div>
        </div>
      </div>

       <div class="about-section">
        <h2>Achievements & Journey</h2>
        <div class="about-flex-row" style="align-items:flex-start;">
          <div class="about-flex-text">
            <p style="margin-top:8px; line-height:1.7;">
              Since our formation in May 2025, Team Galaxy has quickly built a name for itself in the Blitz community. While our sights are set on the biggest stages, we've already dominated numerous smaller-scale tournaments and community events â€” proving that our teamwork and skill can consistently bring home the win.
            </p>

            <strong>Highlights so far:</strong>
            <ul style="margin-top:8px;">
              <li>Multiple weekly and community tournament victories.</li>
              <li>Strong performance in clan mission challenges and internal competitions.</li>
              <li>Established a solid and active roster of both competitive and casual players.</li>
              <li>Launched our Galaxy Mission Challenge, turning weekly clan missions into a fun, rewarding contest.</li>
            </ul>

            <p style="margin-top:8px; line-height:1.7;">
              Our journey is just beginning â€” and each win, no matter the size, brings us closer to our ultimate goal: competing and triumphing at the highest levels.
            </p>
          </div>

          <div class="about-img-container about-img-right" aria-hidden="true">
            <img src="https://dl.dropboxusercontent.com/scl/fi/athrvawp9mjtjc6psfxhv/1762616303.png?rlkey=4wwayymq6wn1632tquut9fn55&st=f10ldv4f&dl=0" alt="Galaxy Journey">
          </div>
        </div>
      </div>

    </div>
    <!-- END PART 2 -->
  </div>

  <!-- Footer -->
  <footer class="footer">
    <!-- Left -->
    <div class="footer-col footer-left">
      <div>
        <div class="footer-about-title">About TeamGalaxy</div>
        <div class="footer-about-text">
          TeamGalaxy is an innovative gaming and creative community, united by passion and the spirit of collaboration.
          We host tournaments, share design ideas, and grow talents together â€” join now to explore the Galaxy!
        </div>
      </div>

      <div class="footer-social">
        <a href="https://x.com/teamgalaxy_wotb" title="Twitter"><i class="fab fa-twitter"></i></a>
        <a href="https://discord.gg/26pSCyMRPM" title="Discord"><i class="fab fa-discord"></i></a>
      </div>
    </div>

    <!-- Right -->
    <div class="footer-col footer-right">
      <div class="footer-links">
        <a href="legal/privacy_policy.html">Privacy Policy</a>
        <a href="legal/terms_and_conditions.html">Terms & Conditions</a>
        <a href="about_us.html">About</a>
      </div>

      <div>
        <div class="footer-contact-row">
          <span class="footer-contact-label">
            <i class="fa-solid fa-envelope footer-contact-icon"></i>Email:
          </span>
          info@teamgalaxy.net
        </div>

        <div class="footer-contact">
          <span class="footer-contact-label">
            <i class="fa-regular fa-clock footer-contact-icon"></i>Working Hours:
          </span>
          Monâ€“Sat 10amâ€“10pm
        </div>
      </div>
    </div>
  </footer>

  <!-- ReCAPTCHA (unchanged) -->
  <script src="https://www.google.com/recaptcha/api.js?render=6Ld395IrAAAAAIvG4gyf0vUJeI_jKOsI9XVn0jUx"></script>

<script type="module">
/* -----------------------------------------------------------
   Firebase Imports
----------------------------------------------------------- */
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-app.js";
import { 
  getAuth, onAuthStateChanged, signInWithPopup, GoogleAuthProvider, signOut 
} from "https://www.gstatic.com/firebasejs/11.9.0/firebase-auth.js";
import { 
  initializeAppCheck, ReCaptchaV3Provider 
} from "https://www.gstatic.com/firebasejs/11.9.0/firebase-app-check.js";
import { 
  getFirestore, doc, setDoc, serverTimestamp, onSnapshot 
} from "https://www.gstatic.com/firebasejs/11.9.0/firebase-firestore.js";

/* -----------------------------------------------------------
   Firebase Config
----------------------------------------------------------- */
const firebaseConfig = {
  apiKey: "AIzaSyD0Yv_bQjxi2_kjzPR4XHOlaB7Sb6NRVUc",
  authDomain: "teamgalaxy-77344.firebaseapp.com",
  projectId: "teamgalaxy-77344",
  storageBucket: "teamgalaxy-77344.firebasestorage.app",
  messagingSenderId: "770256225320",
  appId: "1:770256225320:web:5a363ebd757de6cde3a11d",
  measurementId: "G-6C2W9NSNCH"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();
const db = getFirestore(app);

// TRY app check
try {
  initializeAppCheck(app, {
    provider: new ReCaptchaV3Provider("6Ld395IrAAAAAIvG4gyf0vUJeI_jKOsI9XVn0jUx"),
    isTokenAutoRefreshEnabled: true
  });
} catch {}

/* -----------------------------------------------------------
   Hamburger Toggle
----------------------------------------------------------- */
const hamburger = document.querySelector(".hamburger");
const navButtons = document.querySelector(".nav-buttons");
if (hamburger && navButtons) {
  hamburger.addEventListener("click", () => {
    navButtons.classList.toggle("show");
  });
}

/* -----------------------------------------------------------
   Show/hide dropdown menus
----------------------------------------------------------- */
document.addEventListener("click", (e) => {
  if (!e.target.closest(".more-options")) {
    const more = document.getElementById("moreDropdown");
    if (more) more.style.display = "none";
  }
});
const moreBtn = document.querySelector(".more-options > button");
if (moreBtn) {
  moreBtn.addEventListener("click", (e) => {
    e.stopPropagation();
    const dropdown = document.getElementById("moreDropdown");
    if (!dropdown) return;
    dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
  });
}

/* -----------------------------------------------------------
   Profile Button Logic
----------------------------------------------------------- */
const profileBtn = document.getElementById("profileBtn");
const profileMenu = document.getElementById("profileMenu");
const logoutLink = document.getElementById("logoutLink");
const profileLink = document.getElementById("profileLink");

document.addEventListener("click", () => {
  if (profileMenu) profileMenu.style.display = "none";
});

if (profileBtn) {
  profileBtn.addEventListener("click", (e) => {
    e.stopPropagation();
    if (!auth.currentUser) {
      window.location.href = "/teamgalaxy/legal/sign_up.html";
      return;
    }
    if (!profileMenu) return;
    profileMenu.style.display = profileMenu.style.display === "block" ? "none" : "block";
  });
}

if (logoutLink) {
  logoutLink.addEventListener("click", async (e) => {
    e.preventDefault();
    await signOut(auth);
    alert("Signed out");
  });
}

if (profileLink) {
  profileLink.addEventListener("click", (e) => {
    e.preventDefault();
    if (!auth.currentUser) {
      window.location.href = "/teamgalaxy/legal/sign_up.html";
    } else {
      window.location.href = "/teamgalaxy/user_management/user_profile.html";
    }
  });
}

/* -----------------------------------------------------------
   GAME LOGIC â€” FULL WORKING VERSION
----------------------------------------------------------- */

/* ----------------------------
   DOM References
---------------------------- */
const playCard = document.getElementById("playCard");
const playCanvas = document.getElementById("playCanvas");
const earthEl = document.getElementById("earthEl");

const hudNameRight = document.getElementById("hudName");
const hudSlugRight = document.getElementById("hudSlug");
const hudCollected = document.getElementById("hudCollected");
const hudHigh = document.getElementById("hudHigh");

const btnSpawn = document.getElementById("btnSpawn");
const btnClear = document.getElementById("btnClear");
const btnSave = document.getElementById("btnSave");
const btnDownload = document.getElementById("btnDownload");

/* ----------------------------
   GAME STATE
---------------------------- */
let DPR = Math.max(1, window.devicePixelRatio || 1);
let W = 0, H = 0;
let currentUser = null;
let currentProfile = null;
let orbs = [];
let pops = [];
let nextId = 1;
let collected = 0;
let high = parseInt(localStorage.getItem("galaxy_high")) || 0;
let userPrivUnsub = null;

const MAX_ORBS = 28;
const AUTO_SPAWN_INTERVAL = 1200;

const ORB_TYPES = [
  { chance: 0.75, size: 18, score: 1 },
  { chance: 0.18, size: 26, score: 3 },
  { chance: 0.06, size: 34, score: 6 },
  { chance: 0.01, size: 44, score: 12 }
];

/* ----------------------------
   Canvas Setup
---------------------------- */
const ctx = playCanvas.getContext("2d");

// Nebula canvas (visual enhancement)
let nebulaCanvas = document.querySelector('.nebula-canvas');
let nebCtx = null;
if (!nebulaCanvas && playCard) {
  nebulaCanvas = document.createElement('canvas');
  nebulaCanvas.className = 'nebula-canvas';
  nebulaCanvas.setAttribute('aria-hidden', 'true');
  playCard.appendChild(nebulaCanvas);
}
nebCtx = nebulaCanvas ? nebulaCanvas.getContext('2d') : null;

function resizeGame() {
  const rect = playCard.getBoundingClientRect();
  W = rect.width || Math.max(320, window.innerWidth - 80);
  H = rect.height || Math.max(320, 360);

  playCanvas.width = Math.floor(W * DPR);
  playCanvas.height = Math.floor(H * DPR);
  playCanvas.style.width = W + "px";
  playCanvas.style.height = H + "px";

  ctx.setTransform(DPR, 0, 0, DPR, 0, 0);

  if (nebulaCanvas) {
    nebulaCanvas.width = Math.floor(W * DPR);
    nebulaCanvas.height = Math.floor(H * DPR);
    nebulaCanvas.style.width = W + "px";
    nebulaCanvas.style.height = H + "px";
    nebCtx.setTransform(DPR,0,0,DPR,0,0);
    initNebula();
  }
}
window.addEventListener("resize", resizeGame);

/* ----------------------------
   Orb spawn helpers
---------------------------- */
function pickType() {
  const r = Math.random();
  let sum = 0;
  for (let t of ORB_TYPES) {
    sum += t.chance;
    if (r <= sum) return t;
  }
  return ORB_TYPES[0];
}

function spawnOrbAt(clientX, clientY) {
  if (orbs.length >= MAX_ORBS) return;

  const rect = playCard.getBoundingClientRect();
  const cx = rect.width / 2;
  const cy = rect.height / 2;
  const px = clientX || (rect.left + rect.width/2 + (Math.random()*260 - 130));
  const py = clientY || (rect.top + rect.height/2 + (Math.random()*180 - 90));
  const dx = px - (rect.left + rect.width/2);
  const dy = py - (rect.top + rect.height/2);
  const radius = Math.max(60, Math.min(Math.hypot(dx,dy), Math.min(rect.width, rect.height)/2 - 36));
  const angle = Math.atan2(dy, dx);
  const baseSpeed = 1.1 / Math.sqrt(Math.max(1, radius/90));
  const speed = (Math.random() < 0.5 ? -1 : 1) * baseSpeed * (0.7 + Math.random() * 1.0);
  const t = pickType();
  orbs.push({
    id: nextId++,
    angle,
    radius,
    speed,
    size: t.size * (0.92 + Math.random()*0.18),
    color: '#8EE7FF',
    score: t.score,
    rotation: Math.random()*Math.PI*2,
    rotSpeed: (Math.random()*0.9-0.45)*0.02
  });
}

/* ----------------------------
   Hit Test
---------------------------- */
function hitTest(px, py) {
  const rect = playCard.getBoundingClientRect();
  const cx = rect.width / 2, cy = rect.height / 2;
  let best = null, bestD = Infinity;
  for (let o of orbs) {
    const ox = cx + o.radius * Math.cos(o.angle), oy = cy + o.radius * Math.sin(o.angle);
    const d = Math.hypot(px - ox, py - oy);
    const hitR = Math.max(18, o.size * 1.6);
    if (d <= hitR && d < bestD) { best = o; bestD = d; }
  }
  return best;
}

/* ----------------------------
   Collect Orb
---------------------------- */
function spawnPopForOrb(o){
  const rect = playCard.getBoundingClientRect(); const cx = rect.width/2, cy = rect.height/2;
  const x = cx + o.radius * Math.cos(o.angle); const y = cy + o.radius * Math.sin(o.angle);
  const parts = []; const count = Math.min(34, Math.round(8 + o.size*1.4));
  for(let i=0;i<count;i++){
    const ang = Math.random()*Math.PI*2;
    parts.push({ vx: Math.cos(ang)*(0.6 + Math.random()*3.2), vy: Math.sin(ang)*(0.6 + Math.random()*3.2), size: Math.random()*(o.size*0.8)+0.6, color: `rgba(200,240,255,` });
  }
  pops.push({ x,y, parts, life:1, lifeMax:1, speed: 42 + o.size*6 });
}
function collectOrb(o) {
  if(!o) return;
  spawnPopForOrb(o);
  collected += o.score;
  if (collected > high) {
    high = collected;
    localStorage.setItem("galaxy_high", high);
    // optional confetti we can add later
  }
  orbs = orbs.filter(x => x.id !== o.id);
  updateHUD();
}

/* ----------------------------
   Update HUD
---------------------------- */
function updateHUD() {
  if (hudCollected) hudCollected.textContent = collected;
  if (hudHigh) hudHigh.textContent = "High: " + high;
  if (currentProfile) {
    if (hudNameRight) hudNameRight.textContent = currentProfile.name || "Guest";
    if (hudSlugRight) hudSlugRight.textContent = currentProfile.slug ? "@" + currentProfile.slug : "@guest";
  } else {
    if (hudNameRight) hudNameRight.textContent = "Guest";
    if (hudSlugRight) hudSlugRight.textContent = "@guest";
  }
  updateProfileButton();
}

/* ----------------------------
   Draw / Nebula / Pops
---------------------------- */
let nebulaBlobs = [];
function initNebula(){
  nebulaBlobs = [];
  const blobCount = Math.max(2, Math.round(W/420));
  for(let i=0;i<blobCount;i++){
    nebulaBlobs.push({
      x: Math.random()*W,
      y: Math.random()*H,
      r: Math.max(80, Math.random()*220),
      vx: (Math.random()-0.5)*0.14,
      vy: (Math.random()-0.5)*0.14,
      hue: Math.floor(180 + Math.random()*120),
      alpha: 0.06 + Math.random()*0.12
    });
  }
}
function drawNebula(now){
  if(!nebCtx) return;
  nebCtx.clearRect(0,0,W,H);
  for(const b of nebulaBlobs){
    b.x += b.vx; b.y += b.vy;
    if(b.x < -b.r) b.x = W + b.r;
    if(b.x > W + b.r) b.x = -b.r;
    if(b.y < -b.r) b.y = H + b.r;
    if(b.y > H + b.r) b.y = -b.r;
    const g = nebCtx.createRadialGradient(b.x, b.y, 0, b.x, b.y, b.r);
    g.addColorStop(0, `hsla(${b.hue}, 75%, 60%, ${b.alpha*1.6})`);
    g.addColorStop(0.5, `hsla(${b.hue}, 65%, 40%, ${b.alpha})`);
    g.addColorStop(1, `rgba(0,0,0,0)`);
    nebCtx.fillStyle = g;
    nebCtx.beginPath(); nebCtx.arc(b.x, b.y, b.r, 0, Math.PI*2); nebCtx.fill();
  }
}

function draw(now){
  // main loop
  ctx.clearRect(0,0,W,H);
  // background
  const g = ctx.createLinearGradient(0,0,0,H);
  g.addColorStop(0, 'rgba(6,10,18,0.25)');
  g.addColorStop(1, 'rgba(0,0,0,0.4)');
  ctx.fillStyle = g;
  ctx.fillRect(0,0,W,H);

  // stars / subtle noise
  for(let i=0;i<Math.max(8, Math.round((W*H)/200000)); i++){
    const x = (i*37*13) % W + ((performance.now()/1200) % 7);
    const y = ((i*17*7) % H) + Math.sin((performance.now()/12000)+i)*6;
    ctx.fillStyle = 'rgba(200,230,255,0.02)';
    ctx.beginPath(); ctx.ellipse(x,y,1.2,1.2,0,0,Math.PI*2); ctx.fill();
  }

  const rect = playCard.getBoundingClientRect();
  const cx = rect.width/2, cy = rect.height/2;
  // draw orbs
  for(const o of orbs){
    o.angle += o.speed * 0.01;
    o.rotation += o.rotSpeed;
    const x = cx + o.radius * Math.cos(o.angle), y = cy + o.radius * Math.sin(o.angle);

    ctx.save();
    ctx.translate(x,y);
    ctx.rotate(o.rotation * 0.12);
    const glow = ctx.createRadialGradient(0,0,0,0,0,o.size*2.6);
    glow.addColorStop(0,'rgba(255,255,255,0.08)');
    glow.addColorStop(0.6,'rgba(255,255,255,0.02)');
    glow.addColorStop(1,'rgba(0,0,0,0)');
    ctx.fillStyle = glow;
    ctx.beginPath(); ctx.arc(0,0,o.size*2.6,0,Math.PI*2); ctx.fill();
    const fontSize = Math.max(16, Math.min(56, o.size));
    ctx.font = `${fontSize}px serif`;
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText('ðŸ›°ï¸', 0, 0);
    ctx.restore();
    o.screenX = x; o.screenY = y;
  }

  // draw pops
  for(let i=pops.length-1;i>=0;i--){
    const p = pops[i];
    p.life -= 16 / 420;
    const alpha = Math.max(0, p.life / p.lifeMax);
    for(const part of p.parts){
      const px = p.x + part.vx * (1 - alpha) * p.speed;
      const py = p.y + part.vy * (1 - alpha) * p.speed;
      const s = Math.max(0.6, part.size * alpha);
      ctx.fillStyle = part.color + (0.88 * alpha) + ')';
      ctx.beginPath(); ctx.ellipse(px, py, s, s, 0,0,Math.PI*2); ctx.fill();
    }
    if(p.life <= 0) pops.splice(i,1);
  }

  drawNebula(now);
  requestAnimationFrame(draw);
}

/* ----------------------------
   Pointer Controls
---------------------------- */
playCard.addEventListener("pointerdown", (e) => {
  if(e.pointerType === 'mouse' && e.button !== 0) return;
  const rect = playCard.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;
  const found = hitTest(x,y);
  if(found) { collectOrb(found); return; }
  spawnOrbAt(e.clientX, e.clientY);
});

/* ----------------------------
   Buttons
---------------------------- */
if (btnSpawn) btnSpawn.addEventListener("click", ()=> { for(let i=0;i<3;i++) spawnOrbAt(); });
if (btnClear) btnClear.addEventListener("click", ()=> { orbs=[]; pops=[]; collected=0; localStorage.setItem("galaxy_high", high); updateHUD(); ctx.clearRect(0,0,W,H); });
if (btnDownload) btnDownload.addEventListener("click", ()=> { /* optional image generation - omitted for brevity */ alert('Download image not enabled here.'); });
if (btnSave) btnSave.addEventListener("click", async ()=> {
  if(!currentUser) return alert('Sign in to save to cloud.');
  try{
    const payload = {
      collected, high,
      name: currentProfile?.name || null,
      slug: currentProfile?.slug || null,
      photoUrl: currentProfile?.profilePhotoUrl || null,
      lastUpdated: serverTimestamp(),
      clientTs: new Date().toISOString()
    };
    await setDoc(doc(db, 'gameScores', currentUser.uid), payload, { merge: true });
    alert('Saved to cloud.');
  }catch(e){ console.error(e); alert('Save failed'); }
});

/* ----------------------------
   Audio (kept minimal)
---------------------------- */
let audioCtx = null;
function ensureAudio(){ if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }
function playTone(freq=720, dur=0.06){ try{ ensureAudio(); const o = audioCtx.createOscillator(); const g = audioCtx.createGain(); o.type='sine'; o.frequency.value=freq; o.connect(g); g.connect(audioCtx.destination); const now = audioCtx.currentTime; g.gain.setValueAtTime(0.001, now); g.gain.exponentialRampToValueAtTime(0.12, now + 0.01); g.gain.exponentialRampToValueAtTime(0.0001, now + dur); o.start(now); o.stop(now + dur + 0.02);}catch(e){} }
document.addEventListener('pointerdown', ()=> ensureAudio(), { once:true });

/* ----------------------------
   Auth State & live slug
---------------------------- */
onAuthStateChanged(auth, async (user) => {
  if (userPrivUnsub) { try { userPrivUnsub(); } catch(_){} userPrivUnsub = null; }
  currentUser = user;
  if (!user) {
    currentProfile = null;
    updateHUD();
    return;
  }
  try {
    const privRef = doc(db, 'usersPrivate', user.uid);
    userPrivUnsub = onSnapshot(privRef, (snap) => {
      if (snap.exists()) {
        currentProfile = snap.data();
      } else {
        currentProfile = { name: user.displayName || null, slug: null, profilePhotoUrl: user.photoURL || null };
      }
      updateHUD();
    }, (err) => {
      console.warn('usersPrivate snapshot error', err);
      currentProfile = { name: user.displayName || null, slug: null, profilePhotoUrl: user.photoURL || null };
      updateHUD();
    });
  } catch(e){
    console.warn('usersPrivate subscription failed', e);
    currentProfile = { name: user.displayName || null, slug: null, profilePhotoUrl: user.photoURL || null };
    updateHUD();
  }
});

/* ----------------------------
   Update Profile Button (photo)
---------------------------- */
function updateProfileButton(){
  try {
    const u = currentUser;
    if (!profileBtn) return;
    if (u) {
      if (u.photoURL) {
        profileBtn.innerHTML = `<img src="${u.photoURL}" alt="Profile" style="width:36px;height:36px;border-radius:50%;">`;
      } else {
        profileBtn.innerHTML = `<i class="fa-solid fa-user"></i>`;
      }
      profileBtn.title = currentProfile?.name || u.displayName || u.email || "Profile";
    } else {
      profileBtn.innerHTML = 'Sign In';
      profileBtn.title = 'Sign In';
    }
  } catch(e){ console.warn('updateProfileBtn err', e); }
}

/* ----------------------------
   Left HUD + Play Full button + global stars injection (initial UI)
---------------------------- */
(function injectLeftHudAndButtonAndStars(){
  // left hud
  if(playCard && !document.querySelector('.hud-left')){
    const hudLeft = document.createElement('div');
    hudLeft.className = 'hud-left';
    hudLeft.innerHTML = `
      <div class="avatar">ðŸŒŒ</div>
      <div class="text">
        <div class="title">Orbit Playground</div>
        <div class="subtitle">Play & Collect</div>
      </div>
    `;
    playCard.appendChild(hudLeft);
  }
  // play full btn
  if(playCard && !document.querySelector('.play-full-btn')){
    const btn = document.createElement('button');
    btn.className = 'play-full-btn';
    btn.innerHTML = '<i class="fa-solid fa-rocket"></i><span>Play Full Game</span>';
    btn.addEventListener('click', ()=> { window.location.href = '/teamgalaxy/game/full_game.html'; });
    playCard.appendChild(btn);
  }
  // global stars (already inserted in part1 but ensure filling on load)
  const starContainer = document.getElementById('stars');
  if(starContainer && starContainer.children.length === 0){
    const STAR_COUNT = Math.max(80, Math.round(window.innerWidth * 0.08));
    for(let i=0;i<STAR_COUNT;i++){
      const el = document.createElement('div');
      el.className = 'star';
      const size = (Math.random()*2.2)+0.6;
      el.style.width = size + 'px';
      el.style.height = size + 'px';
      el.style.left = (Math.random()*100).toFixed(2) + '%';
      el.style.top = (Math.random()*100).toFixed(2) + '%';
      el.style.opacity = (0.12 + Math.random()*0.88).toFixed(2);
      el.style.setProperty('--duration', (2 + Math.random()*6) + 's');
      starContainer.appendChild(el);
    }
  }
})();

/* ----------------------------
   Nebula init, draw start & auto spawn
---------------------------- */
function start(){
  DPR = Math.max(1, window.devicePixelRatio || 1);
  resizeGame();
  initNebula();
  // initial orbs
  for(let i=0;i<5;i++) spawnOrbAt();
  updateHUD();
  requestAnimationFrame(draw);
  // auto spawn
  setInterval(()=> { if (orbs.length < MAX_ORBS) {
    if(Math.random() < 0.22){
      for(let i=0;i<3;i++) spawnOrbAt();
    } else spawnOrbAt();
  } }, AUTO_SPAWN_INTERVAL);
}
window.addEventListener('load', start);

/* ----------------------------
   Prevent overlapping HUD on mobile (adjust positions)
---------------------------- */
(function guardHudOverlap(){
  function fix(){
    const hudLeft = document.querySelector('.hud-left');
    const hudRight = document.querySelector('.hud-small');
    if(!hudLeft || !hudRight) return;
    if(window.innerWidth < 900){
      hudLeft.style.position = 'static';
      hudLeft.style.margin = '10px auto 6px';
    } else {
      hudLeft.style.position = 'absolute';
      hudLeft.style.left = '16px';
      hudLeft.style.top = '14px';
      hudLeft.style.margin = '';
    }
  }
  window.addEventListener('resize', fix);
  setTimeout(fix, 60);
})();
</script>

</body>
</html>