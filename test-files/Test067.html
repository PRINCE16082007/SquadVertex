<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Repo Stats Card ‚Äî SquadVertex</title>
    
    <style>
        :root{
            --bg:#0f0f0f;--card:rgba(30,30,40,0.85);--muted:#b0b0b0;--gold:#ffd700;--accent:linear-gradient(45deg,#ffd700,#ff8c00);
            --blue: #3b82f6; --orange: #f97316; --purple: #a855f7; --green: #10b981; --red: #ef4444; --yellow: #eab308;
        }
        *{box-sizing:border-box;margin:0;padding:0}
        body{font-family: "Segoe UI", Tahoma, Verdana, sans-serif; background:var(--bg); color:#fff; padding:18px; min-height:100vh}
        .container{max-width:1200px;margin:0 auto}
        .header{background:var(--card);padding:18px;border-radius:12px;border:1px solid rgba(255,215,0,0.12);text-align:center;margin-bottom:14px}
        .header h1{background:var(--accent);-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-size:1.8rem}
        
        /* Bento grid styles */
        .bento-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .stat-card {
            background: rgba(30,30,40,0.8);
            border-radius: 12px;
            padding: 1rem;
            border: 1px solid rgba(255,215,0,0.06);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        .stat-card:hover {
            transform: translateY(-2px);
            border-color: var(--gold);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .stat-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }
        .stat-label {
            font-size: 0.9rem;
            color: var(--muted);
        }
        
        /* Key stats cards */
        .loc-card { border-top: 3px solid var(--blue); }
        .loc-card .stat-value { color: var(--blue); }
        
        .size-card { border-top: 3px solid var(--orange); }
        .size-card .stat-value { color: var(--orange); }
        
        .files-card { border-top: 3px solid var(--purple); }
        .files-card .stat-value { color: var(--purple); }
        
        .age-card { border-top: 3px solid var(--green); }
        .age-card .stat-value { color: var(--green); }
        
        /* Tech stack badges */
        .tech-stack {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        .tech-badge {
            background: rgba(255,215,0,0.1);
            color: var(--gold);
            padding: 0.25rem 0.75rem;
            border-radius: 99px;
            font-size: 0.8rem;
            font-weight: 500;
            border: 1px solid rgba(255,215,0,0.2);
        }
        
        /* Spaghetti meter */
        .spaghetti-meter {
            background: rgba(30,30,40,0.8);
            border-radius: 12px;
            padding: 1rem;
            border: 1px solid rgba(255,215,0,0.06);
            margin-top: 1rem;
        }
        .spaghetti-title {
            font-weight: bold;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .spaghetti-bar-container {
            height: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 5px;
            overflow: hidden;
            margin: 0.5rem 0;
        }
        .spaghetti-bar {
            height: 100%;
            width: 0%;
            border-radius: 5px;
            transition: width 1s ease;
        }
        .spaghetti-clean { background: var(--green); }
        .spaghetti-medium { background: var(--yellow); }
        .spaghetti-high { background: var(--orange); }
        .spaghetti-max { background: var(--red); }
        .spaghetti-text {
            font-size: 0.9rem;
            color: var(--muted);
            margin-top: 0.25rem;
        }
        
        /* Bus factor */
        .bus-factor {
            background: rgba(30,30,40,0.8);
            border-radius: 12px;
            padding: 1rem;
            border: 1px solid rgba(255,215,0,0.06);
            margin-top: 1rem;
        }
        .bus-title {
            font-weight: bold;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .bus-factor-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 0.5rem 0;
        }
        .bus-low { color: var(--green); }
        .bus-medium { color: var(--yellow); }
        .bus-high { color: var(--orange); }
        .bus-critical { color: var(--red); }
        
        /* Alert cards */
        .alert-card {
            background: rgba(30,30,40,0.8);
            border-radius: 12px;
            padding: 1rem;
            border: 1px solid rgba(255,215,0,0.06);
            margin-top: 1rem;
            border-left: 4px solid var(--red);
        }
        .alert-title {
            font-weight: bold;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .alert-content {
            font-size: 0.9rem;
            color: var(--muted);
        }
        
        .loading { color: var(--muted); padding: 10px; text-align: center; }
        .error { background: rgba(239,68,68,0.08); border: 1px solid #ef4444; color: #ffb3b3; padding: 10px; border-radius: 8px; margin: 8px 0; text-align: center; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Repo Stats Card Generator</h1>
            <div style="color:var(--muted);margin-top:6px">Beautiful stats visualization from provided data</div>
        </div>
        
        <div id="loading" class="loading" style="display:none">Loading stats...</div>
        <div id="error" class="error" style="display:none"></div>
        <div id="statsCardContainer"></div>
    </div>
    
    <script>
        // Function to extract query parameters
        function getUrlParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }
        
        // Function to render stats card
        function renderStatsCard(data) {
            const container = document.getElementById('statsCardContainer');
            
            // Validate input data
            if (!data || typeof data !== 'object') {
                showError('Invalid data provided for stats card');
                return;
            }
            
            // Create the stats card HTML
            let html = '<div class="bento-grid">';
            
            // LOC card
            if (data.totalLoc !== undefined) {
                html += `
                <div class="stat-card loc-card">
                    <div class="stat-icon">üìù</div>
                    <div class="stat-value">${formatNumber(data.totalLoc)}</div>
                    <div class="stat-label">Lines of Code</div>
                </div>`;
            }
            
            // Files card
            if (data.totalFiles !== undefined) {
                html += `
                <div class="stat-card files-card">
                    <div class="stat-icon">üìÅ</div>
                    <div class="stat-value">${formatNumber(data.totalFiles)}</div>
                    <div class="stat-label">Total Files</div>
                </div>`;
            }
            
            // Size card
            if (data.totalSize !== undefined) {
                html += `
                <div class="stat-card size-card">
                    <div class="stat-icon">üìä</div>
                    <div class="stat-value">${formatBytes(data.totalSize)}</div>
                    <div class="stat-label">Total Size</div>
                </div>`;
            }
            
            // Repo age card
            if (data.repoAge !== undefined) {
                html += `
                <div class="stat-card age-card">
                    <div class="stat-icon">üìÖ</div>
                    <div class="stat-value">${data.repoAge}</div>
                    <div class="stat-label">Repo Age</div>
                </div>`;
            }
            
            html += '</div>';
            
            // Add tech stack if available
            if (data.techStack && Array.isArray(data.techStack) && data.techStack.length > 0) {
                html += '<div style="margin-top:1rem"><h3>Tech Stack</h3><div class="tech-stack">';
                data.techStack.slice(0, 10).forEach(tech => {
                    html += `<span class="tech-badge">${tech}</span>`;
                });
                if (data.techStack.length > 10) {
                    html += `<span class="tech-badge">+${data.techStack.length - 10} more</span>`;
                }
                html += '</div></div>';
            }
            
            // Add spaghetti meter if available
            if (data.spaghettiLevel !== undefined) {
                const spaghettiLevel = data.spaghettiLevel;
                let spaghettiClass = '';
                let spaghettiText = '';
                
                if (spaghettiLevel <= 3) {
                    spaghettiClass = 'spaghetti-clean';
                    spaghettiText = 'Clean Code üíé';
                } else if (spaghettiLevel <= 5) {
                    spaghettiClass = 'spaghetti-medium';
                    spaghettiText = 'Moderately Complex ‚ö†Ô∏è';
                } else if (spaghettiLevel <= 8) {
                    spaghettiClass = 'spaghetti-high';
                    spaghettiText = 'Complex Nesting üçù';
                } else {
                    spaghettiClass = 'spaghetti-max';
                    spaghettiText = `High Complexity üçù`;
                }
                
                html += `
                <div class="spaghetti-meter">
                    <div class="spaghetti-title">Spaghetti Meter üçù</div>
                    <div class="spaghetti-bar-container">
                        <div class="spaghetti-bar ${spaghettiClass}" id="spaghettiBar" style="width: 0%"></div>
                    </div>
                    <div class="spaghetti-text">Maximum indentation level: ${spaghettiLevel}</div>
                </div>`;
            }
            
            // Add bus factor if available
            if (data.busFactor !== undefined) {
                const busFactor = data.busFactor;
                let busClass = '';
                let busText = '';
                
                if (busFactor === 1) {
                    busClass = 'bus-critical';
                    busText = 'Critical Risk!';
                } else if (busFactor === 2) {
                    busClass = 'bus-high';
                    busText = 'High Risk!';
                } else if (busFactor <= 4) {
                    busClass = 'bus-medium';
                    busText = 'Medium Risk';
                } else {
                    busClass = 'bus-low';
                    busText = 'Low Risk';
                }
                
                const busDescription = data.busFactorDesc || 'Distribution of work among contributors';
                
                html += `
                <div class="bus-factor">
                    <div class="bus-title">Bus Factor üöå</div>
                    <div class="bus-factor-value ${busClass}">Factor: ${busFactor}</div>
                    <div class="description">${busDescription}</div>
                </div>`;
            }
            
            // Add important comments alert if high
            if (data.totalImportantComments > 10) {
                html += `
                <div class="alert-card">
                    <div class="alert-title">‚ö†Ô∏è High TODO Count</div>
                    <div class="alert-content">This repo has ${data.totalImportantComments} pending TODOs. Consider addressing them.</div>
                </div>`;
            }
            
            container.innerHTML = html;
            
            // Animate spaghetti bar after DOM is updated
            setTimeout(() => {
                const spaghettiBar = document.getElementById('spaghettiBar');
                if (spaghettiBar) {
                    const spaghettiLevel = data.spaghettiLevel;
                    const maxLevel = 10; // Max expected indentation level
                    const percentage = Math.min(100, (spaghettiLevel / maxLevel) * 100);
                    spaghettiBar.style.width = `${percentage}%`;
                }
            }, 100);
        }
        
        // Helper function to format numbers
        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }
        
        // Helper function to format bytes
        function formatBytes(bytes) {
            if (!bytes && bytes !== 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = bytes === 0 ? 0 : Math.floor(Math.log(bytes) / Math.log(k));
            return (bytes / Math.pow(k, i)).toFixed(2) + ' ' + sizes[i];
        }
        
        // Show error function
        function showError(msg) {
            document.getElementById('error').style.display = 'block';
            document.getElementById('error').textContent = msg;
            document.getElementById('loading').style.display = 'none';
        }
        
        // Initialize the stats card
        document.addEventListener('DOMContentLoaded', () => {
            // Try to get data from localStorage first
            const cachedData = localStorage.getItem('repoStats');
            if (cachedData) {
                try {
                    const data = JSON.parse(cachedData);
                    renderStatsCard(data);
                    return;
                } catch (e) {
                    console.error('Error parsing cached data:', e);
                }
            }
            
            // If no cached data, try to get from URL parameters
            const totalLoc = getUrlParameter('totalLoc');
            const totalFiles = getUrlParameter('totalFiles');
            const totalSize = getUrlParameter('totalSize');
            const repoAge = getUrlParameter('repoAge');
            const spaghettiLevel = getUrlParameter('spaghettiLevel');
            const busFactor = getUrlParameter('busFactor');
            const busFactorDesc = getUrlParameter('busFactorDesc');
            const totalImportantComments = getUrlParameter('totalImportantComments');
            
            // Parse numeric values
            const data = {};
            if (totalLoc) data.totalLoc = parseInt(totalLoc);
            if (totalFiles) data.totalFiles = parseInt(totalFiles);
            if (totalSize) data.totalSize = parseInt(totalSize);
            if (repoAge) data.repoAge = repoAge;
            if (spaghettiLevel) data.spaghettiLevel = parseInt(spaghettiLevel);
            if (busFactor) data.busFactor = parseInt(busFactor);
            if (busFactorDesc) data.busFactorDesc = busFactorDesc;
            if (totalImportantComments) data.totalImportantComments = parseInt(totalImportantComments);
            
            // Get tech stack from URL parameter (comma-separated)
            const techStackParam = getUrlParameter('techStack');
            if (techStackParam) {
                data.techStack = techStackParam.split(',');
            }
            
            // Validate if we have at least one stat to show
            const hasStats = Object.keys(data).some(key => data[key] !== undefined && data[key] !== '');
            if (hasStats) {
                renderStatsCard(data);
            } else {
                showError('No valid stats data provided in URL parameters');
            }
        });
    </script>
</body>
</html>