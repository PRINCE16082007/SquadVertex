<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SV Schedule Tracker</title>
  <meta name="theme-color" content="#000000">
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Pacifico&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root { --primary-color: #ff758c; }
    body { background: linear-gradient(135deg,#fff5f5,#ffe3e3); font-family:'Pacifico',cursive; margin:0; min-height:100vh; position:relative; padding-bottom:60px; }
    .container{max-width:1200px;margin:0 auto;padding:2rem;}
    .header{ text-align:center;padding:2rem; background:url('https://dl.dropboxusercontent.com/scl/fi/g7uokxp1jcb5xfunpnj0b/wp12130683-alice-in-borderland-netflix-wallpapers-1-1.jpg') center/cover;border-radius:20px;margin-bottom:2rem;box-shadow:0 8px 32px rgba(255,118,117,0.2); }
    .btn { background:#fff;color:var(--primary-color);border:2px solid var(--primary-color);padding:0.8rem 1.5rem;border-radius:30px;font-size:1rem;cursor:pointer;transition:all 0.3s ease;margin:0.5rem; }
    .btn:hover{background:var(--primary-color);color:#fff;box-shadow:0 4px 15px rgba(255,117,140,0.4);}
    .modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:none;align-items:center;justify-content:center;z-index:1000;}
    .modal{background:#fff;padding:2rem;border-radius:8px;max-width:400px;width:90%;position:relative;}
    .modal h3{margin-top:0;color:var(--primary-color);}
    .modal label{display:block;margin:0.5rem 0 0.2rem;font-size:0.9rem;}
    .modal input{width:100%;padding:0.5rem;border:1px solid #ccc;border-radius:4px;}
    .modal .actions{text-align:right;margin-top:1rem;}
    .close-btn{position:absolute;top:10px;right:10px;background:none;border:none;font-size:1.2rem;cursor:pointer;}
    .quote-container{background:rgba(255,255,255,0.9);padding:2rem;border-radius:15px;margin:2rem 0;border:2px solid var(--primary-color);}    
    .quote{font-family:'Great Vibes',cursive;font-size:2.2rem;color:#ff4d6d;text-shadow:2px 2px 4px rgba(255,77,109,0.2);margin:0;}
    .streak-box, .chart-container, .gallery {margin:2rem 0;}
    .streak-box{background:linear-gradient(45deg,#ff758c,#ff7eb3);padding:2rem;border-radius:20px;color:#fff;text-align:center;box-shadow:0 4px 30px rgba(255,118,117,0.3);}
    .calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:5px;background:#fff;padding:1rem;border-radius:15px;}
    .day-cell{padding:10px;text-align:center;border-radius:8px;background:#ffe8ec;min-height:50px;display:flex;align-items:center;justify-content:center;}
    .completed-day{background:#ff758c;color:#fff;}
    .gallery{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1.5rem;}
    .gallery img{width:100%;height:300px;object-fit:cover;border-radius:15px;transition:transform .3s;box-shadow:0 8px 24px rgba(0,0,0,0.1);}    
    .gallery img:hover{transform:scale(1.05);}
    .task-list {margin:2rem 0; background:rgba(255,255,255,0.9); padding:1rem; border-radius:15px;}
    .task-item {display:flex; align-items:center; padding:1rem; border-bottom:1px solid #eee;}
    .task-item:last-child {border-bottom:none;}
    .task-checkbox, .routine-checkbox {margin-right:1rem;}
    .task-content {flex-grow:1;}
    .task-actions button {margin-left:0.5rem; background:none; border:1px solid var(--primary-color); border-radius:5px; padding:0.3rem 0.7rem;cursor:pointer;}
    .footer {text-align:center; padding:1rem; font-family:Arial; color:#666; margin-top:2rem;}
  </style>
</head>
<body>
  <div class="auth-container" id="authContainer" style="display:none; text-align:center; padding:2rem;">
    <button class="btn" id="signInBtn">Sign in with Google üå∏</button>
  </div>
  <div class="container" id="mainContainer" style="display:none;">
    <div class="user-info" id="userInfo"></div>
    <div class="header"><h1>üåπ My Eternal Growth Journey üåπ</h1></div>
    <div style="text-align:center;">
      <button class="btn" id="addTaskBtn">Add Task</button>
      <button class="btn" id="addRoutineBtn">Add Routine</button>
    </div>
    <div class="task-list" id="taskList"></div>
    <div class="task-list" id="routineList"></div>
    <div class="quote-container animate__animated animate__fadeIn"><p class="quote" id="dynamicQuote"></p></div>
    <div class="streak-box">
      üî• Current Streak: <span id="currentStreak">0</span> days &nbsp;&nbsp; üå∏ Longest Streak: <span id="longestStreak">0</span> days<br><br>
      <button class="btn" id="markBtn">Mark Today üíñ</button>
      <button class="btn" id="resetBtn">Reset üåº</button>
    </div>
    <div class="calendar" id="calendar"></div>
    <div class="chart-container"><canvas id="progressChart"></canvas></div>
       <div class="gallery">
     </div>
  </div>
  <div class="modal-overlay" id="taskModal">
    <div class="modal">
      <button class="close-btn" id="closeTaskModal">&times;</button>
      <h3>Add / Edit Task</h3>
      <label for="taskTime">Time</label>
      <input type="time" id="taskTime">
      <label for="taskDuration">Duration</label>
      <input type="text" id="taskDuration" placeholder="e.g. 30m">
      <label for="taskDesc">Description</label>
      <input type="text" id="taskDesc">
      <div class="actions"><button class="btn" id="saveTaskBtn">Save Task</button></div>
    </div>
  </div>
  <div class="modal-overlay" id="routineModal">
    <div class="modal">
      <button class="close-btn" id="closeRoutineModal">&times;</button>
      <h3>Add Routine</h3>
      <label for="routineDesc">Routine</label>
      <input type="text" id="routineDesc" placeholder="e.g. No phone after 9pm">
      <div class="actions"><button class="btn" id="saveRoutineBtn">Save Routine</button></div>
    </div>
  </div>
  <div class="footer">SquadVertex ¬© 2024 - Cultivating Eternal Growth</div>  <script type="module">
    const firebaseConfig = {
      apiKey: "AIzaSyBV7Jg0BVzeCNQW9oiIiNItnejUsjj2DhA",
      authDomain: "squadvertex2007.firebaseapp.com",
      projectId: "squadvertex2007",
      storageBucket: "squadvertex2007.appspot.com",
      messagingSenderId: "168905083514",
      appId: "1:168905083514:web:c8bbe2ce9f87800a0f09c3",
    };

    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
    import { 
      getFirestore, collection, addDoc, getDocs, query, 
      where, orderBy, doc, getDoc, updateDoc, deleteDoc 
    } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js";
    import { 
      getAuth, GoogleAuthProvider, signInWithPopup, 
      onAuthStateChanged, signOut 
    } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js";

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();
    let currentDate = new Date();
    let chart = null;
    let editingTaskId = null;
    const quotes = [
      "The flower that blooms in adversity is the most rare and beautiful of all.",
      "Every master was once a disaster. Keep going.",
      "Growth is painful. Change is painful. But nothing is as painful as staying stuck where you don't belong.",
      "The secret of getting ahead is getting started."
    ];

    // Global error handling
    window.addEventListener('error', (e) => {
      console.error('Global error:', e.error);
      alert(`Error: ${e.message}`);
    });

    // Auth state management
    onAuthStateChanged(auth, async (user) => {
      try {
        if (user) {
          document.getElementById('mainContainer').style.display = 'block';
          document.getElementById('authContainer').style.display = 'none';
          document.getElementById('userInfo').innerHTML = `
            üë§ ${user.email} <br>
            <button class="btn" onclick="handleSignOut()">Sign out</button>
          `;
          await initApp(user);
        } else {
          document.getElementById('mainContainer').style.display = 'none';
          document.getElementById('authContainer').style.display = 'block';
        }
      } catch (error) {
        console.error('Auth state error:', error);
        alert('Authentication error. Please refresh.');
      }
    });

    // Sign in handler
    document.getElementById('signInBtn').addEventListener('click', async () => {
      try {
        await signInWithPopup(auth, provider);
      } catch (error) {
        console.error('Sign in error:', error);
        alert('Sign in failed. Please try again.');
      }
    });

    // Sign out handler
    window.handleSignOut = async () => {
      try {
        await signOut(auth);
      } catch (error) {
        console.error('Sign out error:', error);
      }
    };

    // Main initialization
    async function initApp(user) {
      try {
        showRandomQuote();
        initChart();
        await Promise.all([
          renderCalendar(user.uid),
          updateStreakDisplay(user.uid),
          loadGallery(),
          loadTasks(user.uid),
          loadRoutines(user.uid)
        ]);
      } catch (error) {
        console.error('Initialization error:', error);
        alert('Failed to initialize app. Please refresh.');
      }
    }

    function showRandomQuote() {
      document.getElementById('dynamicQuote').textContent = 
        quotes[Math.floor(Math.random() * quotes.length)];
    }

    function initChart() {
      const ctx = document.getElementById('progressChart').getContext('2d');
      if (chart) chart.destroy();
      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: [],
          datasets: [{
            label: 'Streak',
            data: [],
            borderColor: '#ff758c',
            tension: 0.1
          }]
        },
        options: {
          responsive: true,
          scales: { y: { display: false } }
        }
      });
    }

    async function renderCalendar(uid) {
      try {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        const first = new Date(year, month, 1);
        const last = new Date(year, month + 1, 0);
        const start = first.toISOString().split('T')[0];
        const end = last.toISOString().split('T')[0];

        const snap = await getDocs(query(
          collection(db, 'users', uid, 'dailyRecords'),
          where('date', '>=', start),
          where('date', '<=', end)
        ));
        
        const doneDates = snap.docs.map(d => d.data().date);
        const cal = document.getElementById('calendar');
        cal.innerHTML = '';

        // Create weekday headers
        ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'].forEach(d => {
          const header = document.createElement('div');
          header.textContent = d;
          header.style.fontWeight = 'bold';
          cal.appendChild(header);
        });

        // Fill empty days
        for (let i = 0; i < first.getDay(); i++) {
          cal.appendChild(document.createElement('div'));
        }

        // Create day cells
        for (let d = 1; d <= last.getDate(); d++) {
          const dateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
          const cell = document.createElement('div');
          cell.className = `day-cell ${doneDates.includes(dateStr) ? 'completed-day' : ''}`;
          cell.textContent = d;
          cal.appendChild(cell);
        }
      } catch (error) {
        console.error('Calendar error:', error);
      }
    }

    async function updateStreakDisplay(uid) {
      try {
        const dataSnap = await getDocs(query(
          collection(db, 'users', uid, 'dailyRecords'),
          orderBy('date')
        ));
        const data = dataSnap.docs.map(d => d.data());
        
        let currentStreak = 0;
        let longestStreak = 0;
        let tempStreak = 0;

        data.forEach(record => {
          if (record.status === 'Yes') {
            tempStreak++;
            currentStreak = tempStreak;
            if (tempStreak > longestStreak) {
              longestStreak = tempStreak;
            }
          } else {
            tempStreak = 0;
          }
        });

        document.getElementById('currentStreak').textContent = currentStreak;
        document.getElementById('longestStreak').textContent = longestStreak;

        if (chart) {
          chart.data.labels = data.map(d => d.date);
          chart.data.datasets[0].data = data.map(d => d.status === 'Yes' ? 1 : 0);
          chart.update();
        }
      } catch (error) {
        console.error('Streak update error:', error);
      }
    }

    function loadGallery() {
      try {
        const images = [
          'https://dl.dropboxusercontent.com/scl/fi/zhvuv6098pxqexclylyxr/1744702103477.jpg?rlkey=hv7zjumzyggtyn0bsjecqu6te&st=txjpjxaj&dl=0',
          // ... other image URLs
        ];
        
        const gallery = document.getElementById('gallery');
        gallery.innerHTML = '';
        
        images.forEach(src => {
          const img = document.createElement('img');
          img.src = src;
          img.alt = 'Motivational image';
          gallery.appendChild(img);
        });
      } catch (error) {
        console.error('Gallery error:', error);
      }
    }

    // Task management functions
    async function loadTasks(uid) {
      try {
        const today = new Date().toISOString().split('T')[0];
        const q = query(
          collection(db, 'users', uid, 'tasks'),
          where('date', '==', today),
          orderBy('time')
        );
        
        const snap = await getDocs(q);
        const list = document.getElementById('taskList');
        list.innerHTML = snap.empty 
          ? '<div class="task-item">No tasks for today! üå∏</div>' 
          : '';

        snap.docs.forEach(async (docSnapshot) => {
          const task = docSnapshot.data();
          const item = document.createElement('div');
          item.className = 'task-item';
          item.innerHTML = `
            <input type="checkbox" 
                   class="task-checkbox" 
                   data-id="${docSnapshot.id}" 
                   ${task.done ? 'checked' : ''}>
            <div class="task-content">
              <strong>${task.time}</strong> - ${task.desc} (${task.duration})
            </div>
            <div class="task-actions">
              <button class="edit-btn" data-id="${docSnapshot.id}">‚úèÔ∏è</button>
              <button class="delete-btn" data-id="${docSnapshot.id}">üóëÔ∏è</button>
            </div>
          `;

          // Checkbox handler
          item.querySelector('.task-checkbox').addEventListener('change', async (e) => {
            try {
              await updateDoc(doc(db, 'users', uid, 'tasks', e.target.dataset.id), {
                done: e.target.checked
              });
            } catch (error) {
              console.error('Task update error:', error);
              e.target.checked = !e.target.checked;
              alert('Failed to update task status');
            }
          });

          list.appendChild(item);
        });

        // Event delegation for buttons
        list.addEventListener('click', async (e) => {
          try {
            const taskId = e.target.dataset.id;
            
            if (e.target.classList.contains('delete-btn')) {
              if (confirm('Delete this task permanently?')) {
                await deleteDoc(doc(db, 'users', uid, 'tasks', taskId));
                await loadTasks(uid);
              }
            }
            
            if (e.target.classList.contains('edit-btn')) {
              const docRef = doc(db, 'users', uid, 'tasks', taskId);
              const docSnap = await getDoc(docRef);
              
              if (docSnap.exists()) {
                const taskData = docSnap.data();
                editingTaskId = taskId;
                document.getElementById('taskTime').value = taskData.time;
                document.getElementById('taskDuration').value = taskData.duration;
                document.getElementById('taskDesc').value = taskData.desc;
                document.getElementById('taskModal').style.display = 'flex';
              }
            }
          } catch (error) {
            console.error('Task action error:', error);
          }
        });

      } catch (error) {
        console.error('Task load error:', error);
        list.innerHTML = '<div class="task-item">Error loading tasks ‚ö†Ô∏è</div>';
      }
    }

    // Routine management functions
    async function loadRoutines(uid) {
      try {
        const today = new Date().toISOString().split('T')[0];
        const q = query(
          collection(db, 'users', uid, 'rules'),
          where('date', '==', today),
          orderBy('date')
        );
        
        const snap = await getDocs(q);
        const list = document.getElementById('routineList');
        list.innerHTML = snap.empty 
          ? '<div class="task-item">No routines for today! üåº</div>' 
          : '';

        snap.docs.forEach(async (docSnapshot) => {
          const routine = docSnapshot.data();
          const item = document.createElement('div');
          item.className = 'task-item';
          item.innerHTML = `
            <input type="checkbox" 
                   class="routine-checkbox" 
                   data-id="${docSnapshot.id}" 
                   ${routine.active ? 'checked' : ''}>
            <div class="task-content">${routine.desc}</div>
            <div class="task-actions">
              <button class="delete-btn" data-id="${docSnapshot.id}">üóëÔ∏è</button>
            </div>
          `;

          // Checkbox handler
          item.querySelector('.routine-checkbox').addEventListener('change', async (e) => {
            try {
              await updateDoc(doc(db, 'users', uid, 'rules', e.target.dataset.id), {
                active: e.target.checked
              });
            } catch (error) {
              console.error('Routine update error:', error);
              e.target.checked = !e.target.checked;
              alert('Failed to update routine status');
            }
          });

          list.appendChild(item);
        });

        // Delete handler
        list.addEventListener('click', async (e) => {
          try {
            if (e.target.classList.contains('delete-btn')) {
              if (confirm('Delete this routine permanently?')) {
                await deleteDoc(doc(db, 'users', uid, 'rules', e.target.dataset.id));
                await loadRoutines(uid);
              }
            }
          } catch (error) {
            console.error('Routine action error:', error);
          }
        });

      } catch (error) {
        console.error('Routine load error:', error);
        list.innerHTML = '<div class="task-item">Error loading routines ‚ö†Ô∏è</div>';
      }
    }

    // Modal handlers
    const taskModal = document.getElementById('taskModal');
    const routineModal = document.getElementById('routineModal');

    document.getElementById('addTaskBtn').addEventListener('click', () => {
      editingTaskId = null;
      document.getElementById('taskTime').value = '';
      document.getElementById('taskDuration').value = '';
      document.getElementById('taskDesc').value = '';
      taskModal.style.display = 'flex';
    });

    document.getElementById('addRoutineBtn').addEventListener('click', () => {
      document.getElementById('routineDesc').value = '';
      routineModal.style.display = 'flex';
    });

    // Close modal handlers
    document.querySelectorAll('.close-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        taskModal.style.display = 'none';
        routineModal.style.display = 'none';
      });
    });

    // Save task handler
    document.getElementById('saveTaskBtn').addEventListener('click', async () => {
      try {
        const user = auth.currentUser;
        const taskData = {
          time: document.getElementById('taskTime').value,
          duration: document.getElementById('taskDuration').value,
          desc: document.getElementById('taskDesc').value,
          date: new Date().toISOString().split('T')[0],
          done: false
        };

        if (editingTaskId) {
          await updateDoc(doc(db, 'users', user.uid, 'tasks', editingTaskId), taskData);
        } else {
          await addDoc(collection(db, 'users', user.uid, 'tasks'), taskData);
        }

        taskModal.style.display = 'none';
        await loadTasks(user.uid);
      } catch (error) {
        console.error('Save task error:', error);
        alert('Failed to save task');
      }
    });

    // Save routine handler
    document.getElementById('saveRoutineBtn').addEventListener('click', async () => {
      try {
        const user = auth.currentUser;
        const routineData = {
          desc: document.getElementById('routineDesc').value,
          date: new Date().toISOString().split('T')[0],
          active: false
        };

        await addDoc(collection(db, 'users', user.uid, 'rules'), routineData);
        routineModal.style.display = 'none';
        await loadRoutines(user.uid);
      } catch (error) {
        console.error('Save routine error:', error);
        alert('Failed to save routine');
      }
    });

    // Mark today handler
    document.getElementById('markBtn').addEventListener('click', async () => {
      try {
        const user = auth.currentUser;
        const today = new Date().toISOString().split('T')[0];

        // Check incomplete tasks
        const tasksSnap = await getDocs(query(
          collection(db, 'users', user.uid, 'tasks'),
          where('date', '==', today),
          where('done', '==', false)
        ));

        // Check inactive routines
        const routinesSnap = await getDocs(query(
          collection(db, 'users', user.uid, 'rules'),
          where('date', '==', today),
          where('active', '==', false)
        ));

        if (!tasksSnap.empty || !routinesSnap.empty) {
          alert('Please complete all tasks and routines first! üí™');
          return;
        }

        // Update daily record
        const recordRef = doc(db, 'users', user.uid, 'dailyRecords', today);
        const recordSnap = await getDoc(recordRef);

        if (recordSnap.exists()) {
          await updateDoc(recordRef, { status: 'Yes' });
        } else {
          await setDoc(recordRef, { date: today, status: 'Yes' });
        }

        await updateStreakDisplay(user.uid);
        await renderCalendar(user.uid);
        alert('Day marked successfully! üéâ');
      } catch (error) {
        console.error('Mark day error:', error);
        alert('Failed to mark day');
      }
    });

    // Reset handler
    document.getElementById('resetBtn').addEventListener('click', async () => {
      try {
        if (!confirm('Are you sure you want to reset today? This cannot be undone!')) return;
        
        const user = auth.currentUser;
        const today = new Date().toISOString().split('T')[0];
        const recordRef = doc(db, 'users', user.uid, 'dailyRecords', today);
        
        if ((await getDoc(recordRef)).exists()) {
          await updateDoc(recordRef, { status: 'No' });
        } else {
          await setDoc(recordRef, { date: today, status: 'No' });
        }
        
        await updateStreakDisplay(user.uid);
        await renderCalendar(user.uid);
        alert('Day reset successfully. Fresh start! üå∏');
      } catch (error) {
        console.error('Reset error:', error);
        alert('Failed to reset day');
      }
    });
  </script></body>
</html>