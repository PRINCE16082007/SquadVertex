<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Support Dashboard | SquadVertex</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    :root {
      --primary: #7e3af2;
      --primary-dark: #5a20c9;
      --secondary: #c084fc;
      --light: #f9f7ff;
      --dark: #2d3748;
      --gray: #718096;
      --light-gray: #edf2f7;
      --white: #ffffff;
      --success: #0e9f6e;
      --warning: #f05252;
    }
    
    body {
      background-color: #f5f7fa;
      color: var(--dark);
      line-height: 1.6;
      padding: 20px;
    }
    
    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--light-gray);
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .logo-icon {
      font-size: 2.2rem;
      color: var(--primary);
    }
    
    .logo-text {
      font-size: 1.8rem;
      font-weight: 700;
      background: linear-gradient(90deg, var(--primary), var(--primary-dark));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .header-title {
      font-size: 1.8rem;
      font-weight: 600;
      color: var(--dark);
    }
    
    .user-profile {
      display: flex;
      align-items: center;
      gap: 12px;
      background: var(--white);
      padding: 10px 15px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }
    
    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--primary);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--white);
      font-weight: 600;
    }
    
    .user-details {
      display: flex;
      flex-direction: column;
    }
    
    .user-name {
      font-weight: 600;
    }
    
    .user-role {
      font-size: 0.85rem;
      color: var(--gray);
    }
    
    /* Stats */
    .stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      background: var(--white);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      display: flex;
      flex-direction: column;
      transition: all 0.3s ease;
    }
    
    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
    }
    
    .stat-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }
    
    .stat-title {
      font-size: 0.95rem;
      color: var(--gray);
      font-weight: 500;
    }
    
    .stat-icon {
      width: 44px;
      height: 44px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.3rem;
      background: rgba(126, 58, 242, 0.1);
      color: var(--primary);
    }
    
    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--dark);
      margin: 8px 0;
    }
    
    .stat-change {
      font-size: 0.85rem;
      display: flex;
      align-items: center;
      color: var(--success);
    }
    
    /* Table */
    .table-container {
      background: var(--white);
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      overflow: hidden;
      margin-bottom: 40px;
    }
    
    .table-header {
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid var(--light-gray);
    }
    
    .table-title {
      font-size: 1.4rem;
      font-weight: 600;
      color: var(--dark);
    }
    
    .search-bar {
      position: relative;
      width: 300px;
    }
    
    .search-bar input {
      padding: 10px 15px 10px 40px;
      border: 1px solid var(--light-gray);
      border-radius: 8px;
      width: 100%;
      font-size: 0.95rem;
      transition: all 0.3s ease;
    }
    
    .search-bar input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(126, 58, 242, 0.2);
    }
    
    .search-bar i {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--gray);
    }
    
    .table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .table th {
      background: var(--light);
      text-align: left;
      padding: 15px 20px;
      font-weight: 600;
      font-size: 0.95rem;
      color: var(--gray);
    }
    
    .table td {
      padding: 15px 20px;
      border-bottom: 1px solid var(--light-gray);
      font-size: 0.95rem;
    }
    
    .table tr:last-child td {
      border-bottom: none;
    }
    
    .table tr:hover td {
      background: rgba(126, 58, 242, 0.03);
    }
    
    .user-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .user-avatar-sm {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--primary);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--white);
      font-weight: 600;
      font-size: 0.95rem;
    }
    
    .user-details-sm {
      display: flex;
      flex-direction: column;
    }
    
    .user-name-sm {
      font-weight: 600;
      margin-bottom: 3px;
    }
    
    .user-email-sm {
      font-size: 0.85rem;
      color: var(--gray);
    }
    
    .channel-link {
      color: var(--primary);
      text-decoration: none;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: color 0.3s ease;
    }
    
    .channel-link:hover {
      color: var(--primary-dark);
      text-decoration: underline;
    }
    
    .payment-status {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 500;
    }
    
    .status-paid {
      background: rgba(14, 159, 110, 0.1);
      color: var(--success);
    }
    
    .status-pending {
      background: rgba(240, 82, 82, 0.1);
      color: var(--warning);
    }
    
    .action-btn {
      background: var(--primary);
      color: var(--white);
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 0.95rem;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
    }
    
    .action-btn:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(126, 58, 242, 0.2);
    }
    
    /* Chat Container */
    #chatContainer {
      display: none;
      background: var(--white);
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      margin-top: 30px;
      flex-direction: column;
      height: 600px;
    }
    
    .chat-header {
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid var(--light-gray);
      background: linear-gradient(90deg, var(--primary), var(--primary-dark));
      color: var(--white);
    }
    
    .chat-user {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .chat-title {
      font-size: 1.3rem;
      font-weight: 600;
    }
    
    .close-chat {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--white);
      font-size: 1.1rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .close-chat:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: rotate(90deg);
    }
    
    .chat-body {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 20px;
      background: #fafafa;
    }
    
    .message {
      max-width: 75%;
      padding: 15px;
      border-radius: 18px;
      position: relative;
      animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .message.admin {
      align-self: flex-end;
      background: var(--primary);
      color: var(--white);
      border-top-right-radius: 4px;
    }
    
    .message.creator {
      align-self: flex-start;
      background: var(--white);
      border: 1px solid var(--light-gray);
      border-top-left-radius: 4px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    }
    
    .message-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 0.85rem;
    }
    
    .message-author {
      font-weight: 600;
    }
    
    .message-time {
      opacity: 0.8;
    }
    
    .message-text {
      line-height: 1.5;
    }
    
    .chat-footer {
      padding: 15px;
      border-top: 1px solid var(--light-gray);
      background: var(--white);
    }
    
    .chat-input {
      display: flex;
      gap: 12px;
    }
    
    .chat-input input {
      flex: 1;
      padding: 12px 18px;
      border: 1px solid var(--light-gray);
      border-radius: 30px;
      font-size: 1rem;
      transition: all 0.3s ease;
    }
    
    .chat-input input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(126, 58, 242, 0.2);
    }
    
    .send-btn {
      background: var(--primary);
      color: var(--white);
      border: none;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 1.1rem;
    }
    
    .send-btn:hover {
      background: var(--primary-dark);
      transform: translateY(-3px);
    }
    
    /* Loading */
    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 30px;
    }
    
    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid rgba(126, 58, 242, 0.2);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Responsive */
    @media (max-width: 992px) {
      .table-container {
        overflow-x: auto;
      }
      
      .table {
        min-width: 800px;
      }
    }
    
    @media (max-width: 768px) {
      .dashboard-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 20px;
      }
      
      .stats-container {
        grid-template-columns: 1fr;
      }
      
      .search-bar {
        width: 100%;
        margin-top: 15px;
      }
    }
  </style>
</head>
<body>
  <!-- Dashboard Header -->
  <div class="dashboard-header">
    <div class="logo">
      <div class="logo-icon">
        <i class="fas fa-cube"></i>
      </div>
      <div class="logo-text">SquadVertex</div>
    </div>
    
    <h1 class="header-title">Support Team Dashboard</h1>
    
    <div class="user-profile">
      <div class="user-avatar">ST</div>
      <div class="user-details">
        <div class="user-name">Support Team</div>
        <div class="user-role">Admin</div>
      </div>
    </div>
  </div>
  
  <!-- Stats Cards -->
  <div class="stats-container">
    <div class="stat-card">
      <div class="stat-header">
        <div class="stat-title">Total Creators</div>
        <div class="stat-icon">
          <i class="fas fa-users"></i>
        </div>
      </div>
      <div class="stat-value" id="totalCreators">0</div>
      <div class="stat-change">
        <i class="fas fa-arrow-up"></i>
        <span>Loading...</span>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-header">
        <div class="stat-title">Active Chats</div>
        <div class="stat-icon">
          <i class="fas fa-comments"></i>
        </div>
      </div>
      <div class="stat-value" id="activeChats">0</div>
      <div class="stat-change">
        <i class="fas fa-arrow-up"></i>
        <span>Loading...</span>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-header">
        <div class="stat-title">Pending Requests</div>
        <div class="stat-icon">
          <i class="fas fa-clock"></i>
        </div>
      </div>
      <div class="stat-value" id="pendingRequests">0</div>
      <div class="stat-change">
        <i class="fas fa-arrow-down"></i>
        <span>Loading...</span>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-header">
        <div class="stat-title">Avg. Response Time</div>
        <div class="stat-icon">
          <i class="fas fa-stopwatch"></i>
        </div>
      </div>
      <div class="stat-value" id="responseTime">0m</div>
      <div class="stat-change">
        <i class="fas fa-arrow-up"></i>
        <span>Loading...</span>
      </div>
    </div>
  </div>
  
  <!-- Creators Table -->
  <div class="table-container">
    <div class="table-header">
      <div class="table-title">All Creators</div>
      <div class="search-bar">
        <i class="fas fa-search"></i>
        <input type="text" id="searchInput" placeholder="Search creators...">
      </div>
    </div>
    
    <table class="table">
      <thead>
        <tr>
          <th>Creator</th>
          <th>Age</th>
          <th>YouTube Channel</th>
          <th>Payment Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="creatorsTableBody">
        <tr>
          <td colspan="5" class="loading">
            <div class="spinner"></div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  
  <!-- Chat Container -->
  <div id="chatContainer">
    <div class="chat-header">
      <div class="chat-user">
        <div class="user-avatar" id="chatUserAvatar">C</div>
        <div>
          <div class="chat-title" id="chatUserName">Creator Name</div>
        </div>
      </div>
      <button class="close-chat" id="closeChat">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="chat-body" id="chatBody">
      <div class="message admin">
        <div class="message-header">
          <div class="message-author">Support Team</div>
          <div class="message-time">Just now</div>
        </div>
        <div class="message-text">
          Hello! How can I assist you with your event setup today?
        </div>
      </div>
    </div>
    
    <div class="chat-footer">
      <div class="chat-input">
        <input type="text" id="messageInput" placeholder="Type your message...">
        <button class="send-btn" id="sendMessage">
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
    </div>
  </div>
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  
  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBV7Jg0BVzeCNQW9oiIiNItnejUsjj2DhA",
      authDomain: "squadvertex2007.firebaseapp.com",
      projectId: "squadvertex2007",
      storageBucket: "squadvertex2007.appspot.com",
      messagingSenderId: "168905083514",
      appId: "1:168905083514:web:c8bbe2ce9f87800a0f09c3"
    };
    
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    
    // DOM elements
    const creatorsTableBody = document.getElementById('creatorsTableBody');
    const chatContainer = document.getElementById('chatContainer');
    const chatBody = document.getElementById('chatBody');
    const chatUserName = document.getElementById('chatUserName');
    const chatUserAvatar = document.getElementById('chatUserAvatar');
    const closeChatBtn = document.getElementById('closeChat');
    const messageInput = document.getElementById('messageInput');
    const sendMessageBtn = document.getElementById('sendMessage');
    const searchInput = document.getElementById('searchInput');
    
    // Variables to store current state
    let currentCreatorId = null;
    let creatorsData = [];
    
    // Fetch all creators
    function fetchCreators() {
      creatorsTableBody.innerHTML = `
        <tr>
          <td colspan="5" class="loading">
            <div class="spinner"></div>
          </td>
        </tr>
      `;
      
      db.collection("tickets").get()
        .then((querySnapshot) => {
          creatorsData = [];
          let tableContent = '';
          let creatorCount = 0;
          
          querySnapshot.forEach((doc) => {
            creatorCount++;
            const creator = doc.data();
            creatorsData.push({
              id: doc.id,
              ...creator
            });
            
            // Extract initials for avatar
            const nameParts = creator.name.split(' ');
            const initials = nameParts.length > 1 
              ? `${nameParts[0][0]}${nameParts[1][0]}` 
              : creator.name.substring(0, 2);
            
            tableContent += `
              <tr>
                <td>
                  <div class="user-info">
                    <div class="user-avatar-sm">${initials}</div>
                    <div class="user-details-sm">
                      <div class="user-name-sm">${creator.name}</div>
                      <div class="user-email-sm">${creator.email || 'No email'}</div>
                    </div>
                  </div>
                </td>
                <td>${creator.age}</td>
                <td>
                  <a href="${creator.ytLink}" target="_blank" class="channel-link">
                    <i class="fab fa-youtube"></i> ${creator.ytName}
                  </a>
                </td>
                <td>
                  <span class="payment-status ${creator.feesReady === 'yes' ? 'status-paid' : 'status-pending'}">
                    ${creator.feesReady === 'yes' ? 'Paid' : 'Pending'}
                  </span>
                </td>
                <td>
                  <button class="action-btn chat-btn" data-id="${doc.id}" data-name="${creator.name}" data-initials="${initials}">
                    <i class="fas fa-comment"></i> Chat
                  </button>
                </td>
              </tr>
            `;
          });
          
          // Update stats
          document.getElementById('totalCreators').textContent = creatorCount;
          document.getElementById('activeChats').textContent = Math.floor(creatorCount * 0.6);
          document.getElementById('pendingRequests').textContent = Math.floor(creatorCount * 0.3);
          document.getElementById('responseTime').textContent = '8m';
          
          creatorsTableBody.innerHTML = tableContent;
          
            // Add event listeners to chat buttons
          document.querySelectorAll('.chat-btn').forEach(btn => {
            btn.addEventListener('click', () => {
              openChat(
                btn.getAttribute('data-id'),
                btn.getAttribute('data-name'),
                btn.getAttribute('data-initials')
              );
            });
          });
        })
        .catch((error) => {
          console.error("Error fetching creators: ", error);
          creatorsTableBody.innerHTML = `
            <tr>
              <td colspan="5" style="text-align: center; padding: 30px; color: var(--warning);">
                <i class="fas fa-exclamation-triangle"></i> Failed to load creators. Please try again.
              </td>
            </tr>
          `;
        });
    }
    
    // Open chat with a creator
    function openChat(creatorId, creatorName, creatorInitials) {
      currentCreatorId = creatorId;
      chatUserName.textContent = creatorName;
      chatUserAvatar.textContent = creatorInitials;
      chatContainer.style.display = 'flex';
      
      // Clear chat body and add welcome message
      chatBody.innerHTML = `
        <div class="message admin">
          <div class="message-header">
            <div class="message-author">Support Team</div>
            <div class="message-time">Just now</div>
          </div>
          <div class="message-text">
            Hello ${creatorName}! How can I assist you with your event setup today?
          </div>
        </div>
      `;
      
      // Scroll to bottom
      chatBody.scrollTop = chatBody.scrollHeight;
      
      // Load previous messages
      loadMessages(creatorId);
    }
    
    // Load messages for a creator
    function loadMessages(creatorId) {
      db.collection("tickets").doc(creatorId).collection("messages")
        .orderBy("timestamp")
        .get()
        .then((querySnapshot) => {
          querySnapshot.forEach((doc) => {
            const message = doc.data();
            addMessageToChat(message.author, message.text, message.timestamp.toDate());
          });
        });
    }
    
    // Add message to chat UI
    function addMessageToChat(author, text, timestamp) {
      const isAdmin = author === "Support Team";
      const timeString = timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      
      const messageElement = document.createElement('div');
      messageElement.className = `message ${isAdmin ? 'admin' : 'creator'}`;
      messageElement.innerHTML = `
        <div class="message-header">
          <div class="message-author">${author}</div>
          <div class="message-time">${timeString}</div>
        </div>
        <div class="message-text">${text}</div>
      `;
      
      chatBody.appendChild(messageElement);
      
      // Scroll to bottom
      chatBody.scrollTop = chatBody.scrollHeight;
    }
    
    // Send message as admin
    function sendMessage() {
      const messageText = messageInput.value.trim();
      if (!messageText || !currentCreatorId) return;
      
      // Add message to UI immediately
      addMessageToChat(
        "Support Team", 
        messageText, 
        new Date()
      );
      
      // Save to Firebase
      db.collection("tickets").doc(currentCreatorId).collection("messages").add({
        author: "Support Team",
        text: messageText,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      })
      .catch((error) => {
        console.error("Error sending message: ", error);
      });
      
      // Clear input
      messageInput.value = '';
    }
    
    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      // Fetch creators on page load
      fetchCreators();
      
      // Close chat button
      closeChatBtn.addEventListener('click', () => {
        chatContainer.style.display = 'none';
        currentCreatorId = null;
      });
      
      // Send message button
      sendMessageBtn.addEventListener('click', sendMessage);
      
      // Send message on Enter key
      messageInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          sendMessage();
        }
      });
      
      // Search functionality
      searchInput.addEventListener('input', () => {
        const searchTerm = searchInput.value.toLowerCase();
        const rows = creatorsTableBody.querySelectorAll('tr');
        
        rows.forEach(row => {
          const name = row.querySelector('.user-name-sm').textContent.toLowerCase();
          const email = row.querySelector('.user-email-sm').textContent.toLowerCase();
          const channel = row.querySelector('.channel-link').textContent.toLowerCase();
          
          if (name.includes(searchTerm) || 
              email.includes(searchTerm) || 
              channel.includes(searchTerm)) {
            row.style.display = '';
          } else {
            row.style.display = 'none';
          }
        });
      });
    });
  </script>
</body>
</html>