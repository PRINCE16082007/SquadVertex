<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Set Up Your Event | SquadVertex</title>
  <style>
    /* Reset & base */
    *, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
    body { font-family: 'Poppins', sans-serif; background:#fafafa; color:#333; line-height:1.6; }
    a { color:#5b21b6; text-decoration:none; }

    /* Container */
    .container { max-width: 600px; margin: 3rem auto; padding: 0 1rem; }

    /* Hero */
    .hero { text-align:center; margin-bottom:2rem; }
    .hero h1 { font-size:2.25rem; background: linear-gradient(90deg, #7e3af2, #c084fc); -webkit-background-clip: text; color: transparent; }
    .hero p { font-size:1rem; opacity:0.8; margin-top:0.5rem; }

    /* Instructions */
    .info { background:#fff; padding:1rem; border-radius:6px; box-shadow:0 1px 4px rgba(0,0,0,0.03); margin-bottom:1.5rem; }
    .info p { font-size:0.95rem; }

    /* Chat */
    #chat { }
    #messages { max-height:300px; overflow-y:auto; background:#fff; padding:1rem; border-radius:6px; box-shadow:0 1px 4px rgba(0,0,0,0.03); }
    .msg { margin-bottom:0.75rem; }
    .msg .author { font-weight:600; margin-bottom:0.25rem; }
    .msg .text { font-size:0.95rem; }
    #chatInput { width:calc(100% - 110px); padding:0.6rem; border:1px solid #ccc; border-radius:4px; }
    #sendBtn { background:#7e3af2; color:#fff; border:none; padding:0.6rem 1rem; border-radius:4px; cursor:pointer; margin-left:0.5rem; }
  </style>
</head>
<body>
  <div class="container">
    <section class="hero">
      <h1>Set Up Your Event</h1>
      <p>Drop us a line with your event ideaâ€”videos, chat, voting. Weâ€™ll take it from there. ðŸš€</p>
    </section>

    <!-- Quick Instructions -->
    <div class="info">
      <p><strong>How it works:</strong> As soon as you type your first message, weâ€™ll see it in real time. Weâ€™ll reach out to plan your video-flow event, chat setup, voting rules, & fees. All messages auto-save in Firebaseâ€”no indexes needed.</p>
    </div>

    <!-- Chat UI -->
    <div id="chat">
      <div id="messages"></div>
      <div style="display:flex; margin-top:1rem;">
        <input type="text" id="chatInput" placeholder="Start typingâ€¦"/>
        <button id="sendBtn">Send</button>
      </div>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-firestore.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-auth.js";

    // Firebase init
    const firebaseConfig = {
      apiKey: "AIzaSyBV7Jg0BVzeCNQW9oiIiNItnejUsjj2DhA",
      authDomain: "squadvertex2007.firebaseapp.com",
      projectId: "squadvertex2007",
      storageBucket: "squadvertex2007.appspot.com",
      messagingSenderId: "168905083514",
      appId: "1:168905083514:web:c8bbe2ce9f87800a0f09c3",
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    let userUid;

    // 1ï¸âƒ£ Anonymous auth
    signInAnonymously(auth).catch(console.error);
    onAuthStateChanged(auth, user => {
      if (!user) return;
      userUid = user.uid;
      setupChatListener();
    });

    // 2ï¸âƒ£ Send message
    const input = document.getElementById("chatInput");
    const sendBtn = document.getElementById("sendBtn");
    sendBtn.addEventListener("click", async () => {
      const text = input.value.trim();
      if (!text) return;
      await addDoc(collection(db, "tickets", userUid, "messages"), {
        author: "Creator",
        text,
        timestamp: serverTimestamp()
      });
      input.value = "";
    });

    // 3ï¸âƒ£ Listen for incoming & own messages
    function setupChatListener() {
      const msgsRef = collection(db, "tickets", userUid, "messages");
      onSnapshot(msgsRef, snap => {
        const container = document.getElementById("messages");
        container.innerHTML = "";
        snap.docs
          .sort((a,b) => a.data().timestamp - b.data().timestamp)
          .forEach(doc => {
            const { author, text } = doc.data();
            const el = document.createElement("div");
            el.className = "msg";
            el.innerHTML = `<div class="author">${author}</div><div class="text">${text}</div>`;
            container.appendChild(el);
          });
        container.scrollTop = container.scrollHeight;
      });
    }
  </script>
</body>
</html>