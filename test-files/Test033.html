<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile - TeamGalaxy</title>
  <style>
    :root {
      --overlay-color: rgba(34, 16, 80, 0.12); /* matching-color overlay (edit opacity) */
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    html, body { height: 100%; }

    body {
      background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
      color: #e0e0ff;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      position: relative;
      overflow-x: hidden;
    }

    /* BACKGROUND IMAGE LAYER: replace URL inline or via CSS */
    .bg-layer {
      position: fixed;
      inset: 0;
      z-index: -4; /* farthest behind */
      background-position: center;
      background-size: cover;
      background-repeat: no-repeat;
      filter: brightness(0.55) saturate(0.95);
      transition: filter .35s ease;
      /* Example image - replace with your own: */
      /* background-image: url('path/to/your-image.jpg'); */
    }

    /* subtle overlay that tints the background with matching color */
    .bg-overlay {
      position: fixed;
      inset: 0;
      z-index: -3;
      background: var(--overlay-color);
      pointer-events: none;
      mix-blend-mode: multiply;
    }

    /* Star canvas sits above overlay but behind UI */
    #bgStars {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -2;
      pointer-events: none;
      display: block;
    }

    /* shimmer sweep (very low opacity) */
    .shimmer-layer {
      position: fixed;
      inset: 0;
      z-index: -1;
      pointer-events: none;
      background: linear-gradient(120deg,
        rgba(255,255,255,0.00) 0%,
        rgba(255,255,255,0.06) 45%,
        rgba(255,255,255,0.00) 60%);
      background-size: 300% 300%;
      opacity: 0.12;
      mix-blend-mode: screen;
      animation: shimmer-move 10s linear infinite;
      filter: blur(6px);
    }

    @keyframes shimmer-move {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* Header */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 2rem;
      background: rgba(10, 10, 35, 0.95);
      backdrop-filter: blur(15px);
      border-bottom: 1px solid #5a4fcf;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .logo {
      font-size: 2rem;
      font-weight: bold;
      color: #8a7cff;
      letter-spacing: 1.5px;
      text-shadow: 0 0 10px rgba(138, 124, 255, 0.5);
      background: linear-gradient(45deg, #8a7cff, #d66efd);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .header-buttons { display: flex; gap: 1rem; }

    .btn {
      padding: 0.7rem 1.4rem;
      border-radius: 8px;
      border: 1px solid rgba(138, 124, 255, 0.3);
      background: rgba(20, 20, 40, 0.5);
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      font-size: 0.95rem;
      color: #b1a6ff;
      backdrop-filter: blur(10px);
    }

    .btn:hover {
      background: rgba(30, 30, 60, 0.7);
      border: 1px solid rgba(138, 124, 255, 0.6);
      box-shadow: 0 0 15px rgba(138, 124, 255, 0.2);
    }

    /* Main Content */
    .container {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 0 1.5rem;
      flex: 1;
      position: relative;
      z-index: 2; /* above decorations */
    }

    /* PROFILE CARD: slight opacity reduction as requested */
    .profile-card {
      background: rgba(20, 20, 40, 0.65); /* reduced from 0.85 to 0.65 */
      border-radius: 20px;
      padding: 3rem;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.45);
      border: 1px solid rgba(90,79,207,0.9);
      backdrop-filter: blur(10px);
      margin-bottom: 2rem;
      width: 100%;
      position: relative;
    }

    .profile-header {
      display: flex;
      align-items: center;
      gap: 2rem;
      margin-bottom: 2.5rem;
      flex-wrap: wrap;
    }

    .profile-photo {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid #6a5af9;
      background: linear-gradient(45deg, #6a5af9, #d66efd);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 4rem;
      box-shadow: 0 0 20px rgba(106, 90, 249, 0.3);
    }

    .profile-info {
      flex: 1;
      min-width: 300px;
    }

    .profile-name {
      font-size: 2.5rem;
      font-weight: bold;
      color: #ffffff;
      margin-bottom: 0.5rem;
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.2);
    }

    .profile-slug {
      font-size: 1.3rem;
      color: #b1a6ff;
      margin-bottom: 0.8rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .verified-badge {
      display: inline-block;
      background: linear-gradient(45deg, #6a5af9, #d66efd);
      color: white;
      padding: 0.3rem 1rem;
      border-radius: 20px;
      font-size: 1rem;
      font-weight: bold;
      box-shadow: 0 0 10px rgba(106, 90, 249, 0.3);
    }

    .join-date, .email {
      color: #a0a0d0;
      font-size: 1.1rem;
      margin: 0.3rem 0;
    }

    .profile-actions {
      position: absolute;
      top: 2rem;
      right: 2rem;
    }

    .btn-share {
      padding: 0.7rem 1.4rem;
      border-radius: 8px;
      border: 1px solid rgba(138, 124, 255, 0.3);
      background: rgba(20, 20, 40, 0.5);
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      font-size: 0.95rem;
      color: #b1a6ff;
      backdrop-filter: blur(10px);
    }

    .btn-share:hover {
      background: rgba(30, 30, 60, 0.7);
      border: 1px solid rgba(138, 124, 255, 0.6);
      box-shadow: 0 0 15px rgba(138, 124, 255, 0.2);
    }

    .bio-section { margin: 2.5rem 0; }

    .section-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: #d0c4ff;
      margin-bottom: 1.5rem;
      padding-bottom: 0.8rem;
      border-bottom: 2px solid #5a4fcf;
      display: flex;
      align-items: center;
      gap: 0.8rem;
    }

    .bio-text {
      line-height: 1.7;
      color: #c0c0e0;
      font-size: 1.15rem;
    }

    .profile-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 2rem;
      margin-top: 2.5rem;
    }

    .stat-card {
      background: rgba(40, 40, 70, 0.6);
      padding: 2rem;
      border-radius: 15px;
      text-align: center;
      border: 1px solid #5a4fcf;
      transition: transform 0.3s ease;
    }

    .stat-card:hover { transform: translateY(-5px); }

    .stat-value {
      font-size: 2.5rem;
      font-weight: bold;
      color: #8a7cff;
      margin-bottom: 0.8rem;
      text-shadow: 0 0 10px rgba(138, 124, 255, 0.3);
    }

    .stat-label { color: #b1a6ff; font-size: 1.1rem; }

    /* Posts Section */
    .posts-section {
      background: rgba(20, 20, 40, 0.85);
      border-radius: 20px;
      padding: 3rem;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
      border: 1px solid #5a4fcf;
      backdrop-filter: blur(10px);
      margin-bottom: 2rem;
    }

    .posts-grid { display: grid; grid-template-columns: 1fr; gap: 2rem; margin-top: 2rem; }
    .post-card { background: rgba(30, 30, 50, 0.7); border-radius: 15px; padding: 1.8rem; border: 1px solid #5a4fcf; transition: transform .3s ease; }
    .post-card:hover { transform: translateY(-5px); border-color: #8a7cff; }
    .post-title { font-size: 1.4rem; font-weight: 600; color: #ffffff; margin-bottom: .8rem; }
    .post-body { color: #c0c0e0; line-height: 1.6; margin-bottom: 1.2rem; font-size: 1rem; }

    .post-meta { display:flex; justify-content:space-between; color:#a0a0d0; font-size:.9rem; border-top:1px solid #4a4a8a; padding-top:1rem; }
    .post-author { color:#8a7cff; }
    .post-time { color:#8a7cff; font-size:.85rem; font-style:italic; }

    .comments-section { margin-top: 2.5rem; }
    .comments-grid { display:grid; grid-template-columns:1fr; gap:1.5rem; margin-top:1.5rem; }
    .comment-card { background: rgba(40,40,60,0.6); border-radius:12px; padding:1.2rem; border:1px solid #4a4a8a; display:flex; flex-direction:column; }
    .comment-header { display:flex; justify-content:space-between; margin-bottom:.8rem; }
    .comment-author { font-weight:600; color:#8a7cff; }
    .comment-time { font-size:.8rem; color:#a0a0d0; font-style:italic; }
    .comment-body { color:#c0c0e0; font-size:.95rem; line-height:1.5; }

    .post-actions { display:flex; gap:1rem; margin-top:2rem; justify-content:center; }
    .btn-post { padding:0.9rem 2rem; border-radius:8px; border:1px solid rgba(138,124,255,0.3); background:rgba(20,20,40,0.5); cursor:pointer; font-weight:600; transition:all .3s ease; font-size:1rem; color:#b1a6ff; backdrop-filter: blur(10px); }
    .btn-post:hover { background: rgba(30,30,60,0.7); border: 1px solid rgba(138,124,255,0.6); box-shadow:0 0 15px rgba(138,124,255,0.2); }

    /* Footer */
    .footer {
      background: rgba(10, 10, 35, 0.95);
      padding: 3rem 2rem 2rem;
      margin-top: 3rem;
      border-top: 1px solid #5a4fcf;
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
      z-index: 2;
    }

    .footer-content { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: 1fr 1fr; gap: 3rem; }
    .footer-about-title { font-size: 1.1rem; color: #8a7cff; margin-bottom: 1rem; font-weight: 600; }
    .footer-about-text { color:#a0a0d0; line-height:1.6; font-size:.9rem; }

    .footer-links { display:flex; flex-direction:column; gap:.8rem; }
    .footer-links a { color:#a0a0d0; text-decoration:none; font-size:.95rem; transition:color .3s ease; }
    .footer-links a:hover { color:#8a7cff; text-decoration:underline; }

    .rocket-frame { margin-top:2rem; padding:1.5rem; border:2px solid #5a4fcf; border-radius:12px; background: rgba(20,20,40,0.5); position:relative; overflow:hidden; }
    .rocket-text { font-size:1.8rem; font-weight:bold; color:#8a7cff; text-align:center; text-shadow:0 0 15px rgba(138,124,255,0.6); background: linear-gradient(45deg,#8a7cff,#d66efd,#8a7cff); background-size:200% auto; -webkit-background-clip:text; -webkit-text-fill-color:transparent; animation: shimmer 3s linear infinite; font-family: 'Arial Rounded MT Bold','Segoe UI',sans-serif; }

    @keyframes shimmer { 0% { background-position: -200% center; } 100% { background-position: 200% center; } }

    /* Loading Overlay and small stars used during load */
    .loading-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: linear-gradient(135deg,#0f0c29,#302b63,#24243e); display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:9999; transition:opacity .5s ease; }
    .loading-overlay.hidden { opacity: 0; pointer-events: none; }
    .loading-message { font-size:1.8rem; color:#e0e0ff; margin-bottom:2rem; text-align:center; font-weight:600; text-shadow:0 0 10px rgba(138,124,255,0.5); }
    .stars-container { position: relative; width:300px; height:300px; }
    .star { position:absolute; background-color: white; border-radius:50%; animation: twinkle var(--duration) infinite ease-in-out; }
    @keyframes twinkle { 0%,100% { opacity: .2; } 50% { opacity: 1; } }

    /* Responsive */
    @media (max-width: 768px) {
      .header { flex-direction: column; gap: 1.2rem; padding: 1.2rem; }
      .profile-header { flex-direction: column; text-align: center; }
      .profile-actions { position: static; margin-top: 1.5rem; text-align: center; }
      .footer-content { grid-template-columns: 1fr; }
      .profile-card, .posts-section { padding: 2rem 1.5rem; }
      .profile-name { font-size: 2rem; }
      /* reduce star density on small screens for performance */
      .shimmer-layer { display: none; }
    }
  </style>
</head>
<body>
  <!-- Background layers -->
  <div class="bg-layer" style="background-image: url('https://dl.dropboxusercontent.com/scl/fi/1csa5jjslfhutldgd4in9/IMG_20251116_113654.png?rlkey=p2jqe4ngtw8z2id5rpqspw9sb&st=grvkp8p9&dl=0');"></div>
  <div class="bg-overlay" aria-hidden="true"></div>
  <canvas id="bgStars" aria-hidden="true"></canvas>
  <div class="shimmer-layer" aria-hidden="true"></div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-message">Building your profile, wait for a second...</div>
    <div class="stars-container" id="starsContainer"></div>
  </div>

  <!-- Header -->
  <header class="header">
    <div class="logo">GalaxyWeb</div>
    <div class="header-buttons">
      <button class="btn btn-settings">Settings</button>
      <button class="btn btn-logout">Log Out</button>
    </div>
  </header>

  <!-- Main Content -->
  <div class="container">
    <div id="profile-content">
      <div class="loading">Loading profile...</div>
    </div>
    <div id="posts-section"></div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-content">
      <div class="footer-left">
        <div class="footer-about-title">About TeamGalaxy</div>
        <div class="footer-about-text">
          TeamGalaxy is an innovative gaming and creative community, united by passion and the spirit of collaboration. We host tournaments, share design ideas, and grow talents together ‚Äî join now to explore the Galaxy!
        </div>
      </div>
      <div class="footer-right">
        <div class="footer-links">
          <a href="../legal/privacy_policy.html">Privacy Policy</a>
          <a href="../legal/terms_and_conditions.html">Terms & Conditions</a>
          <a href="../about_us.html">About</a>
        </div>
        <div class="rocket-frame">
          <div class="rocket-text">üöÄ ROCKET üöÄ</div>
        </div>
      </div>
    </div>
  </footer>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-auth.js";
    import { getFirestore, doc, getDoc, collection, query, where, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-firestore.js";

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyD0Yv_bQjxi2_kjzPR4XHOlaB7Sb6NRVUc",
      authDomain: "teamgalaxy-77344.firebaseapp.com",
      projectId: "teamgalaxy-77344",
      storageBucket: "teamgalaxy-77344.firebasestorage.app",
      messagingSenderId: "770256225320",
      appId: "1:770256225320:web:5a363ebd757de6cde3a11d",
      measurementId: "G-6C2W9NSNCH"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // DOM Elements
    const loadingOverlay = document.getElementById('loadingOverlay');
    const profileContent = document.getElementById('profile-content');
    const postsSection = document.getElementById('posts-section');
    const logoutBtn = document.querySelector('.btn-logout');
    const settingsBtn = document.querySelector('.btn-settings');

    // Create stars for loading overlay (unchanged)
    function createLoadingStars() {
      const container = document.getElementById('starsContainer');
      container.innerHTML = '';
      for (let i = 0; i < 30; i++) {
        const star = document.createElement('div');
        star.classList.add('star');

        // Random position
        const x = Math.random() * 100;
        const y = Math.random() * 100;
        star.style.left = `${x}%`;
        star.style.top = `${y}%`;

        // Random size
        const size = Math.random() * 3 + 1;
        star.style.width = `${size}px`;
        star.style.height = `${size}px`;

        // Random animation duration
        const duration = Math.random() * 3 + 2;
        star.style.setProperty('--duration', `${duration}s`);

        container.appendChild(star);
      }
    }

    // Format date, formatNumber, timeAgo functions (kept same)
    function formatDate(dateValue) {
      if (!dateValue) return '';
      if (dateValue && dateValue.seconds !== undefined) {
        const date = new Date(dateValue.seconds * 1000);
        return date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
      } else if (dateValue instanceof Date) {
        return dateValue.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
      } else {
        const date = new Date(dateValue);
        if (isNaN(date.getTime())) return 'Invalid Date';
        return date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
      }
    }
    function formatNumber(num) {
      if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
      if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
      return num.toString();
    }
    function timeAgo(dateValue) {
      if (!dateValue) return 'Just now';
      let date;
      if (dateValue && dateValue.seconds !== undefined) date = new Date(dateValue.seconds * 1000);
      else if (dateValue instanceof Date) date = dateValue;
      else { date = new Date(dateValue); if (isNaN(date.getTime())) return 'Invalid Date'; }
      const now = new Date();
      const seconds = Math.floor((now - date) / 1000);
      let interval = seconds / 31536000; if (interval > 1) return Math.floor(interval) + ' years ago';
      interval = seconds / 2592000; if (interval > 1) return Math.floor(interval) + ' months ago';
      interval = seconds / 86400; if (interval > 1) return Math.floor(interval) + ' days ago';
      interval = seconds / 3600; if (interval > 1) return Math.floor(interval) + ' hours ago';
      interval = seconds / 60; if (interval > 1) return Math.floor(interval) + ' minutes ago';
      return Math.floor(seconds) + ' seconds ago';
    }

    // Load profile data
    async function loadProfile() {
      const user = auth.currentUser;
      if (!user) {
        profileContent.innerHTML = '<div class="loading">Please log in to view your profile.</div>';
        return;
      }

      try {
        const docRef = doc(db, 'usersPrivate', user.uid);
        const docSnap = await getDoc(docRef);

        if (!docSnap.exists()) {
          profileContent.innerHTML = '<div class="loading">Profile not found.</div>';
          return;
        }

        const data = docSnap.data();
        renderProfile(data);
        await loadUserPosts(user.uid);
      } catch (error) {
        console.error('Error loading profile:', error);
        profileContent.innerHTML = '<div class="loading">Error loading profile.</div>';
      }
    }

    // Load user posts
    async function loadUserPosts(userId) {
      try {
        const q = query(collection(db, 'posts'), where('authorId', '==', userId), orderBy('createdAt', 'desc'), limit(3));
        const querySnapshot = await getDocs(q);
        const posts = [];
        querySnapshot.forEach(doc => posts.push({ id: doc.id, ...doc.data() }));
        renderPosts(posts);
      } catch (error) {
        console.error('Error loading posts:', error);
        postsSection.innerHTML = '<div class="loading">Error loading posts.</div>';
      }
    }

    // Render profile HTML
    function renderProfile(data) {
      profileContent.innerHTML = `
        <div class="profile-card">
          <div class="profile-actions">
            <button class="btn-share" id="shareBtn">Share Profile</button>
          </div>

          <div class="profile-header">
            <img src="${data.profilePhotoUrl || 'https://via.placeholder.com/150'}" alt="Profile Photo" class="profile-photo">
            <div class="profile-info">
              <h1 class="profile-name">${data.name || 'Unknown User'}</h1>
              <div class="profile-slug">${data.slug ? '@' + data.slug : ''}${data.verified ? '<span class="verified-badge">‚úì Verified</span>' : ''}</div>
              <div class="join-date">Joined: ${formatDate(data.joinDate)}</div>
              <div class="email">${data.email || ''}</div>
            </div>
          </div>

          <div class="bio-section">
            <h2 class="section-title">Bio</h2>
            <p class="bio-text">${data.bio || 'No bio available.'}</p>
          </div>

          <div class="profile-stats">
            <div class="stat-card">
              <div class="stat-value">${formatNumber(data.publicPostCount || 0)}</div>
              <div class="stat-label">Public Posts</div>
            </div>
          </div>
        </div>
      `;

      // Add share button functionality
      const shareBtn = document.getElementById('shareBtn');
      if (shareBtn) {
        shareBtn.addEventListener('click', () => {
          if(data.slug) {
            const shareUrl = `https://teamgalaxyinteractive-cmd.github.io/teamgalaxy/public_data_manager/public_user_profile.html?=${data.slug}`;
            navigator.clipboard.writeText(shareUrl).then(() => alert('Profile URL copied to clipboard!'))
              .catch(err => { console.error('Failed to copy: ', err); alert('Failed to copy URL.'); });
          } else {
            alert('No profile slug available for sharing.');
          }
        });
      }
    }

    // Render posts HTML
    async function renderPosts(posts) {
      if (posts.length === 0) {
        postsSection.innerHTML = '<div class="loading">No posts found.</div>';
        return;
      }

      let postsHTML = `<div class="posts-section"><h2 class="section-title">Recent Posts</h2><div class="posts-grid">`;
      for (const post of posts) {
        const commentsQuery = query(collection(db, 'posts', post.id, 'comments'), orderBy('createdAt', 'desc'), limit(3));
        const commentsSnapshot = await getDocs(commentsQuery);
        const comments = []; commentsSnapshot.forEach(doc => comments.push({ id: doc.id, ...doc.data() }));

        postsHTML += `
          <div class="post-card">
            <h3 class="post-title">${post.title || 'Untitled Post'}</h3>
            <p class="post-body">${post.body || 'No content available.'}</p>
            <div class="post-meta">
              <span class="post-author">By ${post.authorName || 'Anonymous'}</span>
              <span class="post-time">${timeAgo(post.createdAt)}</span>
            </div>
            <div class="post-meta">
              <span>üëç ${formatNumber(post.upvotesCount || 0)}</span>
              <span>üëé ${formatNumber(post.downvotesCount || 0)}</span>
              <span>üí¨ ${formatNumber(post.commentsCount || 0)}</span>
            </div>
            ${comments.length > 0 ? `
              <div class="comments-section">
                <h4>Recent Comments</h4>
                <div class="comments-grid">
                  ${comments.map(comment => `
                    <div class="comment-card">
                      <div class="comment-header">
                        <span class="comment-author">${comment.authorName || 'Anonymous'}</span>
                        <span class="comment-time">${timeAgo(comment.createdAt)}</span>
                      </div>
                      <p class="comment-body">${comment.body || ''}</p>
                    </div>
                  `).join('')}
                </div>
              </div>` : ''}
          </div>`;
      }
      postsHTML += `</div><div class="post-actions"><button class="btn-post" id="explore-btn">Explore</button><button class="btn-post" id="show-all-btn">Show All Posts</button></div></div>`;
      postsSection.innerHTML = postsHTML;
      document.getElementById('explore-btn').addEventListener('click', () => { window.location.href = '../posts.html'; });
      document.getElementById('show-all-btn').addEventListener('click', () => { window.location.href = 'user_posts.html'; });
    }

    // Auth state listener
    onAuthStateChanged(auth, (user) => {
      if (user) loadProfile();
      else { profileContent.innerHTML = '<div class="loading">Please log in to view your profile.</div>'; postsSection.innerHTML = ''; }
    });

    // Logout functionality
    logoutBtn.addEventListener('click', () => {
      signOut(auth).then(() => { window.location.href = 'index.html'; }).catch((error) => { console.error('Sign out error:', error); alert('Error signing out.'); });
    });

    // Settings
    settingsBtn.addEventListener('click', () => { window.location.href = 'settings.html'; });

    // Initialize small loading stars, hide overlay, and start bg animation
    window.addEventListener('load', () => {
      createLoadingStars();
      setTimeout(() => loadingOverlay.classList.add('hidden'), 3000);
      initBgStars();
    });

    /* -----------------------------
       Background star animation (realistic, multi-layer + twinkle + shooting stars)
       ----------------------------- */
    function initBgStars() {
      const canvas = document.getElementById('bgStars');
      const ctx = canvas.getContext('2d');
      let w = canvas.width = window.innerWidth;
      let h = canvas.height = window.innerHeight;
      // Three depth layers: far, mid, near
      const LAYERS = [
        { depth: 0.25, countFactor: 1.0, radiusRange: [0.25, 0.8], speed: 0.02 }, // far (many small)
        { depth: 0.6, countFactor: 0.6, radiusRange: [0.6, 1.6], speed: 0.06 },  // mid
        { depth: 1.2, countFactor: 0.25, radiusRange: [1.4, 3.5], speed: 0.12 }   // near (fewer larger)
      ];
      let stars = [];
      let shootingStars = [];
      const BASE_DENSITY = 0.00018; // tweak: stars per px^2
      let mouseX = w/2, mouseY = h/2;

      function createStars() {
        stars = [];
        for (let li = 0; li < LAYERS.length; li++) {
          const layer = LAYERS[li];
          const count = Math.round(w * h * BASE_DENSITY * layer.countFactor);
          for (let i = 0; i < count; i++) {
            const r = randRange(layer.radiusRange[0], layer.radiusRange[1]);
            stars.push({
              x: Math.random() * w,
              y: Math.random() * h,
              baseX: 0,
              baseY: 0,
              r,
              layer: li,
              depth: layer.depth,
              twinklePhase: Math.random() * Math.PI * 2,
              twinkleSpeed: (Math.random() * 0.02 + 0.005) * (1 / layer.depth),
              alphaBase: Math.random() * 0.7 + 0.2,
              color: randomStarColor()
            });
          }
        }
        stars.forEach(s => { s.baseX = s.x; s.baseY = s.y; });
      }

      function onResize() {
        w = canvas.width = window.innerWidth;
        h = canvas.height = window.innerHeight;
        createStars();
      }
      window.addEventListener('resize', throttle(onResize, 150));

      // mouse parallax
      window.addEventListener('mousemove', (e) => { mouseX = e.clientX; mouseY = e.clientY; });

      // occasional shooting stars
      function maybeSpawnShooting() {
        if (Math.random() < 0.02) { // spawn chance per interval
          spawnShootingStar();
        }
        setTimeout(maybeSpawnShooting, randRange(1200, 5000)); // random intervals
      }
      maybeSpawnShooting();

      function spawnShootingStar() {
        const startX = Math.random() < 0.6 ? -50 : w + 50; // left or right
        const startY = Math.random() * h * 0.6;
        const velX = (startX < 0) ? randRange(600, 1200) : randRange(-1200, -600); // px/s
        const velY = randRange(60, 220) * (Math.random() < 0.5 ? 1 : -1);
        const len = randRange(220, 520);
        shootingStars.push({
          x: startX,
          y: startY,
          vx: velX / 1000,
          vy: velY / 1000,
          life: 0,
          len,
          maxLife: randRange(600, 1200),
          opacity: 0.95
        });
      }

      // helpers
      function randRange(min, max) { return Math.random() * (max - min) + min; }
      function randomStarColor() {
        // slight blue-white-yellow variance
        const t = Math.random();
        if (t < 0.12) return 'rgba(255,235,200,'; // warm
        if (t < 0.6) return 'rgba(255,255,255,'; // white
        return 'rgba(200,220,255,'; // cool
      }

      let last = performance.now();
      function frame(now) {
        const dt = now - last;
        last = now;
        ctx.clearRect(0, 0, w, h);

        // faint vignette to blend with bg image
        const vign = ctx.createRadialGradient(w/2, h/2, Math.max(w,h)/8, w/2, h/2, Math.max(w,h)/1.1);
        vign.addColorStop(0, 'rgba(255,255,255,0.00)');
        vign.addColorStop(1, 'rgba(0,0,0,0.16)');
        ctx.fillStyle = vign;
        ctx.fillRect(0,0,w,h);

        // draw stars by layer (back-to-front)
        for (let li = 0; li < LAYERS.length; li++) {
          for (let i = 0; i < stars.length; i++) {
            const s = stars[i];
            if (s.layer !== li) continue;

            // twinkle
            s.twinklePhase += s.twinkleSpeed * (dt/16.67);
            const tw = (Math.sin(s.twinklePhase) + 1) / 2; // 0..1
            const alpha = s.alphaBase * (0.45 + 0.55 * tw);

            // parallax offset influenced by depth
            const px = (mouseX - w/2) * (0.0005 * s.r) * (1 / s.depth);
            const py = (mouseY - h/2) * (0.0005 * s.r) * (1 / s.depth);
            const drawX = s.baseX + px + Math.sin((i + now*0.00002) * (0.0002 * s.depth)) * 0.4;
            const drawY = s.baseY + py + Math.cos((i + now*0.00003) * (0.0003 * s.depth)) * 0.4;

            // glow for larger stars
            if (s.r > 1.2) {
              const g = ctx.createRadialGradient(drawX, drawY, 0, drawX, drawY, s.r * 6);
              g.addColorStop(0, s.color + alpha + ')');
              g.addColorStop(1, s.color + '0)');
              ctx.fillStyle = g;
              ctx.fillRect(drawX - s.r*6, drawY - s.r*6, s.r*12, s.r*12);
            }

            // core
            ctx.beginPath();
            ctx.globalAlpha = alpha;
            ctx.fillStyle = s.color + Math.min(1, alpha) + ')';
            ctx.arc(drawX, drawY, s.r, 0, Math.PI * 2);
            ctx.fill();
            ctx.globalAlpha = 1;
          }
        }

        // animate shooting stars
        for (let i = shootingStars.length - 1; i >= 0; i--) {
          const sh = shootingStars[i];
          // move
          sh.x += sh.vx * dt;
          sh.y += sh.vy * dt;
          sh.life += dt;

          // draw trail
          ctx.save();
          ctx.globalCompositeOperation = 'lighter';
          const trailLen = sh.len;
          const grad = ctx.createLinearGradient(sh.x, sh.y, sh.x - sh.vx*10, sh.y - sh.vy*10);
          grad.addColorStop(0, `rgba(255,255,255,${sh.opacity})`);
          grad.addColorStop(1, `rgba(255,255,255,0)`);
          ctx.strokeStyle = grad;
          ctx.lineWidth = 2.5;
          ctx.beginPath();
          ctx.moveTo(sh.x, sh.y);
          ctx.lineTo(sh.x - sh.vx*trailLen, sh.y - sh.vy*trailLen);
          ctx.stroke();

          // head
          ctx.fillStyle = `rgba(255,255,255,${sh.opacity})`;
          ctx.beginPath();
          ctx.arc(sh.x, sh.y, 2.2, 0, Math.PI*2);
          ctx.fill();
          ctx.restore();

          // remove after life or if offscreen
          if (sh.life > sh.maxLife || sh.x < -600 || sh.x > w + 600 || sh.y < -600 || sh.y > h + 600) {
            shootingStars.splice(i, 1);
          }
        }

        requestAnimationFrame(frame);
      }

      // initial setup
      createStars();
      let raf = requestAnimationFrame(frame);

      // spawn shooting stars recursively
      // helper throttle
      function throttle(fn, wait) {
        let time = Date.now();
        return function() {
          if ((time + wait - Date.now()) < 0) {
            fn();
            time = Date.now();
          }
        }
      }

      // spawn first shooting star now with delay
      setTimeout(spawnShootingStar, randRange(900, 3000));

      // Burn CPU more? user said it's ok ‚Äî but still keep tuned. You can increase BASE_DENSITY if you want more stars.

      return {
        stop() { cancelAnimationFrame(raf); window.removeEventListener('resize', onResize); }
      };
    }

    // utility throttle defined earlier used inside initBgStars but keep here for reuse
    function throttle(fn, wait) {
      let time = Date.now();
      return function() {
        if ((time + wait - Date.now()) < 0) {
          fn();
          time = Date.now();
        }
      }
    }

  </script>
</body>
</html>