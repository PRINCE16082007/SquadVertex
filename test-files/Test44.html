<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TeamGalaxy â€” My Posts</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css ">
  <style>
    /* Base styling */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', system-ui, -apple-system, Roboto, sans-serif;
      background: #0a0e17;
      color: #ffffff;
      padding: 20px;
      line-height: 1.6;
      position: relative;
      overflow-x: hidden;
    }

    /* Stars background */
    body::before {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        radial-gradient(2px 2px at 10% 20%, #fff, transparent),
        radial-gradient(1px 1px at 30% 40%, #64c2ff, transparent),
        radial-gradient(1.5px 1.5px at 50% 60%, #fab84f, transparent),
        radial-gradient(1px 1px at 70% 80%, #fff, transparent),
        radial-gradient(2px 2px at 90% 10%, #64c2ff, transparent),
        radial-gradient(1px 1px at 20% 80%, #fab84f, transparent),
        radial-gradient(1.5px 1.5px at 80% 30%, #fff, transparent),
        radial-gradient(1px 1px at 60% 70%, #64c2ff, transparent),
        radial-gradient(2px 2px at 40% 10%, #fab84f, transparent),
        radial-gradient(1px 1px at 95% 50%, #fff, transparent);
      background-repeat: repeat;
      background-size: 100% 100%;
      z-index: -1;
      animation: sparkle 20s linear infinite;
    }

    @keyframes sparkle {
      0% { transform: translateY(0); }
      100% { transform: translateY(-100vh); }
    }

    .card {
      width: 100%;
      max-width: 800px;
      background: linear-gradient(145deg, rgba(24, 31, 43, 0.95) 0%, rgba(32, 40, 57, 0.95) 100%);
      border-radius: 16px;
      padding: 32px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(255, 255, 255, 0.1);
      position: relative;
      z-index: 10;
      margin-bottom: 24px;
    }

    /* Header styling */
    .app-header {
      display: flex;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .logo {
      font-size: 24px;
      font-weight: 800;
      background: linear-gradient(90deg, #ffffff 0%, #64c2ff 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .beta-badge {
      background: #fab84f;
      color: #000;
      font-size: 12px;
      padding: 2px 8px;
      border-radius: 12px;
      font-weight: 600;
      margin-left: 8px;
    }

    /* User bar */
    .user-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      background: rgba(24, 31, 43, 0.95);
      padding: 16px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .user-info h2 {
      font-size: 18px;
      margin-bottom: 4px;
      color: #ffffff;
    }

    .user-info p {
      color: #d0d0d0;
      font-size: 14px;
    }

    .auth-btn {
      background: #64c2ff;
      color: #000;
      border: none;
      padding: 10px 16px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: background 0.2s;
    }

    .auth-btn:hover {
      background: #fab84f;
    }

    /* Post styling */
    .meta {
      display: flex;
      align-items: center;
      margin-bottom: 16px;
      font-size: 14px;
    }

    .avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
      margin-right: 12px;
      border: 2px solid rgba(255, 255, 255, 0.1);
    }

    .avatar.small {
      width: 32px;
      height: 32px;
    }

    .muted {
      color: #d0d0d0;
    }

    .title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 12px;
      color: #ffffff;
    }

    .snippet {
      margin-bottom: 16px;
      color: #d0d0d0;
    }

    .tags {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 16px;
    }

    .tag {
      background: rgba(250, 184, 79, 0.2);
      color: #fab84f;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 500;
      border: 1px solid rgba(250, 184, 79, 0.3);
    }

    .actions {
      display: flex;
      align-items: center;
      gap: 12px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      padding-top: 16px;
    }

    .vote {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .link-like {
      background: none;
      border: none;
      color: #d0d0d0;
      cursor: pointer;
      font-size: 18px;
      padding: 4px;
      border-radius: 4px;
    }

    .link-like:hover {
      background: rgba(255, 255, 255, 0.1);
      color: #ffffff;
    }

    .count {
      font-weight: 600;
      min-width: 24px;
      text-align: center;
    }

    .btn-ghost {
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: #d0d0d0;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
    }

    .btn-ghost:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .btn-primary {
      background: linear-gradient(90deg, #fab84f, #64c2ff);
      color: #000;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s ease;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(250, 184, 79, 0.25);
    }

    .comment {
      background: rgba(24, 31, 43, 0.5);
      padding: 16px;
      border-radius: 10px;
      margin-bottom: 16px;
      border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .no-posts {
      text-align: center;
      color: #d0d0d0;
      padding: 32px;
      font-style: italic;
    }

    /* Buttons */
    .button-group {
      display: flex;
      gap: 12px;
      margin-top: 24px;
    }

    button {
      padding: 14px 20px;
      border-radius: 10px;
      border: 0;
      cursor: pointer;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s ease;
      font-size: 15px;
    }

    .btn-primary {
      background: linear-gradient(90deg, #fab84f, #64c2ff);
      color: #000;
      box-shadow: 0 4px 12px rgba(250, 184, 79, 0.25);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(250, 184, 79, 0.35);
    }

    .btn-secondary {
      background: rgba(24, 31, 43, 0.95);
      color: #d0d0d0;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .btn-secondary:hover {
      background: rgba(32, 40, 57, 0.95);
    }

    /* Status messages */
    .status-message {
      padding: 12px 16px;
      border-radius: 10px;
      margin-top: 20px;
      font-size: 14px;
      display: none;
    }

    .status-success {
      background: rgba(27, 58, 45, 0.9);
      color: #86efac;
      border: 1px solid #34d399;
    }

    .status-error {
      background: rgba(69, 26, 26, 0.9);
      color: #fca5a5;
      border: 1px solid #f87171;
    }

    /* Footer */
    .app-footer {
      margin-top: 24px;
      text-align: center;
      color: #d0d0d0;
      font-size: 14px;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .user-bar {
        flex-direction: column;
        text-align: center;
        gap: 16px;
      }

      .actions {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
    }
  </style>
</head>
<body>
  <div class="card">
    <div class="app-header">
      <div class="logo">
        <i class="fas fa-rocket"></i>
        <span>TeamGalaxy</span>
        <span class="beta-badge">BETA</span>
      </div>
    </div>

    <div class="user-bar">
      <div class="user-info">
        <h2>My Posts</h2>
        <p id="userHint">Sign in to view your posts</p>
      </div>
      <div id="authControls">
        <button class="auth-btn" id="signInBtn">
          <i class="fab fa-google"></i>
          Sign in with Google
        </button>
      </div>
    </div>

    <div id="contentArea">
      <div id="postsList" style="display: none;">
        <h3>Your Posts</h3>
        <div id="postsContainer"></div>
        <div class="center">
          <button id="loadMoreBtn" class="btn-ghost" style="display: none;">Load more</button>
        </div>
      </div>

      <div id="postDetailView" style="display: none;">
        <div style="margin-bottom:1rem;"><button id="backToPosts" class="link-like"><i class="fas fa-arrow-left"></i> Back to posts</button></div>
        <div id="postDetailContainer"></div>

        <div class="card" style="margin-top:1rem">
          <h3 style="margin:0 0 0.5rem 0">Comments</h3>
          <div id="commentsList" style="max-height:420px;overflow:auto;margin-bottom:0.5rem"></div>

          <div id="commentFormWrap">
            <div class="small muted">Add a comment</div>
            <textarea id="commentInput" placeholder="Say something..." style="width: 100%; padding: 14px 16px; border-radius: 10px; border: 1px solid rgba(255, 255, 255, 0.1); background: rgba(24, 31, 43, 0.95); color: #ffffff; font-family: inherit; font-size: 15px; margin-bottom: 12px; resize: vertical; min-height: 80px;"></textarea>
            <div style="display:flex;gap:0.5rem">
              <button id="submitComment" class="btn-primary">Post comment</button>
              <button id="clearComment" class="btn-secondary">Clear</button>
              <div id="commentStatus" class="small muted" style="margin-left:auto"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="app-footer">
      <p>Â© 2023 TeamGalaxy â€” Share your knowledge with the community</p>
    </div>
  </div>

  <script type="module">
    // ---------- ðŸ”§ Your Firebase config & recaptcha ----------
    const firebaseConfig = {
      apiKey: "AIzaSyD0Yv_bQjxi2_kjzPR4XHOlaB7Sb6NRVUc",
      authDomain: "teamgalaxy-77344.firebaseapp.com",
      projectId: "teamgalaxy-77344",
      storageBucket: "teamgalaxy-77344.firebasestorage.app",
      messagingSenderId: "770256225320",
      appId: "1:770256225320:web:5a363ebd757de6cde3a11d",
      measurementId: "G-6C2W9NSNCH"
    };
    const RECAPTCHA_SITE_KEY = "6Ld395IrAAAAAIvG4gyf0vUJeI_jKOsI9XVn0jUx";

    // ---------- imports (Firebase v11.9.0) ----------
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.9.0/firebase-app.js ';
    import { initializeAppCheck, ReCaptchaV3Provider } from 'https://www.gstatic.com/firebasejs/11.9.0/firebase-app-check.js ';
    import { getFirestore, collection, query, where, orderBy, limit, startAfter, getDocs, doc, getDoc, addDoc, updateDoc, serverTimestamp, runTransaction, increment } from 'https://www.gstatic.com/firebasejs/11.9.0/firebase-firestore.js ';
    import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/11.9.0/firebase-auth.js ';

    // ---------- init ----------
    const app = initializeApp(firebaseConfig);

    try {
      initializeAppCheck(app, {
        provider: new ReCaptchaV3Provider(RECAPTCHA_SITE_KEY),
        isTokenAutoRefreshEnabled: true
      });
      console.log('App Check initialized.');
    } catch (err) {
      console.warn('App Check init problem:', err);
    }

    const db = getFirestore(app);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    // ---------- UI elements ----------
    const signInBtn = document.getElementById('signInBtn');
    const authControls = document.getElementById('authControls');
    const userHint = document.getElementById('userHint');
    const contentArea = document.getElementById('contentArea');
    const postsList = document.getElementById('postsList');
    const postsContainer = document.getElementById('postsContainer');
    const loadMoreBtn = document.getElementById('loadMoreBtn');
    const postDetailView = document.getElementById('postDetailView');
    const postDetailContainer = document.getElementById('postDetailContainer');
    const backToPosts = document.getElementById('backToPosts');
    const commentsList = document.getElementById('commentsList');
    const commentInput = document.getElementById('commentInput');
    const submitComment = document.getElementById('submitComment');
    const clearComment = document.getElementById('clearComment');
    const commentStatus = document.getElementById('commentStatus');

    // ---------- page state ----------
    let currentUser = null;
    let currentUserProfile = null;
    let currentPostId = null;
    let lastVisible = null;
    const PAGE_SIZE = 10;
    let commentsUnsub = null;

    // ---------- small helpers ----------
    function timeAgo(ts) {
      if (!ts) return '';
      const d = ts.toDate ? ts.toDate() : new Date(ts);
      const diff = Math.floor((Date.now() - d.getTime())/1000);
      if (diff < 60) return diff + 's';
      if (diff < 3600) return Math.floor(diff/60) + 'm';
      if (diff < 86400) return Math.floor(diff/3600) + 'h';
      return Math.floor(diff/86400) + 'd';
    }
    function snippet(text, n=220){ return text.length>n ? text.slice(0,n)+'â€¦' : text; }

    function escapeHTML(s){
      return String(s)
        .replaceAll('&','&amp;')
        .replaceAll('<','<')
        .replaceAll('>','>')
        .replaceAll('"','&quot;')
        .replaceAll("'",'&#039;');
    }

    // ---------- auth flow ----------
    signInBtn.addEventListener('click', async () => {
      try {
        await signInWithPopup(auth, provider);
        // onAuthStateChanged handles UI update
      } catch (err) {
        console.error('Sign-in failed', err);
        alert('Sign-in failed');
      }
    });

    // handle sign out click (we'll render it dynamically)
    function renderSignedIn(user, profile) {
      authControls.innerHTML = `
        <div style="text-align: right">
          <div style="display: flex; align-items: center; gap: 12px">
            <img src="${user.photoURL || 'https://via.placeholder.com/40x40/1a1a25/ffffff?text=' + (profile?.name || user.email || 'U')[0]}" 
                 alt="Profile" 
                 style="width: 40px; height: 40px; border-radius: 50%; border: 2px solid #64c2ff;">
            <div style="text-align: right">
              <div style="font-weight: 700; color: #64c2ff">${profile?.name || user.email || 'User'}</div>
              <div style="font-size: 13px; color: #d0d0d0">${profile?.email || user.email}</div>
            </div>
            <button class="auth-btn" id="signOutBtn" style="padding: 8px 12px">
              <i class="fas fa-sign-out-alt"></i>
              Sign out
            </button>
          </div>
        </div>
      `;
      document.getElementById('signOutBtn').addEventListener('click', () => signOut(auth));
      userHint.textContent = 'Signed in. Viewing your posts.';
    }

    function renderSignedOut() {
      authControls.innerHTML = `
        <button class="auth-btn" id="signInBtn">
          <i class="fab fa-google"></i>
          Sign in with Google
        </button>
      `;
      document.getElementById('signInBtn').addEventListener('click', async () => {
        try { await signInWithPopup(auth, provider); } catch (err) { console.error(err); alert('Sign-in failed'); }
      });
      userHint.textContent = 'Sign in to view your posts.';
    }

    // onAuth state: fetch your users/{uid} doc and use it
    onAuthStateChanged(auth, async (user) => {
      currentUser = user;
      if (user) {
        // fetch your users collection doc
        const userDocRef = doc(db, 'users', user.uid);
        let profile = null;
        try {
          const snap = await getDoc(userDocRef);
          if (snap.exists()) {
            profile = snap.data();
          } else {
            // fallback: use auth profile if users doc doesn't exist.
            profile = { name: user.displayName || null, email: user.email || null };
          }
        } catch (err) {
          console.warn('Failed reading users/{uid} doc', err);
          profile = { name: user.displayName || null, email: user.email || null };
        }
        currentUserProfile = profile;
        renderSignedIn(user, profile);
        // Show posts list after sign in
        postsList.style.display = 'block';
        postDetailView.style.display = 'none';
        lastVisible = null;
        await loadUserPosts(true);
      } else {
        renderSignedOut();
        postsList.style.display = 'none';
        postDetailView.style.display = 'none';
        currentUserProfile = null;
      }
    });

    // ---------- fetch user posts ----------
    async function loadUserPosts(reset = false) {
      if (!currentUser) return;

      if (reset) {
        lastVisible = null;
        postsContainer.innerHTML = '';
      }

      const postsRef = collection(db, 'posts');
      let q = query(postsRef, where('authorId', '==', currentUser.uid), orderBy('createdAt', 'desc'), limit(PAGE_SIZE));
      if (lastVisible) {
        q = query(postsRef, where('authorId', '==', currentUser.uid), orderBy('createdAt', 'desc'), startAfter(lastVisible), limit(PAGE_SIZE));
      }

      try {
        const snaps = await getDocs(q);
        if (snaps.docs.length === 0 && !lastVisible) {
          postsContainer.innerHTML = '<div class="no-posts">You have no posts yet.</div>';
          loadMoreBtn.style.display = 'none';
          return;
        }

        for (const docSnap of snaps.docs) {
          const data = docSnap.data();
          const postEl = document.createElement('div');
          postEl.className = 'card';
          const author = data.authorName || data.authorEmail || 'Unknown';
          const created = data.createdAt ? timeAgo(data.createdAt) : '';

          const avatarSrc = data.photoUrl || 'https://www.gstatic.com/images/branding/product/2x/avatar_square_64dp.png';

          postEl.innerHTML = `
            <div class="meta">
              <img class="avatar small" src="${escapeHTML(avatarSrc)}" alt="${escapeHTML(author)}">
              <span style="margin-left:8px">${escapeHTML(author)} Â· <span class="muted">${created}</span></span>
            </div>
            <div class="title">${escapeHTML(data.title || 'Untitled')}</div>
            <div class="snippet">${escapeHTML(snippet(data.body || ''))}</div>
            <div class="tags">${(data.tags || []).map(t => `<span class="tag">${escapeHTML(t)}</span>`).join('')}</div>
            <div class="actions">
              <div class="vote">
                <span class="muted">â–² ${data.upvotesCount||0} â–¼ ${data.downvotesCount||0}</span>
              </div>
              <div style="margin-left:auto">
                <button class="btn-ghost commentBtn" data-id="${docSnap.id}"><i class="far fa-comment"></i> Comments (${data.commentsCount||0})</button>
                <button class="btn-primary viewBtn" data-id="${docSnap.id}">View Post</button>
              </div>
            </div>
          `;
          postsContainer.appendChild(postEl);

          postEl.querySelector('.viewBtn').addEventListener('click', () => showPostDetail(docSnap.id));
          postEl.querySelector('.commentBtn').addEventListener('click', () => showPostDetail(docSnap.id));
        }
        lastVisible = snaps.docs[snaps.docs.length - 1];

        // show load more only if returned PAGE_SIZE items
        loadMoreBtn.style.display = snaps.docs.length === PAGE_SIZE ? 'inline-block' : 'none';
      } catch(e) {
        console.error('Error fetching user posts:', e);
        postsContainer.innerHTML = '<div class="card small muted">Failed to load posts</div>';
      }
    }

    loadMoreBtn.addEventListener('click', () => loadUserPosts(false));

    // ---------- show post detail ----------
    async function showPostDetail(postId) {
      currentPostId = postId;
      postDetailView.style.display = 'block';
      postsList.style.display = 'none';

      try {
        const postRef = doc(db, 'posts', postId);
        const pSnap = await getDoc(postRef);
        if (!pSnap.exists()) {
          postDetailContainer.innerHTML = '<div class="card small muted">Post not found</div>';
          return;
        }

        const data = pSnap.data();
        const author = data.authorName || data.authorEmail || 'Unknown';
        const created = data.createdAt ? timeAgo(data.createdAt) : '';

        const avatarSrc = data.photoUrl || 'https://www.gstatic.com/images/branding/product/2x/avatar_square_64dp.png';

        postDetailContainer.innerHTML = `
          <div class="card">
            <div class="meta">
              <img class="avatar small" src="${escapeHTML(avatarSrc)}" alt="${escapeHTML(author)}">
              ${escapeHTML(author)} Â· <span class="muted">${created}</span>
            </div>
            <div class="title">${escapeHTML(data.title || 'Untitled')}</div>
            <div style="margin-top:0.75rem; line-height: 1.8;">${escapeHTML(data.body || '').replace(/\n/g, '<br>')}</div>
            <div class="tags">${(data.tags||[]).map(t=>`<span class="tag">${escapeHTML(t)}</span>`).join('')}</div>

            <div style="margin-top:1rem" class="actions">
              <div class="vote">
                <span class="muted">â–² ${data.upvotesCount||0} â–¼ ${data.downvotesCount||0}</span>
              </div>
            </div>
          </div>
        `;

        // Load comments for this post
        if (commentsUnsub) commentsUnsub();
        const commentsRef = collection(db, 'posts', postId, 'comments');
        const commentsQuery = query(commentsRef, orderBy('createdAt','asc'));
        commentsUnsub = onSnapshot(commentsQuery, (snap) => {
          commentsList.innerHTML = '';
          if (snap.empty) {
            commentsList.innerHTML = '<div class="small muted" style="padding: 1rem; text-align: center;">No comments yet</div>';
            return;
          }

          snap.forEach(docSnap => {
            const c = docSnap.data();
            const authorC = c.authorName || 'Anonymous';
            const cAvatar = (c.photoUrl || 'https://www.gstatic.com/images/branding/product/2x/avatar_square_64dp.png');
            const cEl = document.createElement('div');
            cEl.className = 'comment';
            cEl.innerHTML = `
              <div class="meta">
                <img class="avatar small" src="${escapeHTML(cAvatar)}" alt="${escapeHTML(authorC)}">
                ${escapeHTML(authorC)} Â· <span class="muted">${c.createdAt ? timeAgo(c.createdAt) : ''}</span>
              </div>
              <div style="margin-top:0.5rem">${escapeHTML(c.body||'').replace(/\n/g, '<br>')}</div>`;
            commentsList.appendChild(cEl);
          });
        }, (error) => {
          console.error('Comments subscription error:', error);
          commentsList.innerHTML = '<div class="small muted" style="padding: 1rem;">Failed to load comments</div>';
        });

      } catch(e) {
        console.error('render post error', e);
        postDetailContainer.innerHTML = '<div class="card small muted">Failed to load post</div>';
      }
    }

    backToPosts.addEventListener('click', () => {
      postDetailView.style.display = 'none';
      postsList.style.display = 'block';
      if (commentsUnsub) commentsUnsub();
      currentPostId = null;
    });

    // ---------- comments: add ----------
    clearComment.addEventListener('click', () => commentInput.value = '');

    submitComment.addEventListener('click', async () => {
      if (!currentUser) { alert('Sign in to comment'); return; }
      if (!currentPostId) { alert('No post selected'); return; }
      const text = (commentInput.value || '').trim();
      if (!text) { commentStatus.textContent = 'Type your comment'; return; }

      commentStatus.textContent = 'Posting...';
      submitComment.disabled = true;

      try {
        const commentsRef = collection(db, 'posts', currentPostId, 'comments');
        await addDoc(commentsRef, {
          body: text,
          authorId: currentUser.uid,
          authorName: currentUserProfile?.name || currentUser.email || null,
          photoUrl: currentUserProfile?.photoURL || currentUser.photoURL || null, // Add photoUrl to comment
          createdAt: serverTimestamp(),
          upvotesCount: 0
        });
        // increment commentsCount on post
        await updateDoc(doc(db,'posts',currentPostId), { commentsCount: increment(1) });
        commentInput.value = '';
        commentStatus.textContent = 'Posted';
      } catch(e) {
        console.error('post comment failed', e);
        commentStatus.textContent = 'Failed';
      } finally {
        submitComment.disabled = false;
        setTimeout(()=>commentStatus.textContent='',1200);
      }
    });

  </script>
</body>
</html>