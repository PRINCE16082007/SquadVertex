<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Decoder Fixed</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>

</head>
<body style="background:#000;color:white">

<h2>Secure Decoder</h2>

<input type="file" id="upload"><br><br>

Password:
<input id="password" value="1234"><br><br>

<button onclick="decode()">Decode</button>

<pre id="result"></pre>

<script>

let img = new Image();

upload.onchange=e=>{
  img.src=URL.createObjectURL(e.target.files[0]);
};

function decode(){

  const canvas=document.createElement("canvas");
  const ctx=canvas.getContext("2d");

  canvas.width=img.width;
  canvas.height=img.height;

  ctx.drawImage(img,0,0);

  let data=ctx.getImageData(0,0,canvas.width,canvas.height);
  let px=data.data;

  let bits="";
  for(let i=0;i<800000;i++){
    bits += (px[i] & 1);
  }

  let text="";
  for(let i=0;i<bits.length;i+=8){
    text += String.fromCharCode(parseInt(bits.substr(i,8),2));
    if(text.includes("|END")) break;
  }

  text=text.replace("|END","");

  const MARKER="GALAXY_SECURE::";

  // ---------- NO DATA FOUND ----------
  if(!text.startsWith(MARKER)){
    result.textContent="âŒ No hidden data found in this image.";
    return;
  }

  let encrypted = text.replace(MARKER,"");

  let pass=document.getElementById("password").value;

  let decrypted;

  try{
    decrypted = CryptoJS.AES.decrypt(encrypted,pass).toString(CryptoJS.enc.Utf8);
  }catch(e){
    decrypted="";
  }

  // ---------- WRONG PASSWORD ----------
  if(!decrypted){
    result.textContent="ðŸ” Data found but password is wrong.";
    return;
  }

  // ---------- SUCCESS ----------
  result.textContent="âœ… Hidden message:\n\n"+decrypted;

}

</script>

</body>
</html>