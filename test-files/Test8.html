<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Seat Manager Pro</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --text-color: #2c3e50;
            --bg-color: #ecf0f1;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            margin: 0;
            padding: 20px;
            background: var(--bg-color);
            color: var(--text-color);
        }

        .mobile-warning {
            display: none;
            background: var(--danger-color);
            color: white;
            padding: 15px;
            text-align: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        .container {
            max-width: 1400px;
            margin: 20px auto;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 30px;
        }

        .student-list {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .student {
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            transition: transform 0.2s;
            cursor: grab;
        }

        .student:hover {
            transform: translateX(5px);
        }

        .settings-panel {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .room {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .grid {
            display: grid;
            gap: 8px;
            margin-top: 15px;
        }

        .seat {
            width: 65px;
            height: 65px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85em;
            transition: all 0.2s;
        }

        .seat:hover {
            border-color: var(--secondary-color);
        }

        .stats-panel {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-top: 30px;
        }

        .male { background-color: #d6eaf8; border-color: #3498db; }
        .female { background-color: #fadbd8; border-color: #e74c3c; }
        .occupied { background-color: #e8f6ea; }
        .hidden { display: none; }

        button {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            background: var(--secondary-color);
            color: white;
        }

        select, input {
            padding: 8px;
            border: 2px solid #bdc3c7;
            border-radius: 6px;
            margin: 5px 0;
        }

        @media (max-width: 768px) {
            .mobile-warning { display: block; }
            .container { display: none; }
        }
  // Firebase initialization
  const firebaseConfig = {
    apiKey: "",
    authDomain: "",
    projectId: "",
    storageBucket: "",
    messagingSenderId: "",
    appId: "",
  };
    </style>
</head>
<body><div class="mobile-warning">‚ö†Ô∏è Please use desktop view for best experience!</div><h1 style="color: var(--primary-color); text-align: center; margin: 30px 0;">ü™ë Smart Seat Manager Pro</h1><div class="file-manager"><button onclick="createNewFile()">üìÅ New File</button><select id="fileSelector" onchange="loadFile(this.value)"></select></div><div class="settings-panel"><h2>‚öôÔ∏è Room Configuration</h2><div id="room-settings-container"></div><button onclick="addNewRoom()">‚ûï Add New Room</button></div><div class="container"><div class="student-list"><h2>üéì Students</h2><div id="students"></div></div><div id="rooms-container"></div></div><div class="stats-panel" id="stats-container"></div><script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script><script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script><script>
const firebaseConfig={apiKey:"AIzaSyBV7Jg0BVzeCNQW9oiIiNItnejUsjj2DhA",authDomain:"squadvertex2007.firebaseapp.com",projectId:"squadvertex2007",storageBucket:"squadvertex2007.appspot.com",messagingSenderId:"168905083514",appId:"1:168905083514:web:c8bbe2ce9f87800a0f09c3"};
firebase.initializeApp(firebaseConfig);const db=firebase.firestore();
let currentFile=null;const config={students:[],rooms:[],files:[]};

// Firestore Structure:
// Collection: 001-school
// ‚îú‚îÄ‚îÄ Document: students (ID: "students")
// ‚îÇ   ‚îî‚îÄ‚îÄ Subcollection: list
// ‚îÇ       ‚îú‚îÄ‚îÄ Document: student1 (AutoID)
// ‚îÇ       ‚îî‚îÄ‚îÄ Document: student2 (AutoID)
// ‚îî‚îÄ‚îÄ Document: rooms (ID: "rooms")
//     ‚îî‚îÄ‚îÄ Subcollection: files 
//         ‚îú‚îÄ‚îÄ Document: file1 (AutoID)
//         ‚îÇ   ‚îî‚îÄ‚îÄ Subcollection: layouts
//         ‚îÇ       ‚îú‚îÄ‚îÄ Document: room1 (AutoID)
//         ‚îÇ       ‚îî‚îÄ‚îÄ Document: room2 (AutoID)
//         ‚îî‚îÄ‚îÄ Document: file2 (AutoID)
//             ‚îî‚îÄ‚îÄ Subcollection: layouts

async function init(){try{const students=await db.collection("001-school").doc("students").collection("list").get();config.students=students.docs.map(d=>d.data());const files=await db.collection("001-school").doc("rooms").collection("files").get();config.files=await Promise.all(files.docs.map(async f=>({id:f.id,name:f.data().name,createdAt:f.data().createdAt,rooms:(await f.ref.collection("layouts").get()).docs.map(r=>({id:r.id,...r.data()}))}));updateFileSelector();if(config.files.length>0){currentFile=config.files[0].id;loadFile(currentFile);}else{createNewFile();}}catch(e){console.error("Init error:",e);alert("Error loading data!");}}

async function createNewFile(){try{const fileRef=await db.collection("001-school").doc("rooms").collection("files").add({name:`New File ${new Date().toLocaleDateString()}`,createdAt:firebase.firestore.FieldValue.serverTimestamp()});currentFile=fileRef.id;config.files.push({id:fileRef.id,name:`New File ${new Date().toLocaleDateString()}`,rooms:[]});updateFileSelector();loadFile(currentFile);}catch(e){console.error("File creation error:",e);alert("Error creating file!");}}

async function loadFile(fileId){currentFile=fileId;const file=config.files.find(f=>f.id===fileId);if(!file.rooms.length){await addNewRoom();}else{config.rooms=file.rooms;createSettingsPanel();createRooms();}generateStudentsList();updateStats();}

async function addNewRoom(){try{const roomRef=await db.collection("001-school").doc("rooms").collection("files").doc(currentFile).collection("layouts").add({name:"New Room",type:"Mixed",rows:5,cols:6,seating:Array(5).fill().map(()=>Array(6).fill(null)),neighborCheck:"none",createdAt:firebase.firestore.FieldValue.serverTimestamp(),updatedAt:firebase.firestore.FieldValue.serverTimestamp()});config.rooms.push({id:roomRef.id,...(await roomRef.get()).data()});createSettingsPanel();createRooms();}catch(e){console.error("Room creation error:",e);alert("Error creating room!");}}

function updateFileSelector(){const selector=document.getElementById("fileSelector");selector.innerHTML=config.files.map(f=>`<option value="${f.id}" ${f.id===currentFile?"selected":""}>${f.name}</option>`).join("");}

async function saveRoom(roomId){try{const room=config.rooms.find(r=>r.id===roomId);await db.collection("001-school").doc("rooms").collection("files").doc(currentFile).collection("layouts").doc(roomId).update(room);alert("Room saved!");}catch(e){console.error("Save error:",e);alert("Error saving room!");}}

function createSettingsPanel(){const container=document.getElementById("room-settings-container");container.innerHTML=config.rooms.map(room=>`<div class="room-settings"><h3>üö™ ${room.name}</h3><div><input type="text" value="${room.name}" onchange="updateRoomField('${room.id}','name',this.value)"><button onclick="saveRoom('${room.id}')">üíæ Save</button></div><div style="display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:10px;"><div><label>Type:</label><select onchange="updateRoomField('${room.id}','type',this.value)"><option value="Boys" ${room.type==="Boys"?"selected":""}>Boys</option><option value="Girls" ${room.type==="Girls"?"selected":""}>Girls</option><option value="Mixed" ${room.type==="Mixed"?"selected":""}>Mixed</option></select></div><div><label>Rows:</label><input type="number" value="${room.rows}" onchange="updateRoomGrid('${room.id}','rows',this.value)"></div><div><label>Columns:</label><input type="number" value="${room.cols}" onchange="updateRoomGrid('${room.id}','cols',this.value)"></div><div><label>Neighbor Check:</label><select onchange="updateRoomField('${room.id}','neighborCheck',this.value)"><option value="none" ${room.neighborCheck==="none"?"selected":""}>None</option><option value="horizontal" ${room.neighborCheck==="horizontal"?"selected":""}>Horizontal</option><option value="vertical" ${room.neighborCheck==="vertical"?"selected":""}>Vertical</option><option value="both" ${room.neighborCheck==="both"?"selected":""}>Both</option></select></div></div><button onclick="deleteRoom('${room.id}')" style="background:var(--danger-color);margin-top:10px;">üóëÔ∏è Delete</button></div>`).join("");}

async function updateRoomField(roomId,field,value){const room=config.rooms.find(r=>r.id===roomId);room[field]=value;await db.collection("001-school").doc("rooms").collection("files").doc(currentFile).collection("layouts").doc(roomId).update({[field]:value});if(field==='name')createSettingsPanel();updateStats();}

async function updateRoomGrid(roomId,field,value){const room=config.rooms.find(r=>r.id===roomId);room[field]=parseInt(value);if(field==="rows")room.seating=Array(parseInt(value)).fill().map((_,i)=>room.seating[i]||Array(room.cols).fill(null));else room.seating=room.seating.map(r=>r.slice(0,parseInt(value)));await db.collection("001-school").doc("rooms").collection("files").doc(currentFile).collection("layouts").doc(roomId).update({[field]:parseInt(value),seating:room.seating});generateGrid(roomId);updateStats();}

async function deleteRoom(roomId){try{await db.collection("001-school").doc("rooms").collection("files").doc(currentFile).collection("layouts").doc(roomId).delete();config.rooms=config.rooms.filter(r=>r.id!==roomId);createSettingsPanel();createRooms();updateStats();}catch(e){console.error("Delete error:",e);alert("Error deleting room!");}}

function createRooms(){const container=document.getElementById("rooms-container");container.innerHTML=config.rooms.map(room=>`<div class="room"><div style="display:flex;justify-content:space-between;align-items:center"><h3>${room.type==='Mixed'?'üë•':room.type==='Boys'?'üë®':'üë©'} ${room.name}</h3><div>${room.rows}√ó${room.cols}<br><small>${new Date(room.updatedAt?.toDate()).toLocaleString()}</small></div></div><div class="grid" id="room-${room.id}"></div></div>`).join("");config.rooms.forEach(r=>generateGrid(r.id));}

function generateGrid(roomId){const room=config.rooms.find(r=>r.id===roomId);const grid=document.getElementById(`room-${room.id}`);if(!grid)return;grid.innerHTML="";grid.style.gridTemplateColumns=`repeat(${room.cols},65px)`;for(let i=0;i<room.rows;i++){for(let j=0;j<room.cols;j++){const seat=document.createElement('div');seat.className='seat';seat.dataset.row=i;seat.dataset.col=j;if(room.seating[i][j]){const student=config.students.find(s=>s.id===room.seating[i][j]);seat.innerHTML=`${student.name}<br>${student.class}<br>${student.gender==='M'?'‚ôÇ':'‚ôÄ'}`;seat.classList.add('occupied',student.gender==='M'?'male':'female');seat.dataset.studentId=student.id;}grid.appendChild(seat);}}attachGridListeners(grid);}

function attachGridListeners(grid){grid.replaceWith(grid.cloneNode(true));const newGrid=document.getElementById(grid.id);newGrid.addEventListener('dragover',e=>e.preventDefault());newGrid.addEventListener('drop',e=>handleDrop(e,newGrid.id.split("-")[1]));newGrid.querySelectorAll('.seat.occupied').forEach(seat=>{seat.addEventListener('dragstart',handleSeatDragStart);seat.addEventListener('dragend',handleSeatDragEnd);});}

function handleSeatDragStart(e){e.dataTransfer.setData('text/plain',JSON.stringify({studentId:e.target.dataset.studentId,roomId:e.target.closest('.grid').id.split("-")[1],row:e.target.dataset.row,col:e.target.dataset.col}));e.target.classList.add('dragging');}

function handleSeatDragEnd(e){e.target.classList.remove('dragging');}

async function handleDrop(e,roomId){e.preventDefault();const dragData=JSON.parse(e.dataTransfer.getData('text/plain'));const targetRow=parseInt(e.target.dataset.row);const targetCol=parseInt(e.target.dataset.col);const student=config.students.find(s=>s.id===dragData.studentId);const room=config.rooms.find(r=>r.id===roomId);if(!validateGender(room,student)||!validateNeighbors(room,student,targetRow,targetCol))return;await updateSeating(dragData,roomId,targetRow,targetCol);}

async function updateSeating(dragData,targetRoomId,targetRow,targetCol){try{const batch=db.batch();const sourceRef=db.collection("001-school").doc("rooms").collection("files").doc(currentFile).collection("layouts").doc(dragData.roomId);batch.update(sourceRef,{[`seating.${dragData.row}.${dragData.col}`]:null});const targetRef=db.collection("001-school").doc("rooms").collection("files").doc(currentFile).collection("layouts").doc(targetRoomId);batch.update(targetRef,{[`seating.${targetRow}.${targetCol}`]:dragData.studentId});await batch.commit();config.rooms.find(r=>r.id===dragData.roomId).seating[dragData.row][dragData.col]=null;config.rooms.find(r=>r.id===targetRoomId).seating[targetRow][targetCol]=dragData.studentId;generateGrid(dragData.roomId);generateGrid(targetRoomId);updateStats();}catch(e){console.error("Seat update error:",e);alert("Error updating seat!");}}

function validateGender(room,student){if(room.type==='Mixed')return true;const requiredGender=room.type==='Boys'?'M':'F';if(student.gender!==requiredGender){alert(`‚ùå ${room.type} room only!`);return false;}return true;}

function validateNeighbors(room,student,row,col){if(room.neighborCheck==='none')return true;const directions=[];if(['horizontal','both'].includes(room.neighborCheck))directions.push([0,-1],[0,1]);if(['vertical','both'].includes(room.neighborCheck))directions.push([-1,0],[1,0]);for(const[dx,dy]of directions){const x=row+dx,y=col+dy;if(x>=0&&x<room.rows&&y>=0&&y<room.cols&&room.seating[x][y]){const neighbor=config.students.find(s=>s.id===room.seating[x][y]);if(neighbor.class===student.class){alert('‚ùå Same class students cannot sit adjacent!');return false;}}}return true;}

function initDragDrop(){document.querySelectorAll('.student').forEach(student=>{student.draggable=true;student.addEventListener('dragstart',e=>{e.dataTransfer.setData('text/plain',e.target.dataset.id);e.target.classList.add('dragging');});student.addEventListener('dragend',e=>e.target.classList.remove('dragging'));});document.getElementById('students').addEventListener('dragover',e=>e.preventDefault());document.getElementById('students').addEventListener('drop',async e=>{e.preventDefault();const studentId=e.dataTransfer.getData('text/plain');const dragData=JSON.parse(e.dataTransfer.getData('text/plain'));if(dragData.roomId){await updateSeating(dragData,dragData.roomId,dragData.row,dragData.col);}});}

function generateStudentsList(){const container=document.getElementById('students');container.innerHTML=config.students.map(s=>`<div class="student ${s.gender==='M'?'male':'female'}" data-id="${s.id}">${s.name} (${s.class})</div>`).join("");}

function updateStats(){const statsContainer=document.getElementById('stats-container');statsContainer.innerHTML=`<h2>üìä Statistics</h2><div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:15px;">${config.rooms.map(r=>`<div class="stats-card"><h3>${r.name}</h3><p>Capacity: ${r.rows*r.cols}</p><p>Occupied: ${r.seating.flat().filter(s=>s).length}</p><p>Type: ${r.type}</p><p>Rules: ${r.neighborCheck}</p></div>`).join("")}</div>`;}

init();
</script></body>