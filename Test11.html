<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Channel List</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f9;
        }

        #channel-list {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            padding: 20px;
        }

        .channel-item {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            width: 300px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .channel-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }

        .channel-info {
            padding: 15px;
        }

        .channel-info h3 {
            margin: 0 0 10px;
        }

        .channel-info p {
            margin: 5px 0;
        }

        .visit-channel,
        .test-button {
            display: inline-block;
            margin: 10px 0;
            padding: 10px 15px;
            background-color: #007BFF;
            color: #fff;
            text-decoration: none;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .visit-channel:hover,
        .test-button:hover {
            background-color: #0056b3;
        }

        .vip-badge {
            display: inline-block;
            margin-top: 10px;
            padding: 5px 10px;
            background-color: gold;
            color: #000;
            border-radius: 5px;
            font-weight: bold;
        }

        .reaction-container {
            margin-top: 10px;
        }

        .reaction-btn {
            padding: 5px 10px;
            border: none;
            background-color: #eee;
            margin-right: 10px;
            border-radius: 5px;
            cursor: pointer;
        }

        .reaction-btn:hover {
            background-color: #ddd;
        }

        .countdown-timer {
            margin-top: 10px;
            font-size: 0.9em;
            color: #333;
        }
    </style>
</head>
<body>
    <div id="channel-list"></div>

    <script>
        const firebaseURL = "https://squadvertex2007-default-rtdb.firebaseio.com/channels.json";
        const apiKey = "AIzaSyALYK2h1PDv9yDVR3PlFkB4ZAhbu9E1-rA";
        const youtubeBaseURL = "https://www.googleapis.com/youtube/v3/channels";

        // Fetch channel data from Firebase
        async function fetchChannelData() {
            try {
                const response = await fetch(firebaseURL);
                if (!response.ok) {
                    throw new Error("Failed to fetch data from Firebase");
                }
                const data = await response.json();
                return Object.entries(data); // Returns an array of [documentID, fields] pairs
            } catch (error) {
                console.error("Error fetching channel data:", error);
                return [];
            }
        }

        // Fetch YouTube data
        async function fetchYouTubeData(channelId) {
            try {
                const response = await fetch(`${youtubeBaseURL}?part=statistics&id=${channelId}&key=${apiKey}`);
                if (!response.ok) {
                    throw new Error("Failed to fetch YouTube data");
                }
                const data = await response.json();
                if (data.items && data.items.length > 0) {
                    const stats = data.items[0].statistics;
                    return {
                        subscribers: stats.subscriberCount,
                        videos: stats.videoCount,
                    };
                }
                return { subscribers: "N/A", videos: "N/A" };
            } catch (error) {
                console.error(`Error fetching YouTube data for channel ${channelId}:`, error);
                return { subscribers: "N/A", videos: "N/A" };
            }
        }

        // Start countdown timer
        function startCountdown(targetDate, countdownId) {
            const countdownEl = document.getElementById(countdownId);
            const interval = setInterval(() => {
                const now = new Date().getTime();
                const distance = targetDate - now;

                if (distance <= 0) {
                    clearInterval(interval);
                    countdownEl.textContent = "Expired";
                    return;
                }

                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % 1000) / 1000);

                countdownEl.textContent = `${days}d ${hours}h ${minutes}m ${seconds}s`;
            }, 1000);
        }

        // Render channels
        async function renderChannels() {
            const channelListDiv = document.getElementById("channel-list");
            const channels = await fetchChannelData();

            for (const [channelId, channelData] of channels) {
                const { vip, portal, bg } = channelData;
                const portalFile = portal?.file || "#";
                const portalTime = portal?.time || null;

                const { subscribers, videos } = await fetchYouTubeData(channelId);

                const channelCard = document.createElement("div");
                channelCard.className = "channel-item";
                channelCard.style.backgroundImage = `url(${bg})`;

                channelCard.innerHTML = `
                    <img src="https://via.placeholder.com/150" alt="Channel Background">
                    <div class="channel-info">
                        <h3>${channelId}</h3>
                        <p>Subscribers: ${subscribers}</p>
                        <p>Videos: ${videos}</p>
                        ${vip ? '<div class="vip-badge">VIP</div>' : ""}
                        <a href="https://youtube.com/@${channelId}" class="visit-channel" target="_blank">Visit Channel</a>
                        <button class="test-button" ${
                            portalTime ? "" : "disabled"
                        } onclick="redirectToPortal('${portalFile}')">ðŸ”’ CustomPortal</button>
                        ${
                            portalTime
                                ? `<div class="countdown-timer" id="timer-${channelId}"></div>`
                                : '<div class="countdown-timer">N/A</div>'
                        }
                    </div>
                `;

                channelListDiv.appendChild(channelCard);

                if (portalTime) {
                    startCountdown(new Date(portalTime), `timer-${channelId}`);
                }
            }
        }

        // Redirect to portal
        function redirectToPortal(portalFile) {
            window.location.href = portalFile;
        }

        // Initialize
        renderChannels();
    </script>
</body>
</html>